<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOTE TO CURE DISEASE | The 1% Treaty</title>
    <meta name="description" content="Vote YES to redirect 1% of military spending to cure disease. It costs nothing. It saves lives. Democracy that actually works.">

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="watermark">warondisease.com</div>

    <div class="container">
        <!-- ATOMIC AGE HERO -->
        <div class="hero">
            <h1>SHOULD WE<br>CURE DISEASE?</h1>
            <p class="subtitle">A SIMPLE QUESTION.<br>A WORLD-CHANGING ANSWER.</p>
        </div>

        <!-- STATS -->
        <div class="stats">
            <div class="stat">
                <div class="stat-number">$27B</div>
                <div class="stat-label">Per Year<br>Medical Research</div>
            </div>
            <div class="stat">
                <div class="stat-number">1%</div>
                <div class="stat-label">Redirected From<br>War Spending</div>
            </div>
        </div>

        <!-- PROPAGANDA PROPOSITION -->
        <div class="proposition">
            <h2>THE PROPOSITION</h2>
            <p>Every country redirects <strong>1%</strong> of military spending to cure disease.</p>
            <p style="margin-top: 15px;">They keep <strong>99%</strong> of their weapons.<br>Nobody loses strategic advantage.<br>Everybody gains healthier citizens.</p>
        </div>

        <!-- BENEFITS -->
        <div class="benefits">
            <h3>WHAT YOU GET:</h3>
            <ul>
                <li><strong>LIVES SAVED:</strong> Fund 54,000 clinical trials per year</li>
                <li><strong>DISEASES CURED:</strong> Cancer, Alzheimer's, rare diseases</li>
                <li><strong>MONEY MADE:</strong> Early voters earn rewards when treaty passes</li>
                <li><strong>DEMOCRACY PROVEN:</strong> People, not politicians, change the world</li>
            </ul>
        </div>

        <!-- CTA FORM -->
        <div class="cta-section">
            <h2>VOTE YES<br>RIGHT NOW</h2>
            <p class="cta-subtitle">30 seconds. Zero cost. Everything changes.</p>

            <div id="errorMessage" class="error-message"></div>

            <div id="successMessage" class="success-message">
                <h3>ðŸŽ‰ VOTE RECORDED!</h3>
                <p style="font-size: 1.3em;">You're now part of the 3.5% that will change the world.</p>
                <div class="ref-code-display">
                    YOUR REFERRAL CODE:<br><span id="displayRefCode"></span>
                </div>
                <p style="margin-top: 15px; font-size: 1.1em;">Share your link below to earn Tier 2 rewards!</p>
            </div>

            <div class="form-container" id="voteForm">
                <form id="referendumForm">
                    <div class="form-group">
                        <label for="fullName">Full Name *</label>
                        <input type="text" id="fullName" name="fullName" required placeholder="Jane Doe">
                    </div>

                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required placeholder="jane@example.com">
                    </div>

                    <div class="form-group">
                        <label for="country">Country *</label>
                        <select id="country" name="country" required>
                            <option value="">SELECT YOUR COUNTRY</option>
                            <option value="United States">United States</option>
                            <option value="United Kingdom">United Kingdom</option>
                            <option value="Canada">Canada</option>
                            <option value="Australia">Australia</option>
                            <option value="Germany">Germany</option>
                            <option value="France">France</option>
                            <option value="India">India</option>
                            <option value="China">China</option>
                            <option value="Japan">Japan</option>
                            <option value="Brazil">Brazil</option>
                            <option value="Mexico">Mexico</option>
                            <option value="South Korea">South Korea</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="referralCode">Referral Code (Optional)</label>
                        <input type="text" id="referralCode" name="referralCode" placeholder="Who sent you?">
                    </div>

                    <button type="submit" class="submit-btn" id="submitBtn">VOTE YES</button>
                </form>
            </div>
        </div>

        <!-- VIRAL SHARING - HIDDEN UNTIL VOTE -->
        <div class="viral-section" id="viralSection" style="display: none;">
            <h3>TRIPLE YOUR REWARD</h3>
            <p>Invite 3 friends. When they vote, you move up reward tiers.<br>When the treaty passes, you earn real value.</p>
            <div class="share-buttons">
                <a href="#" class="share-btn" id="shareTwitter">TWITTER</a>
                <a href="#" class="share-btn" id="shareFacebook">FACEBOOK</a>
                <a href="#" class="share-btn" id="shareWhatsApp">WHATSAPP</a>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <p>Part of the <a href="https://warondisease.com">WAR ON DISEASE</a> initiative</p>
            <p style="margin-top: 10px;">Built by humans who prefer not to die from preventable illness</p>
        </div>
    </div>

    <script>
        // Get referral code from URL if present
        const urlParams = new URLSearchParams(window.location.search);
        const refCode = urlParams.get('ref');
        if (refCode) {
            document.getElementById('referralCode').value = refCode;
        }

        // Form submission handler
        document.getElementById('referendumForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const errorMessage = document.getElementById('errorMessage');
            const originalBtnText = submitBtn.textContent;

            // Disable button and show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'SUBMITTING...';
            errorMessage.classList.remove('show');

            const formData = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                country: document.getElementById('country').value,
                referralCode: document.getElementById('referralCode').value
            };

            try {
                // Call Cloudflare Worker
                const response = await fetch('/api/submit-vote', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'Failed to submit vote');
                }

                // Success! Show success message
                document.getElementById('voteForm').style.display = 'none';
                document.getElementById('successMessage').classList.add('show');
                document.getElementById('viralSection').style.display = 'block';
                document.getElementById('displayRefCode').textContent = result.referralCode;

                // Update share links
                updateShareLinks(result.referralCode);

            } catch (error) {
                console.error('Error submitting vote:', error);
                errorMessage.textContent = error.message || 'Something went wrong. Please try again.';
                errorMessage.classList.add('show');
                submitBtn.disabled = false;
                submitBtn.textContent = originalBtnText;
            }
        });

        function updateShareLinks(refCode) {
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?ref=${refCode}`;
            const message = "I just voted to redirect 1% of military spending to cure disease. Join me and let's make death optional.";

            // Update share button hrefs
            document.getElementById('shareTwitter').href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}&url=${encodeURIComponent(shareUrl)}`;
            document.getElementById('shareFacebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
            document.getElementById('shareWhatsApp').href = `https://wa.me/?text=${encodeURIComponent(message + ' ' + shareUrl)}`;

            // Add click handlers to open in popup
            document.getElementById('shareTwitter').onclick = function(e) {
                e.preventDefault();
                window.open(this.href, 'share', 'width=550,height=420');
            };
            document.getElementById('shareFacebook').onclick = function(e) {
                e.preventDefault();
                window.open(this.href, 'share', 'width=550,height=420');
            };
        }
    </script>
</body>
</html>
