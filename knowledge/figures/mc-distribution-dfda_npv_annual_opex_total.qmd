```{python}
#| echo: false
#| fig-cap: "Monte Carlo Distribution: dFDA Total NPV Annual OPEX (10,000 simulations)"
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines, get_tick_formatter,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata, get_figure_output_path
)
from dih_models.parameters import format_parameter_value

setup_chart_style()

# Simulation results
samples = [41769019.05185288, 31450894.459705688, 45888327.67875208, 47766684.8791357, 26400347.4719547, 29758327.738654755, 40238834.7704701, 36639623.333245024, 39029295.61157911, 32716160.138353147, 47154101.05859585, 46153840.287936375, 39717440.08847925, 49685912.78346991, 43228751.530723214, 32673056.785480082, 42337221.387483, 31993687.26271452, 47144672.21380456, 38757454.577093735, 37669522.22808712, 33926059.051162876, 50695249.748169534, 37911389.749333546, 35783276.9217072, 36363203.27959786, 43823904.057009324, 42307690.794184536, 42731966.99057363, 42895380.503341526, 58500000.0, 35949104.26691368, 35155288.24261237, 32988364.19044116, 44604512.95890199, 49704066.45475491, 38237413.1270839, 32805239.48716497, 32913915.584993776, 44931494.94918385, 45818690.03543593, 43924308.16552277, 34036615.3970733, 41134410.33971565, 40144236.61522314, 41017637.43825507, 47074870.54794117, 41060129.28660581, 45200815.674097076, 39730418.4493033, 41631772.62190603, 44748835.95560564, 28801068.053259157, 36613126.663228646, 35467238.245430216, 34228408.59989873, 36958747.19813584, 53694818.72870855, 32628012.986654453, 48046851.096962884, 27461709.930901874, 36495784.2019002, 40536360.41625176, 44325310.36460838, 45510074.31630109, 46305586.99575751, 36389364.32530673, 35527312.40856119, 46941422.63854824, 37618354.55968111, 29925128.115662508, 30837825.471234825, 32260960.723614305, 43500073.94233743, 40362864.329477966, 45311323.59014403, 35791395.54034546, 40500337.596477784, 44695065.42319475, 36692974.66699891, 43130948.03545883, 34062361.6729393, 36279513.52576216, 36136771.43297379, 30433519.49955449, 43406655.5983843, 35474500.23835742, 39271298.738086574, 43349668.54246666, 43037816.00317226, 45071963.899925664, 38362366.42942791, 35821270.44839698, 38514579.90115802, 27435855.414091162, 28862159.585874103, 29629773.17762515, 31735766.489652477, 42615281.841187574, 32356211.613450773, 36164042.72025083, 51522326.90886115, 36331526.33425483, 45763239.69206675, 32164686.248313818, 37506339.594703466, 32053553.744873144, 36463856.107516125, 46766739.677126184, 27205382.60452182, 42928001.93452145, 41182821.81094289, 34552958.90315269, 28868582.118096393, 39768584.511421055, 35027568.260867834, 41138879.65125663, 39348919.66746549, 54919183.8619724, 37238876.48956361, 31560484.22072517, 40677931.97202749, 41028960.54320846, 52178386.64280109, 46715481.31487504, 42231225.6760635, 53337508.898443155, 30478991.52643198, 34222099.51415421, 32212509.13320093, 36075277.71758979, 29294205.188735202, 44785325.31951127, 37373739.95964736, 28718242.48669786, 31613255.180481903, 41846622.71751805, 46745215.41127832, 58178990.993548594, 58500000.0, 42747089.446727246, 31787424.20981182, 25945524.011642642, 41444135.1005622, 32994152.996027168, 35881340.29305701, 34422366.52557804, 38021448.8001914, 49047729.97469032, 40487596.70417612, 37878563.8922132, 31479642.251363743, 27509182.560324013, 35348188.680594474, 38725928.10191195, 56657580.91916108, 40259507.288224004, 48193695.763115264, 35251455.62388587, 30503561.345815524, 31951633.058994412, 33610458.48648313, 58500000.0, 32935412.442195497, 46748792.63927969, 32373637.274609827, 47676136.43270168, 42482195.03765312, 37894527.59329723, 38832464.57066825, 34113701.891597584, 43033648.031166635, 35582588.8536962, 30242993.40924207, 29910918.009853475, 40620569.620793834, 54656867.63747886, 40512747.38931443, 38199585.23481533, 41602852.45572117, 51596024.86529366, 41023643.64747616, 35914894.894971184, 49466711.977869, 42876697.32526471, 54159300.497685865, 40711925.86111304, 30250247.40785684, 29346952.80968514, 55491776.60154876, 56350159.55807854, 37712015.002688825, 36125721.634506814, 53316592.86026806, 31009032.772484105, 32429696.181365445, 44862657.03691936, 36038795.41750575, 39125596.83071235, 37840155.439695545, 42059619.95311762, 52712882.64441922, 39923752.59018799, 44868451.031182304, 26149144.017651066, 38767330.75377208, 32783971.109512165, 30286366.590769842, 32543302.496012494, 36501649.30022554, 47518741.54084195, 29606695.637535002, 39421880.22575859, 35364141.613391764, 36551362.087184295, 48397711.38436198, 43877629.92056563, 51939010.45962654, 37911580.15637697, 33818764.31723442, 37360840.014265016, 41224216.891886555, 40654744.068500414, 31157622.324583586, 39922951.251350015, 41100287.363235585, 58500000.0, 57372473.92319151, 32714783.609667346, 36863411.347416505, 28762896.396030527, 34578068.491619885, 41865091.76981422, 50517037.992723286, 33583112.340957046, 34118317.76374479, 25907994.03826651, 37846359.56720023, 31302406.86122917, 35027962.04647508, 32552172.033637844, 38396564.28432964, 27031413.36082924, 28741039.201937106, 58500000.0, 29851121.861387607, 31076230.931225263, 57108428.09490559, 58500000.0, 30589774.009253114, 36239767.48326804, 42094966.179811314, 56404144.330126, 31805410.159751855, 37192372.51063287, 46149415.35920609, 42931103.892312594, 36179356.40080708, 38077390.50774883, 29305272.337600682, 37248164.14216368, 37027082.02030391, 41134484.69482966, 34837155.541388094, 43265520.539258584, 48499519.32450414, 40473765.6659833, 42185672.48714104, 39609683.81344317, 39168601.44575056, 33636480.28860699, 41872948.15175253, 38372072.07105464, 58500000.0, 54590742.22504314, 42490224.01342558, 33343248.377743527, 30973947.646408595, 50360459.41537581, 41400762.719564825, 43344150.71961455, 27106466.35012673, 47634558.43915648, 43109521.063112825, 30986894.73469284, 35458617.269900076, 41409219.76494505, 39603929.458609134, 36826189.92397554, 38321892.64724684, 37139834.740636535, 40449289.81840558, 53429763.83568389, 25000000.0, 37258567.25573392, 40654221.32736084, 41692207.53012313, 36211749.23704351, 27037154.493602954, 41974691.68928916, 56393992.24553055, 28338731.432030633, 46999427.12201607, 36544790.85409816, 38664351.0897652, 31365315.844327122, 36499086.774409376, 51531202.98313406, 44291958.91913748, 56427400.82820943, 50214745.75305931, 42970261.95419089, 56502319.13617252, 42969413.993306965, 46645315.8374556, 36792018.47510174, 39721757.30835775, 33808196.87483357, 48263353.37677778, 30546325.159882884, 46198257.336816505, 37623540.20862347, 50149462.38553999, 45892373.44874978, 57001507.9816146, 45698190.420245536, 28111386.533577777, 38618456.86261381, 30586930.796031654, 35110536.15278063, 53879690.6869601, 44807849.993841276, 33797451.6547934, 31625675.085897587, 39439773.366580725, 30300765.753223486, 33996203.91399684, 41833341.13888095, 49981107.95200169, 44536627.71249759, 25559210.333320625, 41765931.29729374, 39767779.49816428, 42742406.92691719, 55086688.7471593, 26116417.375157923, 34575176.51019597, 44369142.739721715, 28054780.158321638, 53480042.53930813, 42333700.16571007, 46828715.0935994, 34722557.403596215, 46505513.49368507, 49073522.53398393, 41140631.51583121, 41153853.69658178, 41467156.563094646, 32645130.31691525, 37967432.86211662, 37927447.39952254, 42468239.158593595, 48367760.027452625, 31328030.985785726, 38148270.82844615, 53542224.801207155, 33480495.78048904, 32929413.667979702, 40876092.032162994, 46806992.14909512, 39262449.34453556, 51846612.38155851, 46929716.72826624, 46781662.81381204, 44026030.72997618, 58500000.0, 37508522.837756045, 26266709.89980734, 54947881.54353599, 35562204.0207248, 40069718.60030329, 51634680.97415601, 27932733.12484196, 30077286.957738936, 27938518.381923757, 33125320.55647677, 42975248.560019255, 43748866.79391298, 41519084.36013679, 29072063.96688173, 25514402.143152718, 39619699.740550466, 35456737.750638396, 43154713.453461066, 45421109.59334084, 40327243.11713826, 45982175.67099258, 41108813.67979939, 43803153.286638394, 33756524.65980716, 37711281.34770009, 40828421.929101534, 46571947.39885481, 36045365.538300425, 43720990.84167196, 37031369.06089814, 38208421.47611193, 46660386.657718614, 26293231.606758587, 29794181.203813903, 28649380.827372193, 25458647.266083576, 33945141.4640045, 45878478.008454636, 36882856.27510357, 40837158.441552214, 49288831.81228126, 51832670.26931689, 38600658.253153026, 52116742.07681239, 39936742.60643947, 32824336.31041664, 34551133.45760327, 28659348.958296075, 32474839.587923333, 36318092.77338755, 46405731.96597704, 56315732.442363225, 29260261.16675848, 42552860.31723127, 31447179.8308675, 43294366.47586221, 38099381.414404586, 26711714.16986661, 47643188.86872997, 34473942.93100399, 34995009.14949097, 31253982.05313841, 34117332.73655393, 42868862.94367914, 37634709.179804124, 41980595.50448662, 42276258.4296585, 51755892.311878085, 36434992.240263805, 28681600.568751715, 49060588.56335537, 36521951.12458089, 49553468.00682852, 42468089.047347665, 38098972.39558996, 42159149.46999238, 57868971.79296975, 58500000.0, 39745528.59812401, 40514448.39450113, 49154037.61671738, 32767161.798218604, 42019664.40763594, 38954741.128050104, 41850105.109364524, 32852254.06178226, 28007628.48351521, 26092066.237608537, 30941468.647797137, 35554882.506618544, 36818262.00253706, 57776115.652483426, 49463629.11331366, 31972036.451627433, 42149654.572773516, 35944074.019237086, 36886905.027269214, 40729894.38751866, 44634564.030324966, 36462121.91120285, 49025702.42017096, 30781591.303274393, 39220328.64148264, 58500000.0, 41055660.58257909, 52999911.44316544, 39931632.20701048, 44274408.78044871, 38701416.79780942, 37784588.23932936, 33227896.162026733, 42890677.24252413, 32726562.36014412, 45073867.332622655, 49247967.22789095, 42317399.01299829, 36872237.668479845, 43105384.48838507, 36698189.243397616, 47716135.431739874, 26710401.459463745, 36490222.25298332, 26298938.879883237, 28571663.17273657, 52229885.39256758, 47311451.10530451, 33651229.59248079, 28526834.82549326, 25000000.0, 34924232.05322394, 58500000.0, 42932174.648193255, 34805966.5697407, 43206599.14982403, 28177187.718607426, 36786177.95472008, 39998735.004629634, 38462746.92439158, 46280763.590611726, 42122419.040040195, 45099943.297149576, 33872825.118704684, 47337719.72932376, 55234844.15078828, 31917723.593150966, 32477842.157108855, 51921325.54426329, 37618039.74647148, 52672179.32903285, 35676166.465440854, 53244646.62949501, 40269798.5549005, 41361291.72170585, 54491332.13205375, 36289338.86701395, 32113799.340736218, 35630815.80844803, 43090546.14728458, 28148663.517859567, 44807255.19080946, 34959060.9420836, 49902072.569603495, 25316086.61213416, 33178273.693222225, 27440870.08602463, 32901777.19470594, 41269205.67850235, 37714343.2669331, 37128863.82056868, 37874168.05338059, 40885425.9376365, 31660266.53586942, 45468060.25999453, 45046109.84730957, 42482974.67525497, 44048490.10208742, 41695937.9075539, 58441354.63014133, 38454684.65145559, 36710501.79441768, 33410357.432460614, 31502172.883040916, 30122854.622909535, 32470294.036923163, 38588097.33589648, 42030525.18435632, 39592860.67371387, 33325819.563375212, 47361391.674092084, 45781563.38722859, 37870464.698704675, 34127175.40215341, 43973214.93100193, 40752657.90770256, 28855980.970736794, 38610088.49761181, 41394530.87488331, 32395723.351118445, 40768739.723487616, 28815249.681957193, 51925727.80911727, 50967802.80341427, 37135603.636373386, 42289931.51297273, 25279558.68206042, 30688153.322502457, 36813699.536872834, 31238288.075350694, 45540526.33079471, 58182845.75766773, 30557211.59224813, 32823884.9052645, 41162950.7609842, 55027507.45895438, 30263619.31290362, 41281139.48354557, 57005790.71976113, 27642547.11986509, 29891162.079697683, 35818940.39451181, 35093438.18177291, 46494107.61485913, 41216936.148735, 26933311.14141266, 43667912.036527306, 34674273.00038521, 51253594.50137587, 34310043.40820797, 34244752.535505906, 43905564.89839552, 46009288.156336226, 43052059.84747329, 27445912.02736572, 43876879.992987946, 31488581.271444887, 41161454.61612255, 29004865.743581712, 43035917.75441238, 33038332.96868541, 29881291.361022197, 45534988.08335085, 41216803.969062865, 34408715.0652577, 53201216.80022314, 35690345.75565986, 39434161.28107008, 41454647.877694085, 34367436.94835737, 43261848.51957156, 34998316.40968089, 35909506.72421172, 52216444.76968557, 31446900.4161705, 25272904.808302283, 55025427.049594596, 58500000.0, 35957795.97066364, 26436744.37393992, 36684169.5367429, 36872438.265698925, 37629313.70814096, 30967566.451497458, 44263050.15051201, 43751816.68822807, 28575613.002936516, 45394693.51321924, 58500000.0, 40615190.807945766, 36476998.7756062, 38011724.06965561, 44597711.67988731, 27186155.121609002, 40550370.274975464, 36070298.86420858, 57180355.65197598, 37754582.25237212, 55690741.94600399, 31030662.75502647, 44335009.24363454, 41898632.270684324, 32605880.33300717, 40661802.63798662, 50588141.98327759, 36581308.576763436, 27409079.480947837, 39023023.53720713, 32377080.550717756, 36438415.0495668, 38499389.63783339, 27330033.2106034, 27853884.652226746, 43361746.30986855, 35077668.049270354, 25000000.0, 46222573.94862111, 41484892.22491863, 33691051.97470914, 29666487.025990352, 46722349.3047144, 42164262.56857196, 58500000.0, 42799250.023754835, 42506873.25665772, 37812340.163796864, 46535083.010115296, 44690301.0320078, 51008421.55284945, 35087999.95680978, 35729864.68839242, 35401964.45414032, 46280720.61483688, 53733734.65170556, 35553643.15257661, 35810120.79864244, 41851597.64528265, 37188577.203896135, 47882631.414825216, 25653883.062255435, 32898475.93607465, 33207333.520671237, 25490057.257859245, 31961600.442924794, 32290216.390535392, 37540645.1271232, 49536462.07427251, 37194076.99681464, 31511804.74757412, 38700017.58860691, 48874086.0151657, 31878626.76177649, 32321442.487216227, 44067228.00704987, 37379154.6204278, 44902035.95913124, 39055281.43532793, 45418330.35015679, 31483465.70687054, 39068156.8394182, 37464795.59883119, 30305044.33119698, 28162213.55989539, 45266060.20937932, 36372266.95294089, 31568590.388676815, 38381041.38264465, 49694067.08120148, 25584416.978779808, 28562153.54160421, 32237594.19405786, 53313606.521754146, 41574427.00237507, 46051936.82977358, 30793135.95149139, 30927424.892267287, 43049464.96376725, 39652490.49805473, 43976099.83510553, 37647205.10777085, 41535466.48850198, 40496743.32478888, 46153601.224414155, 46439266.289424576, 27829134.431224033, 25664735.327428635, 48387372.56692983, 50324149.68940748, 31579630.480748467, 26636023.399341177, 39994999.21833032, 47668744.563700035, 56850636.41609654, 43676087.628590874, 36213261.21793902, 32440620.951694105, 39262658.41427629, 36771112.72126357, 31616664.857591752, 58500000.0, 56769618.00655706, 49778344.67567025, 32251445.709755063, 46912145.41810213, 44827640.200854056, 43001636.46606524, 50986254.996058226, 44787406.30774397, 45787375.28994855, 44801917.019213535, 42088179.260307625, 26884210.845451925, 39865131.54077239, 34830799.93529436, 29898908.943748347, 55854686.13187585, 56406059.37803102, 52178750.28804005, 41334982.89490944, 52084189.30451903, 39267645.12151399, 40880327.93698386, 31097968.324992977, 42590264.33164899, 39670161.876700416, 29755360.658522513, 38747060.187202536, 38514487.63974689, 56850418.64605811, 47301751.424703225, 39262609.92820945, 41278972.21930723, 39535010.557097524, 37526316.03502047, 31170515.26574648, 37939218.46252638, 33462769.546860404, 30085738.56845755, 43629333.31976833, 42538829.990921184, 26866654.63319967, 38166985.22777089, 48325697.630049266, 48977848.61194395, 48633992.503836766, 39490829.26475242, 32771418.730463363, 31162153.56791701, 42122060.65402232, 42431390.08266318, 51393135.29719831, 49400897.57652299, 38090201.92277256, 30124544.607272428, 36617488.76610102, 41005025.512875155, 37532894.44259449, 34671674.296024665, 41314677.759177074, 35216796.34876356, 34306579.31346277, 41828427.86337012, 35982664.61704095, 41238203.18487021, 41492195.77250344, 30797891.446184717, 35385998.3553469, 53050964.987390205, 30651064.05664927, 25983541.073479503, 26630781.91216871, 39409225.764906034, 39424257.5120952, 38207867.71471227, 50605983.68481928, 25000000.0, 42580762.25314282, 54453629.02166736, 30873672.55517034, 36151500.70087308, 33414838.67023105, 32432302.9930588, 36562246.372026555, 52935871.15345351, 57111543.53947214, 36487667.26411425, 57560422.93861073, 39463034.97048845, 56565351.75729893, 38404374.3870873, 40266162.008901946, 42307962.26080198, 58500000.0, 46875198.17192866, 33738073.92212967, 48054146.76901736, 36288863.6835817, 35322524.59301548, 47445585.7717246, 39425657.65207933, 41539254.50774446, 39283656.549507245, 42050822.00617817, 42842416.197522365, 26436413.456198595, 45083260.084891155, 31837889.684758313, 28891484.020214964, 38688124.27457957, 39868159.261485726, 33836153.90682447, 46675284.571816005, 29508276.451273195, 35945093.994674444, 34620649.70898622, 38784767.3519616, 41541782.19143334, 31664562.57503981, 45635630.11932282, 39692069.072422564, 26552536.87357883, 26381019.136303186, 39066222.61217482, 37383640.98747048, 38322443.74716294, 38937322.75368899, 41077151.44127032, 47838152.49695754, 30982487.223047912, 30587160.531661287, 31098936.19138516, 41629991.72891967, 50935518.26485026, 35760546.11026615, 25067861.395642225, 27339602.48612805, 32854555.953369685, 34819506.786944255, 35934137.3190833, 39488062.19464631, 36674399.864116736, 48875797.98487626, 33961239.51507451, 32652206.865255706, 43332556.17620978, 28328087.266724996, 42524713.248052776, 40024702.27829298, 37968123.35273091, 54762912.26098071, 34349012.751952924, 58500000.0, 37348444.83249277, 29916731.447917767, 39750044.5308278, 31211197.44099907, 33422849.122609116, 42590641.74762839, 44039648.29859094, 34349300.799910896, 48241168.30460343, 50004272.20032719, 53034452.33315313, 43797133.71193138, 52225107.36737977, 26581457.943879366, 36626761.75611371, 32619931.089811906, 40165758.31308357, 34718853.77870266, 37818484.75003487, 57407892.42718294, 37790072.043874756, 42741523.348128885, 37294597.80475763, 39798668.703590915, 39217660.81755244, 43054101.20141112, 50086644.531760216, 55450407.26309853, 41812254.76889491, 44356416.78705318, 30723675.327050712, 38448335.38201262, 47763910.48444201, 47020662.22300792, 40956415.37288404, 47223765.757723615, 43441422.20299013, 50457935.4133821, 41633878.87433332, 36335862.81693688, 42044239.80933711, 25000000.0, 42463685.9386167, 25000000.0, 27227529.158424206, 43085405.94180755, 43320248.647894666, 30648805.49189416, 33703656.1211721, 52303550.770420365, 35365181.048101895, 58500000.0, 39152040.4263331, 42689640.56348184, 55094416.72606372, 40265901.08648045, 31701655.496048495, 38271475.9317372, 38874700.05518797, 29368120.386551194, 37109639.870733775, 33490359.581979327, 47603601.406963944, 39455003.66880144, 36899111.595598176, 38300117.93302136, 41056026.821931824, 44612370.76201941, 31719263.034395993, 31440255.840358283, 49449913.83592291, 35904214.37111296, 29047073.13387377, 43013135.35106019, 43191008.00627216, 28357547.735033497, 41111158.76397362, 45744581.88826129, 42387598.13115735, 44755382.656423494, 29124226.093119837, 42001667.21598956, 36745091.30364665, 35374434.760682076, 47066197.52347456, 53517586.7493134, 56829592.04749824, 51691997.01772814, 38271421.585262224, 42194252.3230474, 46047132.912059225, 40182306.0750903, 40263667.218463756, 46603648.70166394]  # Truncate for embedding
baseline = 40050000.0
mean = 39859651.62274284
std = 8040029.27864433
p5 = 27512603.801403433
p50 = 39059231.354343794
p95 = 55395973.133008234
display_name = "dFDA Total NPV Annual OPEX"
units = "USD/year"

# Create figure with two subplots
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))
fig.subplots_adjust(wspace=0.3)

# --- Left: Histogram ---
# Handle edge case where all samples are identical (zero variance)
if std == 0 or (max(samples) == min(samples)):
    n_bins = 1
else:
    n_bins = min(50, max(1, int(np.sqrt(len(samples)))))
n, bins, patches = ax1.hist(samples, bins=n_bins, color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)
ax1.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key statistics with formatted values in legend (use format_parameter_value for full units)
ax1.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=2, label=f'Median: {format_parameter_value(p50, units)}')
ax1.axvline(p5, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'5th %-ile: {format_parameter_value(p5, units)}')
ax1.axvline(p95, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'95th %-ile: {format_parameter_value(p95, units)}')
ax1.axvline(baseline, color=COLOR_BLACK, linestyle='-', linewidth=1.5, alpha=0.5, label=f'Baseline: {format_parameter_value(baseline, units)}')

ax1.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax1.set_ylabel('Frequency', fontsize=11)
ax1.set_title('Distribution of Outcomes', fontsize=12, weight='bold')
ax1.legend(loc='upper right', fontsize=9)
clean_spines(ax1)

# --- Right: CDF (Cumulative Probability) ---
sorted_samples = np.sort(samples)
cumulative = np.arange(1, len(sorted_samples) + 1) / len(sorted_samples)

ax2.plot(sorted_samples, cumulative * 100, color=COLOR_BLACK, linewidth=2)
ax2.fill_between(sorted_samples, 0, cumulative * 100, alpha=0.1, color=COLOR_BLACK)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)
ax2.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key percentiles
ax2.axhline(50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)
ax2.axhline(5, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axhline(95, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)

ax2.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax2.set_ylabel('Cumulative Probability (%)', fontsize=11)
ax2.set_title('Probability of Exceeding Value', fontsize=12, weight='bold')
ax2.set_ylim(0, 100)
clean_spines(ax2)

# Add annotation for "probability of exceeding baseline"
exceed_baseline_pct = (np.array(samples) > baseline).sum() / len(samples) * 100
ax2.annotate(f'{exceed_baseline_pct:.0f}% chance of\nexceeding baseline',
             xy=(baseline, exceed_baseline_pct), xytext=(baseline * 1.1, exceed_baseline_pct + 10),
             fontsize=9, ha='left',
             arrowprops=dict(arrowstyle='->', color=COLOR_BLACK, lw=1))

# Main title
fig.suptitle(f'Monte Carlo Analysis: {display_name}', fontsize=14, weight='bold', y=1.02)

# Add watermark
add_watermark(fig)

# Save PNG to knowledge/figures/ regardless of where Quarto renders from
output_path = get_figure_output_path('mc-distribution-dfda_npv_annual_opex_total.png')
plt.savefig(output_path, dpi=150, bbox_inches='tight', facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title=f'Monte Carlo: {display_name}',
    description=f'Monte Carlo simulation results showing uncertainty distribution for {display_name}'
)

plt.show()
```

**Key Statistics:**

| Statistic | Value |
|:----------|------:|
| Baseline (deterministic) | 4.005e+07 |
| Mean (expected value) | 3.986e+07 |
| Median (50th percentile) | 3.906e+07 |
| Standard Deviation | 8.04e+06 |
| 90% Confidence Interval | [2.751e+07, 5.54e+07] |

*The histogram shows the distribution of dFDA Total NPV Annual OPEX across 10,000 Monte Carlo simulations. The CDF (right) shows the probability of the outcome exceeding any given value, which is useful for risk assessment.*
