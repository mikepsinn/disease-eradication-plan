```{python}
#| echo: false
from dih_models.parameters import *
```

```{python}
import matplotlib.pyplot as plt
import pandas as pd
from pathlib import Path

# Find project root dynamically

# Import centralized style

from dih_models.plotting.chart_style import setup_chart_style, add_watermark, clean_spines
from dih_models.plotting.chart_style import COLOR_BLACK, COLOR_WHITE, add_png_metadata, get_figure_output_path

setup_chart_style()

# Core parameters for the dFDA model (in billions of USD)
# WORST CASE SCENARIO (Conservative) from ../appendix/dfda-cost-benefit-analysis.qmd

global_clinical_trial_market = GLOBAL_CLINICAL_TRIAL_MARKET_ANNUAL
dfda_rd_cost_reduction_pct = TRIAL_COST_REDUCTION_PCT
dfda_annual_operational_cost = DFDA_NPV_ANNUAL_OPEX_TOTAL / 1000  # Convert from millions to billions

# Baseline QALYs generated annually

qaly_gains_annual_baseline = GLOBAL_DFDA_QALYS_GAINED_ANNUAL

# Value of a QALY (standard economic value)

value_per_qaly = STANDARD_ECONOMIC_QALY_VALUE_USD

# Calculations

gross_rd_savings = global_clinical_trial_market * dfda_rd_cost_reduction_pct
monetized_qaly_value = (qaly_gains_annual_baseline * value_per_qaly) / 1_000_000_000  # Convert to billions

# Data for the bar chart

investment_return_data = {
    'Label': ['Investment\n(OpEx)', 'R&D Savings\n(Financial)', 'Health Gains\n(Monetized QALYs)'],
    'Value ($B)': [dfda_annual_operational_cost, gross_rd_savings, monetized_qaly_value]
}
investment_return_df = pd.DataFrame(investment_return_data)

# Create figure

fig, ax = plt.subplots(figsize=(10, 7))

# Create bars with white fill and black edges

bars = ax.bar(investment_return_df['Label'], investment_return_df['Value ($B)'],
              color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=2, width=0.6)

# Apply modern styling

clean_spines(ax, ['top', 'right', 'left'])
ax.tick_params(left=False, labelleft=False)

# Add value labels

for i, bar in enumerate(bars):
    height = bar.get_height()
    if height < 1:  # Small values (OpEx)
        label = f'${height*1000:.0f}M'
        y_pos = height + 5
    else:  # Large values
        label = f'${height:,.1f}B'
        y_pos = height + 5

    ax.text(bar.get_x() + bar.get_width()/2, y_pos,
            label, ha='center', va='bottom', fontsize=36,
            fontweight='bold', color=COLOR_BLACK)

# Title

ax.set_title('dFDA Investment vs. Returns', fontsize=28, fontweight='bold',
             color=COLOR_BLACK, pad=25)

# Clean axis

ax.set_ylabel('')
ax.set_xlabel('')
ax.set_ylim(0, monetized_qaly_value * 1.3)

# X-axis labels

ax.set_xticklabels(investment_return_df['Label'], fontsize=14, color=COLOR_BLACK)

# Add watermark

add_watermark(fig)

# Save figure

output_path = get_figure_output_path('dfda-investment-returns-bar-chart.png')

# Save the figure

plt.savefig(output_path, dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)

# Add metadata for attribution

add_png_metadata(output_path, title="Dfda Investment Returns Bar Chart")

plt.show()
```
