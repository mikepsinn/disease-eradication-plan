```{python}
#| echo: false
from dih_models.parameters import *
```

```{python}
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

# Import centralized style

from dih_models.plotting.chart_style import setup_chart_style, add_watermark, clean_spines
from dih_models.plotting.chart_style import COLOR_BLACK, COLOR_WHITE, add_png_metadata, get_figure_output_path
from dih_models.parameters import format_parameter_value

setup_chart_style()

# Total Benefit Data - comparing one-time disease eradication timeline shift vs other major achievements
# Using 100-year cumulative benefits for ongoing interventions

interventions = {
    '1% Treaty\ndFDA\n8.2 Year\nDisease\nEradication\nTimeline\nShift': {
        'benefit': float(DISEASE_ERADICATION_DELAY_ECONOMIC_LOSS),
        'category': 'proposed',
        'note': 'One-time benefit from eliminating 8.2-year efficacy lag',
        'label': format_parameter_value(DISEASE_ERADICATION_DELAY_ECONOMIC_LOSS, "USD")
    },
    '100 years of\nChildhood\nVaccinations': {
        'benefit': float(CHILDHOOD_VACCINATION_ANNUAL_BENEFIT) * 100,
        'category': 'ongoing_100yr',
        'note': '100-year cumulative benefit',
        'label': None
    },
    '100 years of\nSmoking\nCessation': {
        'benefit': float(SMOKING_CESSATION_ANNUAL_BENEFIT) * 100,
        'category': 'ongoing_100yr',
        'note': '100-year cumulative benefit',
        'label': None
    },
    'Human\nGenome\nProject': {
        'benefit': float(HUMAN_GENOME_PROJECT_TOTAL_ECONOMIC_IMPACT),
        'category': 'historical',
        'note': 'Total economic impact estimate',
        'label': None
    },
    '100 years of\nWater\nFluoridation': {
        'benefit': float(WATER_FLUORIDATION_ANNUAL_BENEFIT) * 100,
        'category': 'ongoing_100yr',
        'note': '100-year cumulative benefit',
        'label': None
    },
    'Smallpox\nEradication': {
        'benefit': float(SMALLPOX_ERADICATION_TOTAL_BENEFIT),
        'category': 'historical',
        'note': 'Total benefit from eradication campaign',
        'label': None
    }
}

# Create figure

fig, ax = plt.subplots(figsize=(14, 8))

# Prepare data

names = list(interventions.keys())
benefits = [interventions[name]['benefit'] for name in names]
categories = [interventions[name]['category'] for name in names]

# Use a large placeholder value for the disease eradication bar to make others invisible
# Similar to the ROI infinity chart approach
# Set the max to 50000, and scale all others down proportionally to keep them tiny

max_idx = benefits.index(max(benefits))
max_benefit = max(benefits)

# Scale all values: max becomes 50000, others become proportionally tiny
# This ensures the max bar dominates while keeping relative proportions
display_benefits = []
for b in benefits:
    if b == max_benefit:
        display_benefits.append(50000)
    else:
        # Scale down: if max is 1000x bigger, the small one becomes 50 (1000x smaller than 50000)
        scaled = (b / max_benefit) * 50000
        display_benefits.append(max(1, scaled))  # Ensure at least 1 pixel height

# Define colors and patterns for categories

category_styles = {
    'proposed': {'color': COLOR_WHITE, 'hatch': '///', 'edge': COLOR_BLACK},
    'historical': {'color': COLOR_WHITE, 'hatch': '...', 'edge': COLOR_BLACK},
    'ongoing_100yr': {'color': COLOR_WHITE, 'hatch': '', 'edge': COLOR_BLACK}
}

# Create bars

x_pos = np.arange(len(names))
bars = []

for i, (name, benefit, cat) in enumerate(zip(names, benefits, categories)):
    style = category_styles[cat]
    display_val = display_benefits[i]

    # Create bar
    bar = ax.bar(x_pos[i], display_val, width=0.7,
                 color=style['color'], edgecolor=style['edge'],
                 linewidth=2, hatch=style['hatch'])
    bars.append(bar)

    # Add labels
    if i == max_idx:
        # This is the dominant Disease Eradication Timeline Shift bar - place text INSIDE with white box
        ax.text(x_pos[i], display_val * 0.70,
                name,
                ha='center', va='center',
                fontsize=22, color=COLOR_BLACK, weight='bold',
                linespacing=1.1,
                bbox=dict(boxstyle='round,pad=0.8', facecolor=COLOR_WHITE,
                         edgecolor=COLOR_BLACK, linewidth=2, alpha=0.95))
        ax.text(x_pos[i], display_val * 0.35,
                format_parameter_value(benefit, "USD"),
                ha='center', va='center',
                fontsize=36, color=COLOR_BLACK, weight='bold',
                bbox=dict(boxstyle='round,pad=0.6', facecolor=COLOR_WHITE,
                         edgecolor=COLOR_BLACK, linewidth=2, alpha=0.95))
    else:
        # Small bar - place label above
        combined_label = f'{name}\n{format_parameter_value(benefit, "USD")}'
        ax.text(x_pos[i], 2000,
                combined_label,
                ha='center', va='bottom',
                fontsize=11, color=COLOR_BLACK, weight='bold',
                linespacing=1.3)

# Axis formatting - remove both x-axis and y-axis

ax.set_ylabel('')
ax.set_xlabel('')
ax.set_xticks([])  # Remove x-axis ticks and labels
ax.set_yticks([])  # Remove y-axis ticks

# Y-axis formatting - make disease eradication bar dominate, start at 0 to prevent text cutoff

ax.set_ylim(0, max(display_benefits) * 1.05)

# Title

ax.set_title('Economic Impact: dFDA Timeline Shift vs. Major Public Health Achievements',
            fontsize=22, color=COLOR_BLACK, weight='bold', pad=15, y=0.98)

# Add explanatory callout

daily_deaths_formatted = format_parameter_value(GLOBAL_DAILY_DEATHS_CURABLE_DISEASES, "deaths")
efficacy_lag_formatted = format_parameter_value(EFFICACY_LAG_YEARS, "years")
deaths_formatted = format_parameter_value(DISEASE_ERADICATION_DELAY_DEATHS_TOTAL, "deaths")
dalys_formatted = format_parameter_value(DISEASE_ERADICATION_DELAY_DALYS, "DALYs")
qaly_value_formatted = format_parameter_value(STANDARD_ECONOMIC_QALY_VALUE_USD, "USD")
total_formatted = format_parameter_value(DISEASE_ERADICATION_DELAY_ECONOMIC_LOSS, "USD")

callout_text = f'Calculation:\n{daily_deaths_formatted}/day from curable diseases\n× {efficacy_lag_formatted} × 365 days = {deaths_formatted} avoided\n× 19.1 DALYs per death (average) = {dalys_formatted}\n× {qaly_value_formatted}/QALY economic value = {total_formatted}\n\nMechanism: dFDA enables patient participation\nin Phase 2/3 efficacy trials, providing treatment\naccess and generating safety/effectiveness data\n{efficacy_lag_formatted} earlier than current system.\n\nConservative estimate: Does not include 115x\nresearch acceleration effects or reduced\nbarriers to entry for new treatments.'

ax.text(0.62, 0.45, callout_text,
        transform=ax.transAxes, ha='center', va='center',
        fontsize=13, color=COLOR_BLACK,
        bbox=dict(boxstyle='round,pad=1.0', facecolor=COLOR_WHITE,
                  edgecolor=COLOR_BLACK, linewidth=2, alpha=0.98),
        linespacing=1.4)

# Clean spines - remove all spines since no axes

clean_spines(ax, ['top', 'right', 'left', 'bottom'])

# Add watermark

add_watermark(fig)

# Save figure

output_path = get_figure_output_path('disease-eradication-timeline-shift-total-benefit-comparison-column-chart.png')

plt.savefig(output_path, dpi=200, bbox_inches=None, pad_inches=0.1, facecolor=COLOR_WHITE)

# Add metadata

add_png_metadata(output_path, title="Disease Eradication Timeline Shift Total Benefit Comparison")

plt.show()
```
