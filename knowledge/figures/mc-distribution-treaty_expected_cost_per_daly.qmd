```{python}
#| echo: false
#| fig-cap: "Monte Carlo Distribution: Expected Cost per DALY (Risk-Adjusted) (10,000 simulations)"
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines, get_tick_formatter,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata, get_figure_output_path
)
from dih_models.parameters import format_parameter_value

setup_chart_style()

# Simulation results
samples = [0.5603678247247738, 0.3974934357571318, 0.4112298658043183, 0.5335313360537173, 0.2469777213840474, 0.23246541718877356, 0.4545780126290208, 0.7361343153533693, 0.427038416365864, 0.2454736917439552, 0.8670528188784201, 0.4757753390889034, 0.31226407361798403, 0.7264991395506738, 0.5284256989447743, 0.48404972595783263, 0.8068345376241264, 0.6835359643908565, 0.49638495416001793, 0.428930631468688, 0.4200730102015031, 0.6506027915020102, 0.4307678486869627, 0.9359029376756018, 0.3592460867431814, 0.43810891632097054, 1.1950998530535257, 0.3863997730271118, 0.5583349519862957, 0.2568012968825966, 0.8213889430386712, 0.2422182726192234, 0.6673172882780661, 1.190902051921748, 0.31023962950908, 2.10381850371208, 0.9122543363291566, 0.2996130669768985, 0.4655438268933217, 0.5567877462562623, 0.3320126879455781, 0.3703997041375155, 0.5581065515939991, 1.755537215250826, 0.7636850493493857, 0.725951166881303, 0.3829353066935436, 0.2664179836090206, 1.294092117077508, 0.5596295364552363, 0.2997320389519624, 0.6894367118948764, 0.2760103550778067, 0.3580887444019555, 0.35690630225401426, 0.529118305692539, 0.8532211701170624, 0.6745723215806768, 0.3159363064507026, 1.9015228283384307, 0.17979353162170703, 2.2447127891181027, 2.116990850787366, 1.0583894894857426, 0.7257525948237508, 0.5824312281604245, 0.4820919643683984, 0.4405804735608571, 0.8404929687670056, 0.23883989952881, 0.4853191130661275, 0.42295102825528086, 0.8806780107021833, 0.5953555357520538, 0.2883247053585625, 0.3230020547378839, 0.30246821713751415, 0.4901454764223515, 0.5817170004920934, 0.30508734705940066, 0.6824419356828985, 0.33260011605956996, 0.4120861436860817, 0.4258293909508119, 0.24881302659718096, 1.2297209183497084, 0.3873170523178589, 0.25615258880031677, 0.6050703216318699, 0.4666988798067723, 0.5481364605577334, 0.5900435414177914, 1.296325777940935, 0.9867856828936898, 0.2766184728474031, 0.18651521846549732, 0.7228231220183443, 0.6952135222924581, 0.43934058062821746, 0.3668835345919226, 0.35740291524799894, 0.5271447901650143, 0.6739302036247208, 0.5769088517978144, 0.3311227681410134, 0.25310855773816315, 0.46115140085568707, 0.5030248675345912, 0.30899900515659645, 0.6566862918090902, 0.334364338690678, 0.7047323669873293, 0.35753725872905184, 0.33301480334313793, 0.8931731647457005, 0.585812333513878, 0.49124248806126597, 0.9577115243137291, 1.0378263423545033, 0.3878255652394685, 0.419312442459681, 0.5511887800243491, 0.4966679017549456, 0.7616774385949019, 0.5837555404923256, 0.570075342575279, 1.1018456866665773, 0.21446516356492518, 0.21302095651988218, 1.1781266584869803, 0.39824428462508626, 0.22487532462224366, 0.4599718845435041, 0.3004146072082377, 0.4179055704138335, 0.9531353335488016, 1.7415064966866456, 0.4926440390911082, 0.7823665706682997, 0.7923050769602732, 0.4640630508552767, 0.7566929137220529, 0.37458177314337693, 0.3562170402283347, 0.24641240339964465, 0.43860635326027364, 0.2617312329186577, 0.6893640569778102, 1.2948571265776476, 1.7703837767682808, 0.42410319684748465, 0.5914200812413148, 0.4146270051212109, 0.8005953970405965, 1.0508361080492699, 1.2724838493061272, 0.33379903384878756, 0.80953499832332, 0.34243552434092395, 1.165411508213888, 0.4821282423382139, 0.5696153993733237, 3.304389146289214, 0.6119122870720901, 1.3039516360790213, 0.3149544105741817, 0.3784985429151122, 0.25472010692766234, 0.7892184425055829, 1.1787560973449853, 0.27801377340690514, 0.6626288242828001, 0.48056793108778645, 0.23304554471201763, 0.26523731881402746, 0.5723531893517817, 0.5143194631914815, 1.1772477433767827, 1.192728886033883, 0.823029265707652, 0.48824590808149454, 0.37938709576762264, 0.546017826536773, 2.352969770830664, 0.3613296675650404, 0.6239846620281646, 0.5587409230228063, 1.5396268353191336, 0.7334333475837216, 0.337745035643868, 0.5226230174070304, 0.23061668051095352, 0.48357433536018196, 0.5222365257092255, 0.2888265414643121, 0.2479535718978307, 0.4227702160840684, 0.4530224963633645, 0.27084316507691997, 0.3628150590447321, 0.9233618908168685, 2.8138532043260125, 0.2852806775084378, 0.664825112767647, 0.35394300893689423, 0.5913393408454479, 0.5416554221973724, 0.32256962035092845, 0.4704274958042775, 0.6388822918085874, 0.3792088884410823, 0.5500734790423487, 0.3883706149841871, 0.25783971191248, 0.22475189217239572, 0.9217488683226307, 0.5339203762706238, 1.0901029758972653, 0.4786230339662798, 0.6563135938528021, 0.23383595141433655, 0.5166861163995184, 0.3556826189998998, 1.1156644377846507, 0.7168180306569033, 0.5099944608314352, 0.7111981064074699, 0.6399690318285741, 0.496410472581122, 0.840537015733059, 0.36687632675826803, 0.2571970326537371, 0.48513359772894316, 0.6386918030541786, 0.5973692489678095, 0.2953304167286758, 0.25689365444952844, 0.4265684241750532, 0.3994281866262971, 1.6225261496871888, 0.552008383830015, 0.7472924954726988, 0.6554645272559237, 0.5710704501012409, 0.8975892642831453, 0.9727136455767508, 1.1382186547626774, 0.6927455048839755, 1.8537784477567403, 0.43521135743975903, 0.6096864688845058, 0.4983094036534444, 0.8464153378033912, 0.38489770299330983, 0.8564834609293627, 1.0635122519276872, 0.7073321141310804, 0.237139409815463, 2.3173467093347413, 0.22860868665464978, 0.8310036988543649, 0.2795342152019443, 0.330062531336419, 0.46100586884582045, 1.1765011309024938, 1.450911369423849, 0.47327975503079184, 0.5661388221441919, 1.408488947154101, 0.5230864427047162, 1.0661378298217157, 0.7759704620930807, 0.42313401161850867, 2.0672107796804196, 1.1330346919489016, 0.6352964782152042, 0.3149352579219032, 0.3956286013285848, 1.212780051602589, 0.5669961530239377, 0.4835290994053963, 0.6582716067875416, 0.6216426372670972, 0.32651344879805166, 0.6820370107773392, 0.28877761466026863, 0.28682212339234797, 0.8154777695431995, 0.7663546131153266, 0.29899450302298397, 0.6633195452883324, 1.096993002821242, 1.2650716141599252, 0.1570221049829576, 1.2502368604596426, 1.494252643813458, 0.5459057378130576, 0.26305036139411747, 0.3107593331240949, 0.4247091069558719, 0.3230141215403463, 0.6151265718179594, 0.5170643017215355, 0.841965273065384, 0.5249897846600562, 0.4593921339934796, 0.3801131772906786, 0.5209665572375433, 0.8834940472581289, 1.3415428759122432, 1.1219451552437674, 0.25717827520750375, 0.921532114716095, 1.056083197741669, 0.3584301603868005, 0.6597936707498075, 0.6719089464456036, 0.5444049568889724, 0.5247971802134929, 0.262075821678472, 0.8620873397273734, 0.2991527051012555, 0.47604264626288567, 0.7212718558136283, 0.47333713042858166, 0.35168565310685007, 0.3474499166994356, 0.23520073035987002, 0.24075576877119886, 0.36489706099795194, 0.37604259393316064, 0.3184676100584562, 1.5851355353134067, 1.4402178462909134, 1.0137590860041592, 0.245419393164963, 0.5594148987335764, 1.2784876402429632, 0.8887575699446872, 0.48218556568373305, 0.24841557036833978, 0.7688920169517693, 0.39356432163756466, 0.40405766080933775, 0.334983523855691, 0.3212124782759272, 0.21479433252954921, 0.6230575895506444, 0.5444258172440185, 0.4201213267095237, 0.27454641036635047, 1.2486316691875803, 0.7110490356996522, 0.5012661870624316, 0.37028185946131065, 1.1077573307308937, 0.4926577881133217, 0.26245721509458236, 0.3560953862098483, 0.49896180994022826, 0.23275248260331266, 0.378876176452984, 0.37712982393922717, 0.21602421748476175, 0.3615045239207145, 0.7110105280507438, 0.3177087687109309, 0.3632797698801455, 0.6670934924476193, 0.2763902456467387, 0.36897466021609543, 0.391135139630052, 0.41602308540643407, 1.4150960136825332, 0.4247048136600436, 1.008641858959473, 0.7993720188173208, 0.3556466255773036, 0.7095641213936338, 0.230376043630828, 0.6474948380016621, 0.9249369399747954, 0.49371747170674724, 0.2665320811260084, 1.005068792036715, 0.30621371876564935, 0.4928461063301713, 0.3906443404793626, 0.5354456787759772, 0.2807554492159695, 0.23854880978758083, 0.7449788877793695, 1.177063377421741, 0.39528683787310653, 0.41217306295127276, 0.46172156265132547, 2.1344898425895926, 0.4441583873268915, 0.9304446823632107, 0.30709965550186624, 0.2340068701789255, 0.32845691489255824, 0.6611067271807713, 0.5212763402227663, 1.3792782540177162, 0.6353914339555973, 0.45023567139312964, 0.3213610554276597, 0.484560201300506, 0.2636114584455079, 0.28421499325233995, 0.8187168105656935, 0.4277955440463025, 0.43402791641699207, 0.4870924344214701, 0.24641900341383674, 0.40762932798718043, 0.5518616247342911, 0.4431575602031666, 0.37033231091664354, 1.0949181380099178, 0.5246153145709292, 0.4231100822693318, 0.3683667825938821, 0.6346816748426825, 0.3824129405988924, 2.743921075733165, 0.5858021394710307, 1.884460441712546, 0.44664761902308964, 0.6020043110504495, 0.290479920104304, 0.6553971163591925, 0.258514210594014, 0.39597051800423777, 0.6246145474542658, 0.7894758064350066, 0.455966771606544, 0.5306451896290139, 0.7044198475129396, 0.3870052324351805, 0.9341332568090971, 0.7132187268950366, 0.7598205001642561, 0.2762964197893821, 0.5136643630870367, 0.45332738248908594, 0.22460339242562188, 0.4121508165353081, 0.5743013109284597, 0.47135136419142065, 0.4017740516707284, 2.591561648283809, 2.7791533420524024, 0.8321053210670166, 0.7242644346312637, 0.5467352802284298, 0.49564126406708514, 0.45733198678687714, 0.44651442803448055, 0.3583918546535213, 1.2212836357462633, 0.3102898597892532, 0.2316508513247701, 0.20525039292632544, 1.159828189786021, 0.5302302739558866, 0.5557748224215625, 0.687090698623823, 0.20178146250937207, 0.32471064241613323, 0.4394050030616103, 0.31650155489051773, 1.9743251470612468, 0.3570191897358494, 0.3048468513104317, 1.2471649814201462, 0.3896994184008387, 2.3824498797533322, 2.6883061430470994, 0.2636098926057711, 1.4246473564478084, 0.8867819458964662, 0.2637329842296209, 0.7930512207364594, 1.220708125107412, 1.257310819202769, 0.4145377844124117, 0.5377642375400229, 0.6424182478191851, 0.7822105868091049, 0.6913653810270753, 0.869161953305417, 0.41987607189847564, 0.33911574662265165, 0.6242485450164922, 0.37613378499799505, 0.4749025498899877, 0.3005105980919616, 0.18511154598835672, 0.7580319003972537, 1.3418024385602851, 0.23963614715974166, 0.3086772855720567, 0.18656453135374432, 0.3209615372210152, 3.6728266246168104, 0.6285613589478318, 0.4256206422357936, 0.5665435879253737, 0.43735264954073577, 0.2956809816914734, 2.279994605907256, 0.4275279230967142, 0.5224838474282101, 0.44038453870288796, 0.4364326469428096, 0.3051095668421929, 0.5724472017212426, 3.175092580295608, 1.117353558368179, 0.38423993389187167, 0.6064162307499705, 0.5831348242019492, 0.4831237843658624, 0.7739814301290083, 1.1246258493552586, 0.4007236113379895, 0.5432049510729082, 0.4342191985383447, 0.8323607241663908, 0.36665453524274044, 0.45246555265463906, 0.5304335043569137, 0.7939936956224031, 0.6299468836027534, 0.5427721531250891, 1.048099741592575, 0.33880542736148134, 0.8181177747805025, 0.5615601125808868, 0.5071196805850037, 0.669947566810941, 0.46026692913873996, 0.22766903701185753, 1.4594932244669274, 0.30447092793945585, 0.7831372337480677, 0.5902566267665079, 0.7697994468762962, 0.3215880418524572, 0.519185958638953, 0.2736319779296185, 0.6076268044819941, 0.4877932882405102, 0.9386814524907273, 0.2363498811312084, 0.679770785553329, 0.32843533492421406, 0.20425954784573114, 0.27614303486700065, 0.4180047465404788, 0.48927376074054396, 0.49816934094026255, 2.791459670998612, 0.5428692487085033, 1.8967454819689473, 0.3569009871432471, 1.0015249180208656, 0.41303541435633984, 0.38425462738367094, 0.3752046006530835, 0.42863996628937096, 0.20388822583604926, 0.3012094773395423, 0.5340109529363042, 0.46857913826631975, 0.41998586515860437, 0.9862326784938821, 0.5906768956556396, 0.8604283196086068, 0.3053369817129432, 0.3778902611309609, 0.2168179342535228, 0.2700739364313678, 0.4962000771983307, 0.2731363463386938, 0.32538197993369244, 0.6649447472484137, 0.35610513451968745, 0.22552726596774433, 0.6162267462306339, 0.6707039970368882, 0.31231773628062937, 0.30455164395340345, 0.24339600677807613, 0.2174009804384501, 1.260489358657892, 0.5510286206179832, 0.5098821496102061, 0.9663630582809297, 1.9491288866471939, 2.634018287317782, 0.8027182390855716, 2.131346698360645, 0.8910393227667537, 0.38988202967861807, 0.9027633481610028, 0.8767842192188123, 0.41824536724752776, 0.2785564970608026, 0.33990130632820864, 0.28625386010309795, 0.2575087576709014, 0.8810314049818284, 0.5201853326316795, 0.390567492127919, 0.36426468941563356, 2.1395799357627636, 0.3628455176174512, 0.5052346472319569, 0.3194721218659712, 0.4527145798966552, 0.2892324085658971, 0.8487389798996007, 0.4046235030517869, 0.3250895466016396, 0.9352610501337704, 0.40101317347768817, 0.24789547274912893, 1.2103997245903528, 1.0931929466240218, 0.3189078388206515, 0.3163145616246709, 1.6154694720734741, 0.48707130793899384, 1.0644302672560828, 0.3287253758642424, 2.1089512002621373, 0.5519333082181106, 0.5858283335268515, 1.0942698402285178, 0.6913711271016205, 0.5279559683034231, 1.195851230528284, 0.36207576140267345, 0.5189593863933918, 0.4791473914162587, 0.3200702491571912, 0.5361623520164424, 0.4336996222976534, 0.7583454360591929, 1.9141793311899356, 0.42215989727373454, 0.55860069645588, 0.8146202803991709, 0.683543854679064, 0.4099055755106626, 0.8491317199138563, 0.4525997471693668, 0.30817786204512626, 0.4736271715002103, 0.20379541839926887, 0.6280507461632776, 0.9616312682725217, 0.36188302059172506, 0.34100754003311134, 1.1469553720330035, 0.40909512680112176, 0.2822015257218985, 0.5367341718894987, 0.4679160919536618, 1.1399213588014767, 0.6261776698172442, 0.43987055018368826, 1.424456288363402, 0.3866380448543605, 0.6907848459798627, 1.0645006108063797, 0.34545017493057145, 0.3730940519989311, 0.6487989460398392, 0.8807816652014845, 0.5219777673042354, 0.7544312326048198, 0.23457656412823785, 0.3365727197719153, 0.44215904088186486, 0.3251741439270885, 0.5018289756516479, 1.9351610920776237, 1.121288189014098, 0.4981098628662212, 0.7262020711268181, 0.417042419105005, 0.8380155014931056, 0.3212250224808444, 0.5222873859437392, 0.677072977316515, 0.4646937532347523, 0.3374799704577852, 0.2807007608254785, 0.8670827127798786, 0.5663054512210822, 0.5364369626599024, 0.28944373683174973, 0.7433925782440657, 0.3018008876422952, 0.822824559281296, 0.52094658423299, 0.3860603692373034, 0.8570782834723574, 0.39440162945292595, 0.6644528489494027, 0.3658699309771378, 0.6297102012099088, 1.2596597895358501, 0.3811606099530151, 0.7663914622008989, 0.6242903098957822, 0.44813247045903015, 0.559022423669478, 0.45533235577918185, 0.39146051283713174, 0.5106334899994899, 1.298325215666218, 0.5241228710025893, 0.7137704821833176, 1.9594924165636622, 0.26387308749203436, 0.4203965800368049, 0.3788795077361743, 0.8186431577473078, 0.23028901186948478, 0.269959302375945, 0.302818159811999, 0.5822156923812082, 0.4375816519159142, 0.24968546197866617, 0.2901954339616968, 1.3974657558953052, 0.8781722728149142, 0.25958633671410647, 0.3892155346610542, 0.656597649989416, 0.5910389936785607, 2.2954034035965445, 0.4130821821771084, 0.42601835340710725, 1.216412721683666, 0.7186800073497327, 1.0873852062539573, 0.3298923176395596, 0.8934246572877995, 1.2385416238883848, 0.30748451297097434, 0.300093624477085, 0.6000174097051073, 0.545116136753435, 0.5615421637444252, 0.5859350826635127, 0.7851693779179023, 0.28242703448864837, 0.4330827338135822, 0.6260029746399307, 0.35886757709770334, 0.5728596768875002, 0.7720551574547692, 0.24369579634075844, 2.8362877768949306, 1.1050361468617496, 0.3848638313101722, 0.31064727692834776, 0.700052861337083, 0.843458211848019, 0.9106256723169126, 0.42510530788753714, 1.1791173184741988, 0.44064257596873424, 0.3114213801780076, 0.528270881822875, 0.43404038269389705, 0.5007597164380825, 0.5923472819636313, 0.51221800289677, 0.24865048590345104, 0.4208420168508246, 0.34844875193014807, 0.3639741534194041, 0.46309001707580155, 0.413473845661192, 0.30183665051589725, 1.3489586862630878, 0.3351994593318782, 0.3817885602529533, 1.4768417848779662, 1.094533456992125, 1.0676374398644761, 1.6304700617344632, 0.5027924989317277, 0.3541597193294062, 0.5432854587168618, 0.7007616645750734, 1.1021412822715626, 0.495711329252749, 0.36577266234439376, 0.6602679298467914, 0.555817097072418, 0.32915601833234587, 0.4963481660158836, 0.7293972631916832, 0.4431172573781383, 1.254921934536118, 0.6060247449922854, 0.5793338851897428, 0.4663204957378037, 0.2861659317502592, 0.4331155292457272, 0.5625228391328504, 0.4067451596854302, 0.6988110162722987, 0.49351737761206893, 0.21850444354740672, 0.36299570211545884, 0.28229426904682775, 0.7849381289979076, 0.3870062725268818, 0.33356460046334624, 0.49384783917063996, 0.18451445831386187, 0.3673734352393863, 0.5170888315444503, 0.37858229622440587, 0.4333829319335966, 0.5807873704105525, 1.5284789135273449, 0.3287169951411864, 0.4754417476024319, 0.4784287262706199, 2.2443029823842022, 1.235208332775734, 0.5212460033820944, 0.735019575256278, 0.3750517982164905, 0.6099529187428326, 0.9854127445144611, 0.49483306665879534, 0.3942420835696834, 0.6464399653308648, 0.37834440775478223, 1.84170880535417, 0.4328754079606186, 0.4064526488942231, 0.283463659234167, 2.499644797229904, 0.9866509303062636, 0.5051582111301584, 0.6581112679540592, 0.4868400022779073, 0.4717889743235896, 0.5548784649875657, 0.20524954194303402, 0.2973584160124947, 0.4286888807410411, 0.30514798804137117, 0.4975721650589549, 0.2735256136464242, 0.5266265890573567, 0.21502287947035406, 0.24751347617002945, 2.4997723781079153, 0.7145421193321374, 0.47650255761219035, 0.35820633872607704, 0.6189133844779041, 0.234312814428124, 0.6724058778462375, 0.4316748103802363, 0.44428066505594316, 0.7708872204344724, 0.4349291645908399, 0.8054307262255496, 0.7766417209067343, 1.6963869346255078, 0.2832663109272414, 0.44355899388928527, 0.5595945856221505, 0.8100963292392198, 0.38868763465560746, 0.3108302141298368, 0.5659410698396069, 0.25512193394548255, 0.32696737533952247, 0.4903414256185994, 0.4037125580255383, 2.295914444297228, 1.7799385373158298, 0.7467538924969881, 0.43708439449554043, 0.2593144980211289, 0.2549343498401501, 0.5046644637762524, 0.34015484703194804, 0.38803615222040505, 0.5982772905247663, 0.8493678636270487, 0.6533494634861375, 0.7538122194453949, 0.2409239545069408, 0.4259302650220875, 0.3333679943988059, 0.25526651787911303, 0.27256150979667165, 0.9946083610936978, 0.6281546271845531, 0.49966832470056705, 0.33920438129833386, 0.5028961270352692, 1.2144519786671264, 0.3977847892590795, 2.2513262464215447, 0.3430986817333909, 0.36550656453708236, 0.45173461353795435, 0.2914269712664107, 1.2110175815592714, 0.38129495147538306, 0.7033934419828856, 0.6366594697303828, 0.7015656876620867, 0.39018526433891537, 0.48306496530671794, 0.5747193120187603, 0.4608806233597216, 0.5687706638702998, 0.5984484628466803, 0.2162781291068319, 0.8920465126387864, 0.9120027774901669, 0.317013192581384, 0.34277004413175516, 0.7039776246554341, 0.7500910868431058, 0.8182905148059577, 0.33287862014653363, 0.5143500154502576, 0.8655497111248672, 0.18841431239104306, 1.0113307943246437, 0.2963093799416718, 1.1321117301657793, 0.9807926188827161, 0.8941843239855244, 1.9523858535503882, 0.3479592741107434, 0.6479802631213024, 0.7110609379940227, 0.5066516769863217, 0.7468173244395312, 0.38288641788546335, 1.0605143088326492, 0.3754532478812531, 1.0713357504413965, 0.4653783847098585, 0.40465236355869183, 0.9291708466286047, 0.8286267574480567, 0.623691909596092, 0.5361668898395325, 0.4440538962596912, 0.9050250416017233, 0.4635005181521826, 0.40321827252745795, 0.49368253800021805, 0.4126261271443203, 0.46783555393220283, 0.6277196575530937, 0.9763637388018926, 0.45271224897415774, 0.2573940867079853, 0.5179276185946861, 0.30454534036690895, 0.49015159376553913, 1.0765726788142316, 0.5091572214556688, 0.5788033589225084, 0.21836377034908522, 0.6654680922982653, 0.2899332125352858, 0.6719325116077345, 0.47795461215455787, 1.3026952130117664, 0.5253981451403991, 0.9255904042620784, 1.4151766028510318, 0.8354961198727712, 0.4595881898320311, 0.4936648529732375, 1.3862667811798768, 0.477916989820932]  # Truncate for embedding
baseline = 0.5036017869671499
mean = 0.6480395732240872
std = 0.44906694232080624
p5 = 0.24242537180141888
p50 = 0.5090516786669004
p95 = 1.5850623481016508
display_name = "Expected Cost per DALY (Risk-Adjusted)"
units = "USD/DALY"

# Create figure with two subplots
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))
fig.subplots_adjust(wspace=0.3)

# --- Left: Histogram ---
# Handle edge case where all samples are identical (zero variance)
if std == 0 or (max(samples) == min(samples)):
    n_bins = 1
else:
    n_bins = min(50, max(1, int(np.sqrt(len(samples)))))
n, bins, patches = ax1.hist(samples, bins=n_bins, color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)
ax1.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key statistics with formatted values in legend (use format_parameter_value for full units)
ax1.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=2, label=f'Median: {format_parameter_value(p50, units)}')
ax1.axvline(p5, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'5th %-ile: {format_parameter_value(p5, units)}')
ax1.axvline(p95, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'95th %-ile: {format_parameter_value(p95, units)}')
ax1.axvline(baseline, color=COLOR_BLACK, linestyle='-', linewidth=1.5, alpha=0.5, label=f'Baseline: {format_parameter_value(baseline, units)}')

ax1.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax1.set_ylabel('Frequency', fontsize=11)
ax1.set_title('Distribution of Outcomes', fontsize=12, weight='bold')
ax1.legend(loc='upper right', fontsize=9)
clean_spines(ax1)

# --- Right: CDF (Cumulative Probability) ---
sorted_samples = np.sort(samples)
cumulative = np.arange(1, len(sorted_samples) + 1) / len(sorted_samples)

ax2.plot(sorted_samples, cumulative * 100, color=COLOR_BLACK, linewidth=2)
ax2.fill_between(sorted_samples, 0, cumulative * 100, alpha=0.1, color=COLOR_BLACK)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)
ax2.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key percentiles
ax2.axhline(50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)
ax2.axhline(5, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axhline(95, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)

ax2.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax2.set_ylabel('Cumulative Probability (%)', fontsize=11)
ax2.set_title('Probability of Exceeding Value', fontsize=12, weight='bold')
ax2.set_ylim(0, 100)
clean_spines(ax2)

# Add annotation for "probability of exceeding baseline"
exceed_baseline_pct = (np.array(samples) > baseline).sum() / len(samples) * 100
ax2.annotate(f'{exceed_baseline_pct:.0f}% chance of\nexceeding baseline',
             xy=(baseline, exceed_baseline_pct), xytext=(baseline * 1.1, exceed_baseline_pct + 10),
             fontsize=9, ha='left',
             arrowprops=dict(arrowstyle='->', color=COLOR_BLACK, lw=1))

# Main title
fig.suptitle(f'Monte Carlo Analysis: {display_name}', fontsize=14, weight='bold', y=1.02)

# Add watermark
add_watermark(fig)

# Save PNG to knowledge/figures/ regardless of where Quarto renders from
output_path = get_figure_output_path('mc-distribution-treaty_expected_cost_per_daly.png')
plt.savefig(output_path, dpi=150, bbox_inches='tight', facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title=f'Monte Carlo: {display_name}',
    description=f'Monte Carlo simulation results showing uncertainty distribution for {display_name}'
)

plt.show()
```

**Key Statistics:**

| Statistic | Value |
|:----------|------:|
| Baseline (deterministic) | 0.5036 |
| Mean (expected value) | 0.648 |
| Median (50th percentile) | 0.5091 |
| Standard Deviation | 0.4491 |
| 90% Confidence Interval | [0.2424, 1.585] |

*The histogram shows the distribution of Expected Cost per DALY (Risk-Adjusted) across 10,000 Monte Carlo simulations. The CDF (right) shows the probability of the outcome exceeding any given value, which is useful for risk assessment.*
