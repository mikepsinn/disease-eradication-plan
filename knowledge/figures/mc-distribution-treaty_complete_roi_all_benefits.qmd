```{python}
#| echo: false
#| fig-cap: "Monte Carlo Distribution: Treaty ROI - Lag Elimination (PRIMARY) (10,000 simulations)"

import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines, get_tick_formatter,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata, get_figure_output_path
)
from dih_models.parameters import format_parameter_value

setup_chart_style()

# Simulation results

samples = [1267433.8166522104, 1192790.6200928034, 1269362.3399454076, 1267740.9539968157, 1158130.2397094106, 1162393.8703409845, 1264077.2458607256, 1247906.1784101569, 1260087.2087549963, 1210879.1789230476, 1268404.2122315422, 1269210.797311154, 1262514.5509859317, 1264951.9732373701, 1269156.9339912527, 1210320.6110299628, 1268261.4141695998, 1200991.89106271, 1268413.4598085468, 1259006.7203533803, 1253932.0696674546, 1225061.0565423435, 1263117.8785136975, 1255168.9345550889, 1241873.1430318644, 1246065.7775336385, 1269503.464936304, 1268223.5184170716, 1268716.2187961645, 1268877.0038783855, 1152850.760331743, 1243119.1596885468, 1236794.6512506166, 1214318.5627200634, 1269680.9691283712, 1264921.0196133915, 1256735.73090646, 1212021.3686019895, 1213392.8378033407, 1269668.4726013546, 1269397.4785832004, 1269543.3904037017, 1226220.7066909606, 1266251.4900343532, 1263810.6148151155, 1266002.6034613417, 1268480.9894402148, 1266094.3315624634, 1269621.8941234327, 1262556.2578183254, 1267201.871160706, 1269681.5262794094, 1141504.9610396237, 1247734.0369979155, 1239389.9452788557, 1228181.6659022884, 1249910.059963449, 1256542.6251632725, 1209732.7609443525, 1267398.2651419044, 1112387.0708586345, 1246960.8564524758, 1264868.6520490472, 1269651.9259541947, 1269529.5267634657, 1269111.9604852167, 1246244.217605719, 1239873.1125245164, 1268605.4667790944, 1253662.0635557256, 1165742.9116995495, 1182665.1615907226, 1204781.9664266803, 1269338.6534547138, 1264415.785325482, 1269593.582531327, 1241935.0448827052, 1264776.5859315062, 1269682.452572321, 1248250.0840349386, 1269081.3854316217, 1226487.6686518332, 1245488.8652059871, 1244483.3048956105, 1175453.4503525782, 1269280.656170175, 1239448.6357184048, 1260990.0925842538, 1269242.931719705, 1269004.3984834712, 1269648.1873601777, 1257306.5266816996, 1242162.0344946953, 1257980.1558019745, 1113148.2789265348, 1142926.852877953, 1159755.8810898813, 1197180.963361231, 1268591.6766174773, 1206094.5513274858, 1244677.5385444795, 1261457.5770307875, 1245848.504843049, 1269424.0699833026, 1203435.0661719295, 1253060.6339055516, 1201854.7119619725, 1246747.4017522014, 1268759.0755633635, 1119967.6025699114, 1268907.2209203865, 1266351.7466569329, 1231356.9135194488, 1143075.6064057606, 1262678.0591039078, 1235689.4223878223, 1266260.8181422965, 1261268.196400723, 1253489.744921201, 1251566.1260990947, 1194502.4966156236, 1265220.632877264, 1266027.1778454895, 1260051.4996707968, 1268802.1081979268, 1268122.840278809, 1257398.9247014783, 1176286.6093304695, 1228118.1734840134, 1204106.6737904714, 1244041.6223782217, 1152630.436540236, 1269680.136822235, 1252330.1067176084, 1139557.021394655, 1195316.545457996, 1267559.3348994332, 1268777.259061748, 1181860.0967155474, 974274.6684665387, 1268731.76133214, 1197956.5499545068, 1188906.088518845, 1266863.8233326743, 1214390.0780154709, 1242614.6383816937, 1230100.5389186435, 1255710.5610174127, 1265988.9028483965, 1264743.7786229197, 1255004.8461775552, 1193242.4838429356, 1110991.3711339426, 1238416.714787986, 1258876.7700327223, 1229614.193660491, 1264134.5374398283, 1267209.2443082386, 1237610.3377240312, 1176734.428429554, 1200380.933689116, 1221629.7751621231, 1155449.436052796, 1213661.2842600825, 1268774.2471253162, 1206332.5454698037, 1267846.5526930566, 1268439.5506245128, 1255084.793279942, 1259311.997581178, 1227016.5508946318, 1269000.838302202, 1240313.0273324884, 1171900.2216991028, 1165460.805879741, 1265079.897126097, 1254158.1459413099, 1264808.416453051, 1256559.7246494468, 1267151.3568915878, 1261303.3785375936, 1266015.6516811897, 1242865.2625544486, 1265319.4868923083, 1268859.416369939, 1255405.093634307, 1265302.8366209646, 1172037.3679194087, 1153773.8116295976, 1252006.3431348905, 1239131.641096771, 1254154.064494509, 1244404.3177439934, 1257448.5219962182, 1185588.7133034612, 1207093.7428035631, 1269675.1774451078, 1243777.1470098314, 1260453.0559684616, 1254811.3572696296, 1267883.3052113478, 1258853.4101606081, 1263160.3492865951, 1269674.6975587124, 1175006.675146381, 1259047.227212519, 1211750.146359108, 1172718.033086426, 1208615.7075176234, 1246999.9252973783, 1268023.9707422317, 1159277.0110642475, 1261524.5999590775, 1238548.351736369, 1247329.2733092906, 1266936.1946038315, 1269525.4751233906, 1260573.1024955274, 1255169.8816845394, 1223914.7933364268, 1252257.9520070462, 1266436.124926229, 1265164.050087797, 1188065.077888494, 1263157.9106084835, 1266179.7978136325, 1067657.9735827034, 1206581.8891411806, 1210861.4009692639, 1249324.7055284467, 1140610.1151643011, 1231595.2476590306, 1267588.6112121074, 1263457.8167206903, 1221323.8734047904, 1227063.8778030875, 1191558.2454290076, 1254842.7200615641, 1190424.574609307, 1235692.8690749712, 1208733.3765686546, 1257459.9313962432, 1125155.186652302, 1140095.4958870572, 1155295.9189359285, 1164267.1884048767, 1186715.5723615503, 1214962.5870954967, 976805.9390009611, 1178292.7664703936, 1245211.6161559408, 1267934.1929171172, 1238045.124517205, 1198225.1290014351, 1251297.71592657, 1269213.548184671, 1268910.0599091665, 1244786.1652632481, 1255980.867140768, 1152871.0632518425, 1251619.4248195626, 1250322.7778054848, 1266251.6463530685, 1233994.471102862, 1269183.9460893462, 1266795.4906259524, 1264708.0185007919, 1268061.0980047726, 1262162.5866497937, 1260613.6168001415, 1221919.5756110977, 1267600.997237627, 1257350.1872540722, 1162449.4715258724, 1254325.4685519633, 1268449.0340871096, 1218580.5570691247, 1184995.771331514, 1263750.9758287598, 1266782.189419249, 1269239.1852976594, 1122912.9591658674, 1267894.1815942721, 1269064.1093362237, 1185214.9492765525, 1239320.1749389458, 1266798.21135313, 1262143.5044323665, 1249093.1182887896, 1257123.4109674422, 1250991.3850410446, 1264644.3663273328, 1257179.4621768438, 1350411.530979457, 1251679.0039268236, 1265162.769531074, 1267305.5823234397, 1245014.9041372817, 1124983.4443910455, 1267757.7044005124, 1238335.9529067453, 1130327.6989426557, 1268552.1126589663, 1247285.9208037579, 1258620.1281729748, 1191433.5774848352, 1246982.8629431769, 1261439.05611632, 1269645.9433080403, 1237265.5048769352, 1264019.0493606739, 1268945.4444488501, 1234762.270807496, 1268944.6862896245, 1268859.4912519467, 1248878.9902626625, 1262528.4397285753, 1223800.7766954396, 1267117.3668570416, 1177509.9311023443, 1269182.7772857125, 1253689.5615554517, 1264137.6415369387, 1269360.237965489, 1218397.8404062002, 1269453.675445701, 1124552.9897503345, 1258426.4052804515, 1178241.6954600625, 1236410.248540422, 1256093.0700405473, 1269678.9750855227, 1223684.6371131225, 1195507.1695350918, 1261586.7442981259, 1172988.3631995842, 1225799.3282198368, 1267538.1378355063, 1264439.08564767, 1269677.3282516121, 1236900.1705071742, 1267428.7370219969, 1262675.5030153315, 1268726.9651453958, 1253059.1675220958, 1177227.5775240916, 1231567.8508516597, 1269658.964758206, 1123085.69323426, 1257059.3713324054, 1268256.92296005, 1268705.8011399056, 1232946.6407086316, 1268968.526791854, 1265948.9827403547, 1266264.4706447944, 1266291.9609369128, 1266906.618554914, 1209956.6533719448, 1255446.372866158, 1255248.7750291312, 1268422.9674466765, 1266977.0297475692, 1190836.7376835456, 1256318.562522619, 1256910.3840649377, 1220163.535434045, 1213586.4668194903, 1265687.3719611242, 1268724.6274143497, 1260958.035760366, 1260771.847888969, 1268616.0941299885, 1268746.3706399605, 1269578.5671734742, 1109935.944214483, 1253072.495307267, 1167070.433157354, 1253416.1829388866, 1240151.3132864705, 1263595.387003584, 1261222.1070741334, 1119881.4558935636, 1168726.6573987738, 1120034.6087927297, 1215992.628088145, 1268949.8847022413, 1269470.2069372197, 1267001.7830805136, 1147717.4341789014, 1244360.3062807755, 1262195.730650671, 1239304.946828062, 1269100.2390922743, 1269560.2660379952, 1264319.8283319594, 1269311.9301509527, 1266197.7912203083, 1269494.561879782, 1223240.3554241555, 1254150.2486514917, 1265577.8223365876, 1268917.60021482, 1243824.9112515042, 1269457.103774395, 1250348.4775392332, 1256600.9730887022, 1268847.3153871188, 1165289.2673089239, 1163120.7230974322, 1137919.6475177784, 1253743.2091850801, 1225262.7644675833, 1269367.4256187754, 1249445.0036425563, 1265598.0285447391, 1265609.0919528636, 1260801.7099873088, 1258350.7096313809, 1260186.735563359, 1263199.7945941295, 1212264.1101764406, 1231339.5475175353, 1138157.6781527193, 1207701.8172643408, 1245755.9629319108, 1269041.9715139742, 1239757.469510251, 1151889.9748307327, 1268521.672106812, 1192732.0871083594, 1269204.6092029472, 1256086.2077263468, 1137641.780265777, 1267884.340660894, 1230600.1249151137, 1235403.6332033044, 1189641.2253041998, 1227053.7807142935, 1268851.9825231088, 1253748.6845629683, 1267766.5877192146, 1268182.5821305094, 1260965.5507759287, 1246553.2904417925, 1138687.7875098076, 1265969.0223481425, 1247134.812386791, 1265175.4178875468, 1268422.7895419076, 1256084.2542710432, 1268024.5379800326, 1191210.0703517068, 1165678.2324059927, 1262604.6310059926, 1264812.7705467853, 1265823.2661018176, 1211535.130935839, 1267824.8017263864, 1259797.9477573878, 1267564.8730605934, 1212617.6325405403, 1121854.382524165, 1178883.3750346084, 1184444.0468684076, 1240093.0842042114, 1249043.567956796, 1194047.2817890681, 1265324.573747352, 1200677.8521998746, 1268011.3374427636, 1243081.9289253543, 1249469.9942620941, 1265345.9270054516, 1269681.8848743981, 1246735.7711412166, 1266022.857213798, 1181688.2290547395, 1260804.4613842457, 1050264.7076752293, 1266084.7466737328, 1258192.005803298, 1263184.293126466, 1269642.5769339923, 1258775.0594498294, 1254528.558505464, 1217222.222502354, 1268872.594694155, 1211013.4027777903, 1269647.8527033092, 1265674.5060554438, 1268236.036480789, 1249379.367291763, 1269060.7462300558, 1248283.5037488523, 1267800.2219493694, 1137727.1413231676, 1246923.7693659852, 1164906.4165108996, 1136052.0439907897, 1259938.042704625, 1268245.4904273928, 1222083.2817806415, 1134965.2384646644, 1531805.1394801699, 1234776.6608116787, 1089079.4499229388, 1268911.0407538346, 1233711.3756214895, 1269140.2935399332, 1126243.7651828623, 1248842.2458382742, 1263386.0648108975, 1257753.4149314966, 1269128.7273637417, 1267973.161591976, 1269643.0971438698, 1224494.922742759, 1268218.1952609948, 1252675.9670749803, 1199885.369551415, 1207742.1076379768, 1260611.2545215788, 1253660.3919209386, 1258946.2099185386, 1241047.6721671782, 1257618.6636044711, 1264162.928034168, 1266706.7449534007, 1254576.105564074, 1245557.076153633, 1202714.8557810513, 1240693.2193091102, 1269048.5942161316, 1125512.784943147, 1269679.0080106682, 1235086.1707496021, 1264578.38588615, 1278252.196455101, 1216629.958471074, 1113000.5780376135, 1213240.8421971009, 1266526.4274021669, 1254166.1706213343, 1250927.0017612723, 1254982.782186011, 1265708.6198844048, 1196036.1677736214, 1269544.4574788767, 1269652.5802059975, 1268440.4738860566, 1269585.6240977226, 1267311.9040876236, 1174092.0720593235, 1257717.9039977198, 1248362.2766516425, 1219359.047621943, 1193595.2312867264, 1169607.1757042152, 1207640.7874575648, 1258297.0997531917, 1267840.8058599061, 1262106.7143708353, 1218376.9659066882, 1268193.402609877, 1269415.4187136616, 1254964.1813567746, 1227154.5875023992, 1269560.9593057395, 1265400.1621947398, 1142783.620604639, 1258390.85433641, 1266770.3508332344, 1206633.2511449838, 1265438.2376986854, 1141836.1571492134, 1260601.762856138, 1262585.4370680447, 1250966.5731125057, 1268200.466684036, 1284654.660677996, 1180046.503458961, 1249015.017066457, 1189386.1021809538, 1269518.241886956, 1181745.015219126, 1177706.5558205317, 1212258.380909508, 1266310.8014075265, 1253211.622797733, 1172289.788252743, 1266550.13627081, 1218259.7725620263, 1112035.3991381088, 1165067.6167488042, 1242144.3759762023, 1236262.5719839712, 1268977.1074486354, 1266421.375541283, 1128095.6708341183, 1269431.014557317, 1232498.8200211038, 1262011.4182532916, 1228997.081758646, 1228345.8304331028, 1269536.331596083, 1269296.721755132, 1269016.4945044026, 1112852.101702728, 1269525.1776723184, 1193382.5825410602, 1266307.707065735, 1146199.6513649796, 1269002.7780344887, 1214933.6677484254, 1164870.737465858, 1269520.3247084764, 1266421.1056016425, 1229967.5628740122, 1257721.0205293295, 1241157.8899790095, 1261567.2843880132, 1266883.4106895076, 1229563.5722809767, 1269181.2807332426, 1235432.7389401265, 1242825.1217053845, 1259967.6958346865, 1192727.6833253256, 1285826.4055837414, 1253216.9763616398, 1060716.5119278296, 1243183.4086298763, 1155710.442257824, 1248193.5723741965, 1249380.6108308407, 1253720.1418597512, 1184887.589050595, 1269640.3174061473, 1269471.5718876824, 1136147.4666288714, 1269568.7518224278, 1170546.417235046, 1265066.5683793824, 1246835.428966241, 1255663.2292681732, 1269680.701541743, 1120539.253621702, 1264904.1819273247, 1244005.633968813, 1212665.2000671714, 1254374.4289262213, 1251254.375799344, 1185952.6924007447, 1269653.5625584882, 1267641.2044899955, 1209442.36007572, 1265181.3192746995, 1263322.9784711376, 1247526.134828595, 1113937.4232425445, 1260063.0800349268, 1206379.4968676844, 1246576.365733989, 1257913.9880189828, 1116271.8594721917, 1117781.5048071032, 1269251.0759844244, 1236125.9644699502, 1349589.7519464642, 1269167.1148624031, 1266939.3319125362, 1222523.273895225, 1160514.3651543045, 1268796.39501558, 1268031.6207246766, 1097535.8208230934, 1268784.3319792456, 1268468.5775591924, 1254670.219935983, 1268946.0589934003, 1269682.4688192294, 1262504.8197224173, 1236215.5079754756, 1241463.5551917804, 1238858.9351065618, 1269128.7570258765, 1256448.3528087372, 1240083.2198293998, 1242077.4666555873, 1267567.2424309617, 1251275.6974642326, 1267602.0295531503, 1221369.6940825507, 1213199.4556098059, 1216977.3821184486, 1248443.5088869706, 1200526.1015335289, 1205187.2237350086, 1253246.3444224151, 1265203.8032264232, 1251307.5998703886, 1193745.6560241163, 1258769.2354393215, 1266253.1236595204, 1199310.7259368347, 1205617.7142277586, 1269591.3174091077, 1252360.337836196, 1269671.6043601034, 1260186.7906351683, 1269561.173581491, 1193302.4336371715, 1260235.8939961782, 1252833.9392873629, 1173068.576819688, 1125860.4006249167, 1269605.8171687191, 1246127.7010162463, 1194627.9746488337, 1257390.4474690384, 1264938.0792933211, 1232734.6688826932, 1135822.0823325044, 1204456.9402337938, 1257455.5974801395, 1267101.1454191501, 1269272.2145728536, 1181889.4673681017, 1184204.6424596652, 1269014.301102467, 1262303.6246403798, 1269561.9600385807, 1253814.6661896952, 1267031.4170080675, 1264767.3429828824, 1269210.9461934606, 1269017.6978407956, 1117117.460171587, 1219609.2471402765, 1266950.319179278, 1263818.2062480368, 1194798.6161130639, 1142577.8515553079, 1263374.9321743408, 1267855.0598877578, 1223286.6888392705, 1269435.1320500446, 1245025.5467434137, 1207241.3001516813, 1260958.793931925, 1248747.2675473283, 1195368.9145220644, 1171336.2658271855, 1225932.2417441339, 1264793.562352989, 1204649.760528077, 1268631.9572614182, 1269677.7621351962, 1268973.1523983146, 1262548.8549733218, 1269680.0397072963, 1269412.6487721875, 1269679.3041537069, 1267924.4849739016, 1129571.489396835, 1262980.567226435, 1233936.9062035684, 1165221.9351977108, 1248213.5031178475, 1237980.880638354, 1260050.6996951145, 1266655.8467584825, 1260257.8963764438, 1260976.863983259, 1265697.0230002673, 1187077.630724583, 1268563.9019853272, 1262361.378672252, 1162333.5466796348, 1258963.9830007383, 1257979.755296638, 1223293.779104362, 1268255.5126495538, 1260958.617605956, 1266545.8402134338, 1261912.6810153953, 1253168.939060274, 1188277.3137261227, 1255307.1239743691, 1219961.0923156906, 1168890.4217912469, 1269411.119000999, 1268505.6104105327, 1130099.8425586468, 1256406.8360590416, 1267033.9432713587, 1266096.1876554354, 1266605.1958378353, 1261762.4849218063, 1211589.637665266, 1188139.7157237954, 1267972.6552016225, 1268378.6100808957, 1261725.5001343638, 1265427.5523730759, 1256042.298393762, 1169639.716621328, 1247762.4373396765, 1265975.1227646044, 1253204.5044713835, 1232474.6101382978, 1266616.2255185759, 1237317.9787236482, 1228962.7096566586, 1267530.2672240944, 1243366.6636457297, 1266464.3543881474, 1266952.741347377, 1181972.2595505829, 1238728.0882382537, 1258073.1028729263, 1179388.3891269604, 1186296.3941310772, 1142920.7359947872, 1261480.4737739614, 1261532.8730319815, 1256598.3895205765, 1263288.9765080572, 1396739.4451771802, 1268553.254224032, 1254670.875266201, 1183283.5878882485, 1244588.3346504148, 1219410.7266479207, 1207128.9759858695, 1247400.9567026773, 1258340.6221434085, 1214862.852616859, 1246906.7175604934, 1200704.2629607893, 1261667.105449, 1232665.8473689232, 1257494.7982715792, 1264152.905343061, 1268223.8700044488, 888351.1823844523, 1268664.9583160596, 1223039.0705954833, 1267389.0261790962, 1245553.7795020028, 1238204.145808548, 1268103.7404801021, 1261537.741293374, 1267038.2416801387, 1261034.7370435933, 1267870.5118591378, 1268826.617298323, 1155732.4116386336, 1269646.1745530793, 1198708.2399736673, 1143604.9180390874, 1258719.6550301202, 1262989.924701062, 1224101.9754123706, 1268835.1985748457, 1157216.4311284316, 1243089.4808465824, 1231997.0440194188, 1259118.5144755857, 1267042.7909863119, 1196101.6681726149, 1269480.520463604, 1262432.5947070748, 1148055.6183664114, 1159417.8972669633, 1260228.5269666107, 1252385.3572431807, 1257125.916516651, 1259729.6025698844, 1266130.7022776096, 1267655.8126058204, 1185140.3842375053, 1178245.8228392822, 1187093.7231224133, 1267198.7763184998, 1262649.2807267695, 1241699.3276241354, 1322783.9639695361, 1115988.8750683384, 1212646.7110508305, 1233834.4664197974, 1243008.2770351311, 1261753.0213301328, 1248130.7600841667, 1266250.5561778767, 1225432.423188538, 1210049.0319420276, 1269231.2542771122, 1130061.507115444, 1268489.3288094287, 1263463.1270427594, 1255449.7677348086, 1253888.820435351, 1229382.3270437855, 1169018.0570682038, 1252188.435715846, 1165576.287995264, 1262619.0512364595, 1188944.268790184, 1219503.0106679786, 1268564.3252057144, 1269582.874976667, 1229385.1663603003, 1267146.780749506, 1264397.9885316163, 1258111.6007859097, 1269491.936503723, 1259948.5880806558, 1146154.0925060972, 1247822.7335057282, 1209626.8397729893, 1263871.922867186, 1232912.4248583193, 1254701.4717038486, 1205468.7316991454, 1254556.6194411458, 1268726.0581320268, 1251884.3647067198, 1262773.1821497516, 1260794.6806199548, 1269018.217363088, 1264250.8646576449, 1252114.5858913446, 1267504.2437257592, 1269657.015920074, 1180673.3618413839, 1257689.888910988, 1267744.2273599305, 1268532.2915752898, 1265868.0941712316, 1268334.9586231047, 1269302.7954245657, 1263569.0853222886, 1267205.5279254478, 1245878.32467702, 1267860.908996885, 1515485.8474970981, 1268417.5336523647, 1646435.1079008281, 1119309.6892866918, 1269044.3563381291, 1269222.7546021668, 1179348.1947889028, 1222661.9283976548, 1259775.0001557714, 1238556.9156818143, 1129316.970398104, 1260551.9894024485, 1268671.9880086132, 1253039.233753788, 1264152.1868694325, 1196665.404580153, 1256892.9403767353, 1259481.4804073668, 1154230.1758036565, 1250813.8363339165, 1220275.9261999037, 1267929.2904137708, 1261639.4151079238, 1249545.2125652146, 1257024.1950640262, 1266085.5332138147, 1269681.248993272, 1196931.8705548216, 1192622.8902328487, 1265347.171128513, 1242785.6580454975, 1147154.7040398633, 1268983.164067588, 1269128.4182181328, 1130797.2622520132, 1266202.729289836, 1269432.7368109133, 1268324.7953302583, 1269681.3222694125, 1148885.4106493895, 1267798.1109294228, 1248582.5501839023, 1238633.0852348297, 1268489.2646994854, 1256969.4775579767, 1223972.4994096784, 1261101.114725148, 1256892.6920203152, 1268072.8279174399, 1269275.012195775, 1263918.7989214107, 1264146.0260506575, 1268892.7312609632]  # Truncate for embedding
baseline = 1191417.535695
mean = 1236564.779199813
std = 50152.686819091636
p5 = 1137503.2420420048
p50 = 1255707.2256229785
p95 = 1269608.692321466
display_name = "Treaty ROI - Lag Elimination (PRIMARY)"
units = "ratio"

# Create figure with two subplots

fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))
fig.subplots_adjust(wspace=0.3)

# --- Left: Histogram ---

# Handle edge case where all samples are identical (zero variance)

if std == 0 or (max(samples) == min(samples)):
    n_bins = 1
else:
    n_bins = min(50, max(1, int(np.sqrt(len(samples)))))
n, bins, patches = ax1.hist(samples, bins=n_bins, color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)

ax1.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key statistics with formatted values in legend (use format_parameter_value for full units)

ax1.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=2, label=f'Median: {format_parameter_value(p50, units)}')
ax1.axvline(p5, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'5th %-ile: {format_parameter_value(p5, units)}')
ax1.axvline(p95, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'95th %-ile: {format_parameter_value(p95, units)}')
ax1.axvline(baseline, color=COLOR_BLACK, linestyle='-', linewidth=1.5, alpha=0.5, label=f'Baseline: {format_parameter_value(baseline, units)}')

ax1.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax1.set_ylabel('Frequency', fontsize=11)
ax1.set_title('Distribution of Outcomes', fontsize=12, weight='bold')
ax1.legend(loc='upper right', fontsize=9)
clean_spines(ax1)

# --- Right: CDF (Cumulative Probability) ---

sorted_samples = np.sort(samples)
cumulative = np.arange(1, len(sorted_samples) + 1) / len(sorted_samples)

ax2.plot(sorted_samples, cumulative * 100, color=COLOR_BLACK, linewidth=2)
ax2.fill_between(sorted_samples, 0, cumulative * 100, alpha=0.1, color=COLOR_BLACK)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)

ax2.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key percentiles

ax2.axhline(50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)
ax2.axhline(5, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axhline(95, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)

ax2.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax2.set_ylabel('Cumulative Probability (%)', fontsize=11)
ax2.set_title('Probability of Exceeding Value', fontsize=12, weight='bold')
ax2.set_ylim(0, 100)
clean_spines(ax2)

# Add annotation for "probability of exceeding baseline"

exceed_baseline_pct = (np.array(samples) > baseline).sum() / len(samples) * 100
ax2.annotate(f'{exceed_baseline_pct:.0f}% chance of\nexceeding baseline',
             xy=(baseline, exceed_baseline_pct), xytext=(baseline * 1.1, exceed_baseline_pct + 10),
             fontsize=9, ha='left',
             arrowprops=dict(arrowstyle='->', color=COLOR_BLACK, lw=1))

# Main title

fig.suptitle(f'Monte Carlo Analysis: {display_name}', fontsize=14, weight='bold', y=1.02)

# Add watermark

add_watermark(fig)

# Save PNG to knowledge/figures/ regardless of where Quarto renders from

output_path = get_figure_output_path('mc-distribution-treaty_complete_roi_all_benefits.png')
plt.savefig(output_path, dpi=150, bbox_inches='tight', facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title=f'Monte Carlo: {display_name}',
    description=f'Monte Carlo simulation results showing uncertainty distribution for {display_name}'
)

plt.show()
```

**Simulation Results Summary: Treaty ROI - Lag Elimination (PRIMARY)**

| Statistic | Value |
|:----------|------:|
| Baseline (deterministic) | 1.19M |
| Mean (expected value) | 1.24M |
| Median (50th percentile) | 1.26M |
| Standard Deviation | 50.2k |
| 90% Confidence Interval | [1.14M, 1.27M] |

*The histogram shows the distribution of Treaty ROI - Lag Elimination (PRIMARY) across 10,000 Monte Carlo simulations. The CDF (right) shows the probability of the outcome exceeding any given value, which is useful for risk assessment.*
