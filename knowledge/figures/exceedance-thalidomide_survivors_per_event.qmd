```{python}
#| echo: false
#| fig-cap: "Probability of Exceeding Threshold: Thalidomide Survivors Per Event"
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata
)

setup_chart_style()

# Monte Carlo samples
samples = [560, 445, 603, 622, 379, 425, 543, 504, 530, 460, 616, 606, 538, 641, 575, 459, 566, 451, 616, 528, 515, 473, 652, 518, 494, 501, 582, 565, 570, 572, 715, 496, 487, 463, 590, 642, 522, 461, 462, 593, 602, 583, 475, 553, 542, 552, 615, 552, 596, 538, 558, 591, 414, 504, 491, 477, 508, 681, 459, 625, 398, 502, 547, 587, 599, 607, 501, 491, 614, 515, 427, 438, 454, 578, 545, 597, 494, 546, 591, 505, 574, 475, 500, 498, 433, 577, 491, 533, 577, 573, 595, 523, 495, 525, 397, 414, 424, 448, 569, 456, 499, 660, 501, 601, 453, 513, 452, 502, 612, 395, 572, 554, 480, 415, 539, 486, 553, 534, 693, 510, 446, 548, 552, 666, 611, 565, 678, 434, 477, 454, 498, 419, 591, 512, 413, 447, 561, 612, 715, 715, 570, 449, 368, 557, 463, 495, 479, 519, 635, 546, 518, 445, 398, 489, 527, 712, 544, 627, 488, 434, 450, 470, 715, 462, 612, 456, 621, 567, 518, 528, 475, 573, 492, 431, 427, 548, 690, 546, 521, 558, 661, 552, 496, 639, 572, 686, 549, 431, 420, 699, 707, 516, 498, 678, 440, 456, 592, 497, 531, 517, 563, 672, 540, 592, 373, 527, 460, 431, 458, 503, 620, 423, 535, 490, 503, 629, 582, 664, 518, 472, 512, 554, 548, 441, 540, 553, 715, 714, 460, 507, 413, 481, 561, 650, 469, 475, 367, 517, 443, 486, 458, 523, 392, 413, 715, 426, 441, 714, 715, 435, 500, 563, 707, 449, 510, 606, 572, 499, 520, 419, 510, 508, 553, 484, 576, 630, 546, 564, 537, 532, 470, 561, 523, 715, 690, 567, 467, 439, 649, 556, 577, 394, 621, 574, 440, 491, 556, 537, 506, 523, 510, 546, 678, 357, 511, 548, 559, 499, 392, 562, 707, 408, 615, 503, 527, 444, 502, 660, 586, 708, 647, 572, 709, 572, 611, 506, 538, 472, 627, 435, 606, 515, 646, 603, 714, 601, 405, 526, 435, 487, 683, 592, 472, 447, 535, 431, 474, 560, 645, 589, 358, 560, 539, 570, 695, 373, 481, 587, 405, 679, 566, 613, 482, 609, 636, 553, 553, 557, 459, 519, 518, 567, 629, 443, 521, 680, 468, 462, 550, 612, 533, 663, 614, 612, 584, 715, 513, 376, 693, 492, 541, 661, 403, 429, 403, 464, 572, 581, 557, 417, 357, 537, 491, 574, 598, 544, 604, 553, 581, 471, 516, 550, 610, 497, 580, 509, 521, 611, 376, 425, 412, 357, 474, 603, 507, 550, 637, 663, 526, 666, 540, 461, 480, 412, 457, 500, 608, 707, 419, 568, 445, 576, 520, 388, 621, 480, 485, 443, 475, 572, 515, 562, 565, 662, 502, 412, 635, 503, 640, 567, 520, 564, 715, 715, 538, 546, 636, 460, 563, 529, 561, 461, 404, 372, 439, 492, 506, 715, 639, 451, 564, 496, 507, 548, 590, 502, 635, 437, 532, 715, 552, 675, 540, 586, 526, 517, 465, 572, 460, 595, 638, 565, 507, 574, 505, 622, 387, 502, 376, 411, 667, 618, 470, 411, 357, 485, 715, 572, 483, 575, 406, 506, 541, 524, 607, 564, 595, 473, 618, 696, 451, 457, 664, 515, 671, 493, 677, 544, 556, 689, 500, 453, 493, 574, 406, 592, 485, 644, 357, 465, 397, 462, 555, 516, 510, 518, 550, 447, 599, 594, 567, 584, 559, 715, 524, 505, 467, 445, 429, 457, 526, 563, 537, 467, 618, 602, 518, 476, 583, 549, 414, 526, 556, 456, 549, 414, 664, 655, 510, 566, 357, 436, 506, 442, 599, 715, 435, 461, 553, 694, 431, 555, 714, 400, 427, 495, 487, 609, 554, 391, 580, 482, 657, 478, 477, 582, 604, 573, 397, 582, 445, 553, 416, 573, 463, 426, 599, 554, 479, 676, 493, 535, 557, 478, 576, 485, 496, 667, 445, 357, 694, 715, 496, 380, 505, 507, 515, 439, 586, 581, 411, 598, 715, 548, 502, 519, 590, 394, 547, 498, 714, 516, 701, 440, 587, 561, 458, 548, 651, 503, 397, 530, 456, 502, 525, 396, 403, 577, 486, 357, 607, 557, 471, 424, 611, 564, 715, 571, 568, 517, 610, 591, 655, 486, 494, 490, 607, 681, 492, 495, 561, 510, 624, 361, 462, 465, 357, 451, 455, 514, 640, 510, 445, 526, 633, 450, 455, 584, 512, 593, 530, 598, 445, 531, 513, 431, 406, 596, 501, 446, 523, 642, 359, 411, 454, 678, 558, 605, 437, 439, 573, 537, 583, 515, 558, 546, 606, 609, 402, 361, 629, 648, 446, 385, 541, 621, 714, 580, 499, 456, 533, 506, 447, 715, 714, 643, 454, 614, 592, 573, 655, 591, 602, 592, 563, 391, 540, 484, 427, 702, 707, 666, 555, 666, 533, 550, 441, 569, 537, 425, 527, 525, 714, 617, 533, 555, 536, 514, 442, 518, 468, 429, 579, 568, 390, 521, 628, 634, 631, 535, 460, 441, 564, 567, 659, 639, 520, 429, 504, 552, 514, 482, 555, 488, 478, 560, 497, 554, 557, 437, 490, 675, 436, 369, 385, 534, 535, 521, 651, 357, 568, 689, 438, 499, 468, 456, 503, 674, 714, 502, 715, 535, 710, 524, 544, 565, 715, 613, 471, 625, 500, 489, 619, 535, 558, 533, 563, 571, 380, 595, 450, 415, 527, 539, 472, 611, 422, 496, 481, 527, 558, 447, 601, 538, 383, 378, 531, 513, 523, 529, 552, 623, 439, 435, 441, 558, 654, 494, 357, 396, 461, 483, 496, 535, 504, 633, 474, 459, 576, 408, 568, 541, 519, 692, 478, 715, 512, 427, 538, 442, 468, 569, 584, 478, 627, 645, 675, 581, 667, 384, 504, 459, 543, 482, 517, 713, 517, 570, 511, 538, 532, 573, 646, 698, 560, 587, 437, 524, 622, 615, 551, 617, 578, 649, 558, 501, 563, 357, 567, 357, 395, 574, 576, 436, 471, 668, 490, 715, 532, 570, 695, 544, 448, 522, 528, 421, 509, 468, 620, 535, 507, 522, 552, 590, 448, 445, 639, 496, 417, 573, 575, 408, 553, 602, 566, 592, 417, 562, 505, 490, 615, 679, 714, 662, 522, 565, 605, 543, 544, 611, 527, 469, 496, 591, 532, 563, 595, 499, 604, 567, 430, 675, 488, 399, 444, 446, 537, 508, 502, 590, 563, 561, 570, 590, 369, 500, 365, 535, 531, 633, 648, 550, 488, 577, 486, 532, 627, 483, 609, 596, 452, 626, 598, 541, 467, 459, 485, 583, 452, 573, 429, 514, 542, 715, 419, 678, 545, 570, 542, 573, 518, 677, 492, 642, 476, 527, 442, 574, 676, 525, 514, 439, 511, 404, 455, 552, 662, 715, 481, 675, 554, 518, 572, 538, 542, 496, 418, 407, 593, 508, 480, 533, 607, 548, 475, 652, 690, 578, 626, 654, 642, 590, 588, 580, 440, 598, 421, 464, 660, 612, 680, 508, 436, 510, 541, 539, 642, 500, 564, 449, 573, 532, 468, 511, 515, 508, 712, 523, 510, 370, 456, 509, 473, 669, 517, 659, 538, 535, 524, 532, 706, 357, 376, 485, 533, 597, 576, 498, 630, 632, 549, 625, 557, 483, 598, 542, 532, 679, 357, 416, 433, 500, 510, 410, 449, 459, 715, 714, 496, 500, 437, 382, 521, 448, 524, 404, 467, 545, 565, 571, 424, 613, 464, 591, 531, 419, 504, 565, 590, 519, 685, 629, 509, 603, 715, 715, 430, 454, 680, 443, 424, 489, 571, 523, 476, 474, 471, 458, 715, 559, 617, 489, 515, 471, 357, 419, 389, 361, 433, 662, 528, 659, 570, 606, 456, 581, 601, 482, 584, 585, 484, 439, 434, 539, 562, 464, 534, 586, 590, 687, 658, 448, 702, 486, 633, 538, 496, 389, 516, 406, 625, 684, 464, 559, 470, 478, 606, 528, 709, 490, 628, 540, 607, 493, 528, 522, 461, 594, 593, 587, 686, 676, 499, 566, 478, 534, 480, 695, 566, 512, 648, 365, 375, 607, 537, 555, 423, 530, 715, 611, 547, 493, 497, 368, 556, 612, 405, 475, 436, 450, 537, 371, 590, 603, 510, 357, 449, 653, 357, 501, 434, 608, 474, 569, 584, 714, 514, 566, 412, 649, 467, 483, 530, 406, 553, 625, 559, 404, 521, 602, 384, 442, 616, 557, 570, 714, 575, 594, 715, 513, 464, 572, 572, 486, 445, 715, 562, 469, 620, 522, 510, 585, 426, 565, 715, 575, 499, 488, 496, 510, 499, 620, 394, 614, 499, 566, 438, 663, 654, 624, 409, 611, 569, 403, 529, 565, 584, 548, 558, 679, 652, 357, 504, 517, 393, 540, 655, 441, 563, 455, 474, 679, 485, 575, 384, 714, 588, 515, 586, 417, 648, 503, 514, 489, 482, 597, 555, 593, 531, 580, 495, 715, 406, 656, 667, 460, 715, 628, 625, 534, 512, 513, 568, 671, 549, 455, 611, 620, 594, 602, 508, 454, 458, 401, 553, 524, 493, 357, 429, 641, 475, 565, 418, 675, 519, 558, 715, 684, 505, 481, 503, 579, 522, 497, 678, 522, 715, 540, 714, 564, 625, 470, 460, 574, 627, 536, 426, 420, 416, 392, 542, 641, 530, 360, 515, 517, 715, 414, 498, 705, 573, 585, 542, 562, 606, 463, 616, 420, 562, 548, 479, 530, 478, 442, 501, 440, 562, 437, 599, 434, 483, 478, 662, 562, 513, 579, 369, 528, 715, 544, 538, 583, 618, 376, 398, 551, 471, 661, 504, 380, 428, 357, 511, 515, 495, 637, 649, 517, 368, 590, 584, 560, 626, 436, 715, 451, 603, 397, 454, 684, 508, 612, 553, 523, 667, 511, 391, 464, 583, 568, 406, 470, 481, 500, 419, 478, 469, 605, 609, 519, 497, 545, 462, 437, 453, 477, 436, 547, 601, 404, 534, 512, 563, 531, 414, 428, 534, 631, 363, 564, 648, 518, 583, 472, 521, 402, 357, 622, 449, 492, 419, 417, 516, 469, 567, 574, 561, 554, 690, 443, 527, 642, 656, 416, 504, 666, 579, 549, 512, 498, 558, 510, 528, 539, 474, 581, 715, 391, 562, 467, 586, 536, 604, 647, 550, 642, 357, 692, 566, 637, 431, 461, 545, 530, 558, 637, 392, 626, 533, 514, 413, 578, 357, 593, 411, 537, 521, 646, 516, 472, 488, 657, 582, 498, 511, 406, 568, 392, 603, 543, 715, 440, 523, 714, 649, 472, 552, 532, 557, 472, 524, 404, 544, 573, 511, 403, 627, 566, 470, 507, 410, 446, 485, 652, 477, 592, 485, 555, 519, 616, 485, 405, 419, 486, 429, 570, 491, 715, 393, 550, 438, 489, 545, 357, 553, 714, 492, 556, 631, 517, 482, 359, 592, 522, 447, 543, 481, 486, 589, 423, 634, 418, 475, 715, 641, 540, 453, 486, 539, 535, 524, 529, 513, 415, 487, 620, 420, 515, 462, 542, 498, 679, 579, 424, 595, 466, 482, 561, 489, 617, 466, 478, 475, 483, 639, 591, 705, 715, 445, 538, 435, 466, 477, 443, 444, 519, 431, 612, 455, 715, 492, 539, 426, 705, 641, 559, 422, 551, 439, 678, 609, 540, 357, 450, 597, 651, 640, 404, 559, 630, 399, 531, 557, 505, 386, 503, 503, 519, 483, 493, 528, 573, 505, 496, 540, 381, 576, 532, 535, 625, 379, 378, 557, 531, 547, 491, 595, 621, 577, 508, 369, 605, 652, 592, 458, 596, 614, 688, 458, 512, 603, 537, 439, 570, 586, 540, 552, 509, 679, 456, 481, 533, 616, 410, 425, 374, 535, 439, 498, 594, 477, 553, 506, 595, 576, 472, 517, 633, 568, 418, 594, 441, 672, 631, 558, 546, 513, 596, 499, 553, 615, 483, 479, 433, 443, 388, 601, 714, 674, 401, 601, 673, 492, 541, 375, 556, 443, 550, 406, 583, 631, 465, 438, 367, 508, 481, 407, 574, 493, 442, 484, 636, 588, 520, 590, 436, 535, 545, 491, 572, 465, 579, 584, 357, 649, 357, 479, 631, 504, 413, 441, 631, 381, 642, 527, 433, 481, 446, 615, 601, 395, 496, 459, 659, 422, 693, 529, 436, 474, 464, 427, 540, 430, 365, 499, 389, 468, 455, 458, 715, 537, 554, 391, 476, 551, 446, 619, 432, 507, 481, 547, 477, 508, 511, 469, 577, 554, 524, 494, 607, 511, 505, 541, 704, 422, 605, 383, 552, 690, 577, 548, 483, 535, 510, 465, 506, 550, 466, 463, 420, 568, 583, 553, 625, 540, 568, 560, 524, 486, 715]
thresholds = [424, 531, 658]
display_name = "Thalidomide Survivors Per Event"
units = "cases"

# Calculate exceedance probabilities (1 - CDF)
sorted_samples = np.sort(samples)
exceedance = 1 - np.arange(1, len(sorted_samples) + 1) / len(sorted_samples)

# Create figure
fig, ax = plt.subplots(figsize=(10, 6))

# Plot exceedance curve
ax.plot(sorted_samples, exceedance * 100, color=COLOR_BLACK, linewidth=2.5)
ax.fill_between(sorted_samples, 0, exceedance * 100, alpha=0.1, color=COLOR_BLACK)

# Annotate thresholds
for thresh in thresholds:
    exceed_pct = (np.array(samples) >= thresh).sum() / len(samples) * 100
    ax.axvline(thresh, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)
    ax.axhline(exceed_pct, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.3)
    
    # Add label
    ax.annotate(f'{exceed_pct:.0f}% chance\nâ‰¥ {thresh:,.2g}',
                xy=(thresh, exceed_pct), xytext=(thresh * 1.05, exceed_pct + 5),
                fontsize=10, ha='left', weight='bold',
                bbox=dict(boxstyle='round,pad=0.3', facecolor=COLOR_WHITE, edgecolor=COLOR_BLACK, alpha=0.9))

ax.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=12)
ax.set_ylabel('Probability of Exceeding Value (%)', fontsize=12)
ax.set_title(f'Exceedance Probability: {display_name}', fontsize=14, weight='bold', pad=15)
ax.set_ylim(0, 100)
ax.set_xlim(left=min(sorted_samples) * 0.95)

clean_spines(ax)
add_watermark(fig)

# Save PNG
project_root = Path.cwd()
while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
    project_root = project_root.parent

output_path = project_root / 'knowledge' / 'figures' / 'exceedance-thalidomide_survivors_per_event.png'
plt.savefig(output_path, dpi=150, bbox_inches='tight', facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title=f'Exceedance: {display_name}',
    description=f'Probability of {display_name} exceeding various thresholds'
)

plt.show()
```

*This exceedance probability chart shows the likelihood that Thalidomide Survivors Per Event will exceed any given threshold. Higher curves indicate more favorable outcomes with greater certainty.*
