```{python}
#| echo: false
#| fig-alt: "Separation of concerns: DIH handles governance and budgeting, dFDA provides technical platform"

import graphviz
from pathlib import Path
from IPython.display import Image as IPImage, display

from dih_models.plotting.graphviz_helper import (
    setup_graphviz_style,
    render_graphviz_with_watermark
)

# Create diagram
dot = graphviz.Digraph(comment='DIH vs dFDA Separation', format='png')
dot.attr(rankdir='LR', size='12,10')

# Apply design guide styling
setup_graphviz_style(dot)

# DIH cluster (left)
with dot.subgraph(name='cluster_dih') as dih:
    dih.attr(label='DIH: Governance Layer', style='solid', penwidth='3')
    dih.node('Treasury', 'Treasury\n($1T/year)', shape='box')
    dih.node('Wishocracy', 'Wishocracy\nVoting', shape='diamond')
    dih.node('Campaigns', 'Campaign\nAllocation', shape='box')

    # What DIH does
    dih.node('DIHDoes', 'DIH Handles:\n• Budget decisions\n• Campaign funding\n• Wishocracy voting\n• Treasury management\n• Prize distribution',
             shape='note', style='filled', fillcolor='white')

# dFDA cluster (right)
with dot.subgraph(name='cluster_dfda') as dfda:
    dfda.attr(label='dFDA: Technical Platform', style='solid', penwidth='3')
    dfda.node('Protocol', 'Open Protocol\n(Like HTTP)', shape='box')
    dfda.node('Marketplace', 'Trial\nMarketplace', shape='box')
    dfda.node('Data', 'Data Commons\n& Rankings', shape='box')

    # What dFDA does
    dfda.node('dFDADoes', 'dFDA Provides:\n• Platform infrastructure\n• Trial marketplace\n• Outcome rankings\n• Data protocol\n• NO budget authority',
              shape='note', style='filled', fillcolor='white')

# Connections within DIH
dot.edge('Treasury', 'Wishocracy', label='allocates via')
dot.edge('Wishocracy', 'Campaigns', label='votes on')

# Connections within dFDA
dot.edge('Protocol', 'Marketplace', label='enables')
dot.edge('Marketplace', 'Data', label='generates')

# DIH funds dFDA (key relationship)
dot.edge('Campaigns', 'Protocol', label='Funds dFDA as\none campaign', style='bold', penwidth='2')

# Prevention of capture
dot.node('Capture', 'If dFDA gets captured:\nFund alternative platform',
         shape='note', style='dashed')
dot.edge('Campaigns', 'Capture', style='dashed')

# Render with watermark
png_path = render_graphviz_with_watermark(dot, 'dih-vs-dfda-separation-diagram')
display(IPImage(str(png_path)))
```
