{{< include /knowledge/includes/setup-parameters.qmd >}}

```{python}
#| label: roi-comparison
#| echo: false

import pandas as pd
import numpy as np
import plotly.graph_objects as go
import plotly.express as px

# Set up formatting

pd.options.display.float_format = '{:,.0f}'.format

# Comprehensive economic impact data - 3-Tier Structure for Gates Foundation

economic_impacts = pd.DataFrame({
    'Source': [
        '1% Treaty Peace Dividend (Annual)',
        'dFDA R&D Savings Only (Annual)',
        'dFDA Historical Rate (Total One-Time)',
        'dFDA Lag Elimination PRIMARY (Total One-Time)',
        'dFDA Innovation Acceleration (Total One-Time)',
        'Medical Research Acceleration (Annual)',
        'Treaty ROI: Peace + R&D + Historical',
        'Treaty ROI: Complete (PRIMARY)'
    ],
    'Benefit Value (Trillions)': [
        float(PEACE_DIVIDEND_ANNUAL_SOCIETAL_BENEFIT) / 1_000_000_000_000,
        float(DFDA_BENEFIT_RD_ONLY_ANNUAL) / 1_000_000_000_000,
        float(HISTORICAL_PROGRESS_ECONOMIC_LOSS_TOTAL) / 1_000_000_000_000,
        float(DISEASE_ERADICATION_DELAY_ECONOMIC_LOSS) / 1_000_000_000_000,
        float(DISEASE_ERADICATION_PLUS_ACCELERATION_ECONOMIC_LOSS_TOTAL) / 1_000_000_000_000,
        np.nan,
        np.nan,  # ROI only
        np.nan   # ROI only
    ],
    'ROI Ratio': [
        np.nan,
        np.nan,
        float(TREATY_ROI_HISTORICAL_RATE),
        float(TREATY_ROI_LAG_ELIMINATION),
        float(TREATY_ROI_INNOVATION_ACCELERATION),
        np.nan,
        float(DFDA_ROI_RD_ONLY),
        float(TREATY_COMPLETE_ROI_ALL_BENEFITS)
    ],
    'Investment Cost (Billions)': [
        np.nan,  # Ongoing benefit
        float(DFDA_ANNUAL_OPEX) / 1_000_000_000,
        float(TREATY_CAMPAIGN_TOTAL_COST) / 1_000_000_000,
        float(TREATY_CAMPAIGN_TOTAL_COST) / 1_000_000_000,
        float(TREATY_CAMPAIGN_TOTAL_COST) / 1_000_000_000,
        np.nan,  # Ongoing benefit
        float(TREATY_TOTAL_ANNUAL_COSTS) / 1_000_000_000,
        float(TREATY_CAMPAIGN_TOTAL_COST) / 1_000_000_000
    ]
})

# Note: All ROI values are now pre-calculated in parameters.py
# No need to calculate ROI where missing since we're using explicit ROI parameters

# Filter for items with ROI ratios

roi_data = economic_impacts[economic_impacts['ROI Ratio'].notna()].sort_values('ROI Ratio')

# Create logarithmic bar chart

fig = go.Figure()

colors = px.colors.sequential.Viridis_r
fig.add_trace(go.Bar(
    y=roi_data['Source'],
    x=roi_data['ROI Ratio'],
    orientation='h',
    marker=dict(
        color=roi_data['ROI Ratio'],
        colorscale='Viridis',
        showscale=True,
        colorbar=dict(title='ROI Ratio')
    ),
    text=[f'{int(x)}:1' for x in roi_data['ROI Ratio']],
    textposition='outside'
))

fig.update_layout(
    title='Return on Investment Comparison (Log Scale)',
    xaxis_title='ROI Ratio',
    yaxis_title='',
    xaxis_type='log',
    height=600,
    margin=dict(l=200, r=100)
)

fig.show()
