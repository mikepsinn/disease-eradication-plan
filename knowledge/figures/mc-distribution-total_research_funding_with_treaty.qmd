```{python}
#| echo: false
#| fig-cap: "Monte Carlo Distribution: Total Global Research Funding (Baseline + 1% treaty Funding) (10,000 simulations)"
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines, get_tick_formatter,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata, get_figure_output_path
)
from dih_models.parameters import format_parameter_value

setup_chart_style()

# Simulation results
samples = [97146297812.8866, 84866832422.50783, 101628540773.9514, 103602671455.74832, 79517520199.46948, 83276171337.81139, 95422935904.02017, 91229649108.92828, 94036399145.76273, 86406119404.04439, 102963369555.01779, 101910112773.4116, 94827942553.15002, 105214691549.02228, 98759925713.536, 86351500601.64624, 97777842054.51031, 85485623588.55043, 102953495769.72841, 93721710795.19449, 92450647578.0274, 87924240028.80531, 105948747869.45273, 92734864253.50008, 90200727650.44664, 90898905664.1933, 99409667880.22015, 97745128606.30634, 98213997988.28206, 98393939857.09995, 110900000000.0, 90400966324.17813, 89438008524.78177, 86750183001.21289, 100254949482.2093, 105227961974.17024, 93116481643.99043, 86518878481.25171, 86656227953.0384, 100606730650.3902, 101554550769.11952, 99518827394.50304, 88061544504.26672, 96435631810.4851, 95315283998.50632, 96304243224.24556, 102880368200.40334, 96352076012.07791, 100895477249.13089, 94842802104.98303, 96993081683.83821, 100410383325.10211, 82355743355.68805, 91198001623.31952, 89817764223.71062, 88299190556.14339, 91609876722.97293, 108086618951.97691, 86294382835.56694, 103893633873.79333, 81040898578.11224, 91057704813.81934, 95760661126.58447, 99953506925.9678, 101225939448.53198, 102070659031.91052, 90930263974.05927, 89890696148.64333, 102740404416.66608, 92390399156.48367, 83434976581.18442, 84295919266.35928, 85827403478.29556, 99056708893.59113, 95563881002.70494, 101013696685.1183, 90210542224.2694, 95719840001.07523, 100352503774.86877, 91293335526.068, 98652706597.65784, 88093486508.23431, 90798510760.8831, 90626997512.85527, 83916191154.099, 98954633328.26523, 89826583928.23227, 94315587507.41798, 98892309001.46558, 98550490910.60109, 100757443629.64166, 93262292791.63354, 90246647932.36172, 93439580751.84396, 81015194141.68863, 82414953401.57147, 83153463809.61928, 85154390975.23227, 98085291382.71304, 85948850376.32019, 90659792839.57721, 106544626489.87585, 90860919912.67792, 101495592876.72389, 85704461587.64249, 92258355681.19727, 85562307572.90718, 91019490354.25107, 102556878639.88956, 80785502482.4701, 98429817990.29483, 96490045656.69466, 88699758317.17056, 82421174360.8272, 94886485630.02887, 89282021070.97281, 96440656653.79895, 94404945478.94836, 108941425964.58165, 91942236568.1221, 84968277325.48346, 95920907533.2196, 96316992088.49696, 107013777010.54298, 102502957743.85605, 97660366650.72147, 107835258773.13083, 83959028829.58118, 88291384176.23666, 85765555023.70348, 90553000372.8169, 82831852801.08868, 100449640492.20218, 92101781219.13972, 82275364645.34186, 85017061185.22705, 97232815248.35785, 102534240081.16931, 110900000000.0, 110900000000.0, 98230665026.72118, 85220843925.8171, 78512497592.31647, 96783184768.97319, 86757483915.55162, 90319198687.92737, 88538814663.15355, 92863881155.48422, 104746569914.54181, 95705397472.0681, 92696346334.9225, 84893461333.50198, 81088063018.83696, 89673043995.09247, 93685140860.22073, 110289405435.74585, 95446443501.18962, 104045784280.55484, 89555265364.90625, 83982161457.90645, 85431710960.27148, 87530995658.19359, 110900000000.0, 86683368603.36562, 102538002875.32352, 85971048307.57841, 103508443762.27437, 97938269092.73822, 92715080340.31776, 93808658310.14954, 88157144012.72705, 98545913722.65253, 89957746779.52673, 83736341378.81836, 83421465495.94754, 95856013510.78035, 108759124157.47289, 95733904935.3341, 93072290408.05362, 96960762889.0855, 106597481876.17769, 96311005939.12085, 90359697507.87169, 105054255926.9739, 98373385077.39632, 108412080338.05975, 95959342327.95041, 83743199622.48819, 82882532481.43942, 109337799619.1886, 109928060672.50685, 92500649181.83463, 90613705811.29831, 107820517774.88133, 84455941205.12715, 86042417584.25502, 100532782975.51979, 90509069133.18915, 94147605325.18901, 92651255712.64322, 97469849425.15125, 107393742178.80666, 95063861089.78535, 100539009328.25653, 78964792544.89967, 93733163730.03168, 86491970891.47424, 83777335583.3883, 86186854405.34253, 91064722806.05519, 103344431368.2905, 83131406724.54164, 94488854725.48415, 89692451571.83902, 91124183995.04762, 104256771117.50087, 99468094910.7583, 106842954373.1646, 92735087626.78354, 87790763303.2733, 92086533453.85071, 96536546759.21158, 95894680802.65024, 84594452471.53088, 95062945987.93298, 96397257999.5004, 110900000000.0, 110900000000.0, 86404375702.76767, 91496466301.29843, 82318714272.63953, 88730667353.22145, 97253393393.99646, 105819694736.04509, 87496831478.24371, 88162864856.42778, 78460000000.0, 92658540826.36069, 84729088032.16579, 89282502465.5112, 86198119901.80042, 93302156002.56839, 80611454532.50406, 82297499857.6465, 110900000000.0, 83364574359.31161, 84518624047.89575, 110855799280.19336, 110900000000.0, 84063254922.86552, 90750788847.33939, 97509123977.29504, 109969056139.73824, 85243968011.2555, 91887152207.27612, 101905427128.06874, 98433228887.05823, 90678202794.5734, 92929384362.39595, 82842489984.76651, 91953233579.46037, 91691073324.15027, 96435715410.20488, 89048914485.12212, 98800201823.47934, 104341918836.45009, 95689716520.7776, 97609832723.17343, 94704469405.66167, 94197219907.99184, 87563491866.57214, 97262145510.57365, 93273608189.59549, 110900000000.0, 108713097502.52971, 97947145573.91003, 87196540835.90979, 84423185628.3782, 105706112591.89091, 96734596751.80942, 98886272127.32912, 80686612429.12712, 103465145108.77849, 98629199929.45238, 84435275304.61766, 89807292811.19452, 96744072857.65916, 94697870827.64503, 91452146673.73187, 93215090037.49736, 91824877599.72556, 95661960167.212, 107900241581.98096, 78460000000.0, 91965549652.87425, 95894089465.32486, 97060581032.03346, 90717131775.02133, 80617207505.13853, 97375412036.26407, 109958076463.97878, 81905520244.5487, 102801266519.06728, 91116326596.2164, 93613668299.07806, 84787486729.54008, 91061656640.48285, 106550994389.38565, 99917432819.82372, 109998512313.86127, 105600247376.10924, 98476275857.30934, 110093320299.46782, 98475343899.27179, 102429097648.49832, 91411438113.3081, 94832885827.24881, 87777605278.24414, 104117874302.59564, 84022400830.34149, 101957133917.37833, 92396507047.92819, 105552765482.52318, 101632837607.0476, 110721876593.21765, 101426381424.19337, 81682736339.12619, 93560360213.72218, 84060582425.32524, 89383385371.85423, 108216332423.31635, 100473865400.52475, 87764223697.4802, 85028536573.11417, 94509420614.38245, 83790938240.9369, 88011382790.26784, 97218014041.57608, 105430169960.22958, 100181747448.38396, 78460000000.0, 97142853659.36658, 94885564465.78072, 98225504570.45705, 109057600821.11458, 78892358498.95023, 88727108019.71503, 100000896085.81895, 81627120620.2693, 107935632570.8519, 97773941933.9408, 102622032180.29086, 88908301499.9555, 102281761198.02832, 104765550328.43399, 96442626196.14708, 96457489889.08968, 96808963860.99832, 86316093291.8367, 92800585222.1537, 92753700002.2194, 97922838009.46628, 104225825372.53818, 84752882356.47578, 93012307537.02513, 107979378592.57068, 87368500850.23172, 86675795836.86655, 96144720071.73001, 102599200389.30821, 94305394160.26697, 106776908550.64098, 102728117059.89981, 102572571149.32727, 99629287892.08008, 110900000000.0, 92260931253.60709, 79224189126.29675, 108961342577.06058, 89933026183.20953, 95230390065.2257, 106625189984.61952, 81507011394.40971, 83579442640.88962, 81512710926.17926, 86922735642.28487, 98481756231.65027, 99328002169.70267, 96867084483.11745, 82617899992.95088, 78460000000.0, 94715953581.90703, 89805009689.17323, 98678771567.72194, 101130995230.04965, 95523424773.57083, 101728161828.61719, 96406848027.64676, 99387091371.84885, 87713234883.24585, 92499786132.85623, 96090930624.82852, 102351804023.63687, 90516982447.56708, 99297645201.26923, 91696164656.3522, 93082615106.11652, 102444966911.56296, 79282531974.55078, 83310345089.57874, 82208445847.6015, 78460000000.0, 87947955882.85364, 101618079050.48196, 91519610150.43568, 96100791077.96783, 104923792423.8946, 106766937483.86565, 93539677498.10391, 106969825357.7972, 95078693914.88037, 86543030999.48793, 88697510800.72229, 82218137891.4866, 86099843518.08047, 90844805704.88412, 102176461203.68668, 109904477154.41695, 82799214533.82088, 98016363537.70825, 84863390663.83554, 98831786666.24258, 92955120208.25006, 80194805643.11255, 103474134317.63373, 88602415988.30434, 89242208494.2769, 84684093636.35304, 88161644062.12006, 98364764492.55592, 92409660877.55869, 97381980097.89609, 97710295342.80551, 106712002801.71152, 90984928441.40588, 82239766901.82452, 104756033031.43298, 91089010797.24254, 105117797631.287, 97922672016.37758, 92954641606.2343, 97580396615.43777, 110900000000.0, 110900000000.0, 94860099259.25781, 95735832635.20856, 104824767118.25699, 86470698236.85347, 97425432577.83546, 93950207364.39427, 97236695677.49112, 86578326534.88188, 81580749745.21375, 78838397618.27911, 84392846003.60547, 89924145614.46622, 91442703867.76541, 110900000000.0, 105051996918.59634, 85457872303.91977, 97569856525.213, 90394899317.76434, 91524428279.2361, 95979651480.97572, 100287335631.6142, 91017414210.85272, 104730356024.81213, 84243258641.8168, 94256860195.06827, 110900000000.0, 96347046835.42133, 107596962994.67374, 95072858836.279, 99898444286.41545, 93656697636.30147, 92585978915.94409, 87051728436.35117, 98388765882.75122, 86419295059.22633, 100759484193.49109, 104893786473.21785, 97755884504.32819, 91506972401.62688, 98624661159.24896, 91299557669.01477, 103550079519.66113, 80191967997.92685, 91051049018.01382, 79295078573.10822, 82132820756.92587, 107050474225.9316, 103127993321.01218, 87581905087.26671, 82089150957.53949, 78460000000.0, 89155597196.58063, 110900000000.0, 98434406254.89328, 89010669214.01468, 98735651781.28764, 81747313089.37985, 91404478311.97992, 95149446186.52583, 93379250245.17598, 102044414923.21985, 97539616057.63608, 100787434260.6827, 87858043507.40002, 103155448456.40082, 109160203180.29163, 85388212803.19415, 86103661545.38104, 106830317971.34804, 92390028341.15485, 107364877229.79668, 90071133407.43704, 107769789329.89845, 95458143793.51132, 96690356223.38731, 108643848622.91974, 90810303563.65227, 85639401913.38657, 90016202044.67656, 98608378232.88873, 81719329272.08882, 100473225781.4101, 89198229391.3353, 105372542680.54794, 78460000000.0, 86989352194.52126, 81020180684.94632, 86640898667.17795, 96587057277.45451, 92503388021.78955, 91811867647.24496, 92691186930.25925, 96155248332.17299, 85060485088.53511, 101181113601.42311, 100729722498.06985, 97939131063.95233, 99653658597.10374, 97064745795.5689, 110900000000.0, 93369862433.99478, 91314247438.69695, 87280669071.93948, 84914322521.35289, 83622632813.15448, 86094063105.66809, 93525078206.57608, 97437508208.46432, 94685176733.76431, 87174677569.26913, 103180182828.33243, 101515079763.59029, 92686840053.56813, 88173841753.80058, 99571951844.49336, 96005373537.1054, 82408968027.19887, 93550636448.16678, 96727613334.63843, 85999174037.53432, 96023540968.88052, 82369494014.88455, 106833463729.91016, 106145665026.3869, 91819860348.33862, 97725449474.62943, 78460000000.0, 84155648095.84851, 91437269116.16045, 84669503671.89474, 101258415993.60173, 110900000000.0, 84032639951.89842, 86542460173.74188, 96467714895.03242, 109016575925.05841, 83755839766.8576, 96600450973.8512, 110727245683.60226, 81220336648.95175, 83402675869.32678, 90243832479.45378, 89362506493.3036, 102269730471.89474, 96528369710.28093, 80513052013.31781, 99239814391.18704, 88848983728.32152, 106351561871.36667, 88400131723.65121, 88319409807.1318, 99498459556.33612, 101756922419.8823, 98566131488.40543, 81025193868.77753, 99467279618.85951, 84901738927.6424, 96466033324.60751, 82553012065.70398, 98548406318.38023, 86813182293.41406, 83393285537.92221, 101252510390.43277, 96528221251.49823, 88521972091.62973, 107739150273.9827, 90088300728.29851, 94502970759.21268, 96794957745.73044, 88471023786.03072, 98796180360.67618, 89246253420.41014, 90353195568.65594, 107040898453.87543, 84863131765.9392, 78460000000.0, 109015133354.42952, 110900000000.0, 90411448388.89523, 79597132441.40776, 91282828012.86891, 91507211160.23747, 92403306820.55338, 84417226060.63968, 99886152622.96608, 99331214021.07945, 82136666805.41736, 101102785027.45203, 110900000000.0, 95849926013.5788, 91035222809.17198, 92852489164.22882, 100247618142.12567, 80766294694.0213, 95776532021.41537, 90547006303.1349, 110900000000.0, 92550709011.3811, 109475035602.1122, 84476125454.57826, 99963994924.00949, 97290752002.6767, 86266302490.0083, 95902665238.18683, 105871213363.61844, 91159982500.16255, 80988560407.84846, 94029151361.03467, 85975433838.51886, 90989027696.00499, 93421904569.95386, 80909855209.95801, 81429270245.77368, 98905521505.34523, 89343244383.87115, 78460000000.0, 101982866197.01027, 96828818909.20923, 87631598879.39998, 83188535892.72688, 102510184267.61137, 97586072048.93594, 110900000000.0, 98288129647.34454, 97965549458.80907, 92618586348.39038, 102312943464.42159, 100347373551.48676, 106174964953.7688, 89355864592.70465, 90136128829.84619, 89738446823.6792, 102044369481.48108, 108113943106.58284, 89922642256.19571, 90233174713.1867, 97238358758.73856, 91882655051.24672, 103723193507.6939, 78460000000.0, 86636729076.38295, 87025886755.26476, 78460000000.0, 85444492281.99109, 85864724917.09462, 92298816905.85455, 105105346719.4703, 91889171818.78195, 84923238338.78854, 93655073693.41919, 104618652721.74977, 85338030552.28113, 85904540609.44258, 99673986179.88104, 92108180544.0292, 100575092179.41579, 94066420973.19998, 101128027629.01755, 84897002028.63153, 94081292274.17569, 92209331331.72232, 83794979499.49231, 81732624442.82874, 100965292888.7525, 90909771294.99533, 84975773778.85054, 93284063806.3222, 105220652692.46005, 78460000000.0, 82123559861.20755, 85797582146.94322, 107818412848.37015, 96928985540.61221, 101802145751.08838, 84254073718.75662, 84379722193.67912, 98563282354.4446, 94753540609.59442, 99575084579.30826, 92424375070.50284, 96885412461.1554, 95715765928.49509, 101909859630.25568, 102211863303.65448, 81404844107.48477, 78460000000.0, 104246090177.86374, 105679747381.95848, 84985981874.2352, 80030943842.67029, 95145184130.40842, 103500747426.65263, 110532481113.68294, 99248724306.61859, 90718948396.4922, 86056318560.29834, 94305634995.13852, 91386523310.79291, 85020211793.39722, 110900000000.0, 110430570532.33612, 105282233586.5768, 85815261382.14099, 102709669965.0727, 100495144201.60579, 98510751528.84608, 106158976829.52892, 100451878826.04263, 101521259758.44623, 100467485201.50946, 97501584102.65067, 80463731698.58224, 94996892569.17667, 89041122412.03482, 83410044584.66548, 109587925012.35931, 109971482153.62433, 107014036204.30873, 96660856121.48108, 106946604850.41759, 94311379162.66891, 96149498152.83289, 84538885785.21674, 98057672565.96861, 94773790050.10565, 83273342308.27899, 93709655271.28122, 93439473402.61874, 110532207379.64275, 103117853514.49344, 94305579142.37292, 96598018732.78255, 94618801977.79886, 92281918982.81586, 84606454782.30646, 92767504912.8649, 87346311968.67352, 83587455847.909, 99197758846.32077, 98000863555.39801, 80446085493.73615, 93034188196.40112, 104182349644.30426, 104695119113.23099, 104441396054.73415, 94568076174.40472, 86476086041.18787, 84598670994.65343, 97539218062.51135, 97882081109.94678, 106451877036.88731, 105006013729.07782, 92944378436.9178, 83624233971.47299, 91203212516.39723, 96290041098.6514, 92289677143.72531, 88845789979.93271, 96638081275.00742, 89513024550.59695, 88395850924.79042, 97212537987.48178, 90441432317.90079, 96552252743.88774, 96836993935.24988, 84258528076.16734, 89719034040.13016, 107633049905.24234, 84120833665.07071, 78597238786.56319, 80019578226.76202, 94474307097.75813, 94491587393.67229, 93081968100.6407, 105884134737.2106, 78460000000.0, 98047180252.49203, 108617567589.41016, 84329462396.95248, 90644711923.84021, 87286283637.6655, 86045734784.12402, 91137197006.7854, 107551671000.16483, 110859697828.85547, 91047991372.31601, 110900000000.0, 94536149605.18869, 110172990553.85674, 93311257364.896, 95454009528.85556, 97745429386.18106, 110900000000.0, 102670869461.40485, 87690237540.86716, 103901198863.31622, 90809733266.05476, 89641812716.93228, 103268103529.1918, 94493196801.203, 96889649880.87222, 94329820092.91539, 97460071016.35509, 98335657676.04984, 79596409145.72762, 100769552981.33138, 85285708877.84236, 82443351646.07202, 93641268902.59851, 95000352684.25769, 87812411248.2808, 102460651484.44307, 83037239357.7821, 90396129550.88312, 88783056654.56189, 93753380419.05548, 96892477330.2478, 85064451629.37836, 101359769779.43024, 94798886746.71346, 79849626914.69725, 79475194477.66315, 94079058373.21048, 92113482397.88544, 93215732934.88062, 93930057757.9975, 96371230504.47414, 103676977339.35344, 84431159971.23766, 84060798371.66626, 84539787776.7629, 96991091842.48294, 106122368267.68433, 90173242270.07574, 78460000000.0, 80919389463.36508, 86581236046.8927, 89027275007.47763, 90382913315.36314, 94564898238.94412, 91271167935.52316, 104619915015.90318, 87967957337.43495, 86325066971.9115, 98873585602.6088, 81895110325.95895, 97985265417.13739, 95179065809.83151, 92801394635.59198, 108832876420.80093, 88448273083.09824, 110900000000.0, 92071879737.13768, 83426993362.39005, 94865268152.11934, 84644309826.32748, 87296318997.57552, 98058089288.22061, 99644065112.80342, 88448628821.50946, 104094920423.56284, 105447050822.25568, 107621379998.02344, 99380541127.99722, 107047070268.06767, 79912507023.7197, 91214288796.84547, 86284130246.53767, 95339787109.22789, 88903753089.15057, 92625804312.93716, 110900000000.0, 92592423161.64838, 98224530773.33556, 92008191784.9566, 94920903546.89268, 94253785256.65585, 98568372794.1409, 105507046562.42137, 109309233192.92706, 97194510020.57973, 99987139996.62997, 84188970963.20953, 93362468543.94908, 103599785711.57033, 102823537994.31696, 96235280557.37927, 103036289838.5827, 98992635161.7614, 105776843168.81973, 96995435001.1445, 90866121071.46043, 97452754588.7573, 78460000000.0, 97917802920.65399, 78460000000.0, 80807617639.65378, 98602736922.20526, 98860117009.13504, 84118712922.51453, 87647321043.41974, 107102934465.09335, 89693715940.27794, 110900000000.0, 94178116759.41316, 98167332072.79073, 109062956225.79724, 95453712887.61044, 85110479406.83237, 93156254958.37343, 93857576905.10173, 82902856926.9663, 91789065945.60886, 87380845252.66054, 103432894168.29553, 94526922081.11554, 91538952771.78659, 93189684424.7392, 96347459019.87518, 100263418962.26965, 85133148912.70863, 84856974735.41766, 105041945989.61493, 90346808758.58948, 82593777436.04935, 98523383720.6853, 98718563574.82411, 81923917502.44113, 96409485494.16875, 101475746495.91548, 97833621068.54993, 100417427835.34375, 82668215224.74734, 97405418695.17566, 91355501517.68799, 89704971303.81009, 102871277981.05609, 107962048556.30153, 110506023838.99342, 106666253474.35535, 93156191515.58942, 97619352840.9375, 101797052916.07843, 95358622592.44327, 95451173174.55008, 102385209110.65756]  # Truncate for embedding
baseline = 94680000000.0
mean = 94451700657.26451
std = 8456852864.867754
p5 = 81091460414.41083
p50 = 94070983463.67207
p95 = 109271628414.21606
display_name = "Total Global Research Funding (Baseline + 1% treaty Funding)"
units = "USD"

# Create figure with two subplots
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))
fig.subplots_adjust(wspace=0.3)

# --- Left: Histogram ---
# Handle edge case where all samples are identical (zero variance)
if std == 0 or (max(samples) == min(samples)):
    n_bins = 1
else:
    n_bins = min(50, max(1, int(np.sqrt(len(samples)))))
n, bins, patches = ax1.hist(samples, bins=n_bins, color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)
ax1.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key statistics with formatted values in legend (use format_parameter_value for full units)
ax1.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=2, label=f'Median: {format_parameter_value(p50, units)}')
ax1.axvline(p5, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'5th %-ile: {format_parameter_value(p5, units)}')
ax1.axvline(p95, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'95th %-ile: {format_parameter_value(p95, units)}')
ax1.axvline(baseline, color=COLOR_BLACK, linestyle='-', linewidth=1.5, alpha=0.5, label=f'Baseline: {format_parameter_value(baseline, units)}')

ax1.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax1.set_ylabel('Frequency', fontsize=11)
ax1.set_title('Distribution of Outcomes', fontsize=12, weight='bold')
ax1.legend(loc='upper right', fontsize=9)
clean_spines(ax1)

# --- Right: CDF (Cumulative Probability) ---
sorted_samples = np.sort(samples)
cumulative = np.arange(1, len(sorted_samples) + 1) / len(sorted_samples)

ax2.plot(sorted_samples, cumulative * 100, color=COLOR_BLACK, linewidth=2)
ax2.fill_between(sorted_samples, 0, cumulative * 100, alpha=0.1, color=COLOR_BLACK)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)
ax2.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key percentiles
ax2.axhline(50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)
ax2.axhline(5, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axhline(95, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)

ax2.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax2.set_ylabel('Cumulative Probability (%)', fontsize=11)
ax2.set_title('Probability of Exceeding Value', fontsize=12, weight='bold')
ax2.set_ylim(0, 100)
clean_spines(ax2)

# Add annotation for "probability of exceeding baseline"
exceed_baseline_pct = (np.array(samples) > baseline).sum() / len(samples) * 100
ax2.annotate(f'{exceed_baseline_pct:.0f}% chance of\nexceeding baseline',
             xy=(baseline, exceed_baseline_pct), xytext=(baseline * 1.1, exceed_baseline_pct + 10),
             fontsize=9, ha='left',
             arrowprops=dict(arrowstyle='->', color=COLOR_BLACK, lw=1))

# Main title
fig.suptitle(f'Monte Carlo Analysis: {display_name}', fontsize=14, weight='bold', y=1.02)

# Add watermark
add_watermark(fig)

# Save PNG to knowledge/figures/ regardless of where Quarto renders from
output_path = get_figure_output_path('mc-distribution-total_research_funding_with_treaty.png')
plt.savefig(output_path, dpi=150, bbox_inches='tight', facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title=f'Monte Carlo: {display_name}',
    description=f'Monte Carlo simulation results showing uncertainty distribution for {display_name}'
)

plt.show()
```

**Key Statistics:**

| Statistic | Value |
|:----------|------:|
| Baseline (deterministic) | 9.468e+10 |
| Mean (expected value) | 9.445e+10 |
| Median (50th percentile) | 9.407e+10 |
| Standard Deviation | 8.457e+09 |
| 90% Confidence Interval | [8.109e+10, 1.093e+11] |

*The histogram shows the distribution of Total Global Research Funding (Baseline + 1% treaty Funding) across 10,000 Monte Carlo simulations. The CDF (right) shows the probability of the outcome exceeding any given value, which is useful for risk assessment.*
