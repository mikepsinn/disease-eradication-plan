{{< include /knowledge/includes/setup-parameters.qmd >}}

```{python}
#| fig-cap: "War's Hidden Costs + Direct Spending vs Curing Diseases"
from pathlib import Path

import matplotlib.pyplot as plt
import numpy as np
from matplotlib.patches import FancyBboxPatch, FancyArrowPatch
from matplotlib import patheffects
from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_WHITE, PATTERN_DIAGONAL,
    add_png_metadata, get_figure_output_path)

# Setup styling with higher DPI for crisper text

setup_chart_style(style='light', dpi=200)

# Scale constant for USD values

BILLION = 1_000_000_000

# War costs breakdown (from cost-of-war.qmd)

war_direct = GLOBAL_MILITARY_SPENDING_ANNUAL_2024  # Direct military spending

# Indirect/externality costs

war_infrastructure = GLOBAL_ANNUAL_INFRASTRUCTURE_DESTRUCTION_CONFLICT  # Infrastructure destruction
war_lives_trade = GLOBAL_ANNUAL_HUMAN_LIFE_LOSSES_CONFLICT + GLOBAL_ANNUAL_TRADE_DISRUPTION_CONFLICT  # Human life losses + trade disruption
war_longterm = GLOBAL_ANNUAL_LOST_ECONOMIC_GROWTH_MILITARY_SPENDING + GLOBAL_ANNUAL_VETERAN_HEALTHCARE_COSTS + GLOBAL_ANNUAL_REFUGEE_SUPPORT_COSTS + GLOBAL_ANNUAL_ENVIRONMENTAL_DAMAGE_CONFLICT + GLOBAL_ANNUAL_PSYCHOLOGICAL_IMPACT_COSTS_CONFLICT + GLOBAL_ANNUAL_LOST_HUMAN_CAPITAL_CONFLICT  # Lost growth, veterans, refugees, environment
war_indirect_total = war_infrastructure + war_lives_trade + war_longterm

# Total war cost

total_war = war_indirect_total + war_direct

# Cure research

cure_research = GLOBAL_MED_RESEARCH_SPENDING  # Global government clinical trials

categories = ['War\'s Hidden\nCosts', 'War Direct\nSpending', 'Curing\nDiseases']

# Create figure with more vertical space

fig, ax = plt.subplots(figsize=(30, 16))

# Plot single solid bar for indirect war costs (white bar with black text)

bar1 = ax.bar(0, war_indirect_total, color=COLOR_WHITE, edgecolor=COLOR_BLACK,
               linewidth=4, width=0.75)

# Add large total at top - no decimal

ax.text(0, war_indirect_total * 0.92, f'${war_indirect_total/BILLION:.0f}B', ha='center', va='center',
        fontsize=72, weight='bold', color=COLOR_BLACK)
ax.text(0, war_indirect_total * 0.82, 'Indirect War Costs', ha='center', va='center',
        fontsize=40, weight='bold', color=COLOR_BLACK)

# Add breakdown text with better formatting - rounded numbers

breakdown_text = (
    '3 MILLION DEAD CIVILIANS\n'
    '$2 TRILLION IN RUBBLE\n'
    '$616 BILLION IN LOST TRADE\n'
    '$2 TRILLION IN PTSD\n'
    '11 MILLION REFUGEES\n'
    '$500 BILLION IN POLLUTION\n'
    '$2 TRILLION IN LOST GROWTH'
)
ax.text(0, war_indirect_total * 0.4, breakdown_text, ha='center', va='center',
        fontsize=24, weight='bold', color=COLOR_BLACK, linespacing=1.8,
        fontfamily='monospace')

# Plot direct military spending bar (diagonal pattern)

bar2 = ax.bar(1, war_direct, color=COLOR_WHITE, edgecolor=COLOR_BLACK,
               linewidth=4, width=0.75, hatch='///')
ax.text(1, war_direct * 0.6, f'${war_direct/BILLION:.1f}B', ha='center', va='center',
        fontsize=72, weight='bold', color=COLOR_BLACK)
ax.text(1, war_direct * 0.4, 'Direct Military', ha='center', va='center',
        fontsize=40, weight='bold', color=COLOR_BLACK)

# Plot cure research bar (solid black)

bar3 = ax.bar(2, cure_research, color=COLOR_WHITE, edgecolor=COLOR_BLACK,
               linewidth=4, width=0.75)

# Label for cure research

ax.text(2, cure_research + (war_indirect_total * 0.02), '$68B\nCuring Diseases', ha='center', va='bottom',
        fontsize=44, weight='bold', color=COLOR_BLACK, linespacing=1.2)

# Remove all axis labels and ticks (all columns are labeled with amounts)

ax.set_xticks([])
ax.set_xticklabels([])
ax.set_yticks([])
ax.set_yticklabels([])

# Remove all spines for ultra-clean look

clean_spines(ax, ['top', 'right', 'left', 'bottom'])

# Set y-axis limits to show the full scale

ax.set_ylim(0, war_indirect_total * 1.15)

# Add branding

add_watermark(fig)

# Save in brain/figures directory with higher quality

output_path = get_figure_output_path('war-hidden-direct-curing-diseases-column-chart.png')

# Save the figure

plt.savefig(output_path, dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)

# Add metadata for attribution

add_png_metadata(output_path, title="War Hidden Direct Curing Diseases Column Chart")
plt.show()
```
