```{python}
#| echo: false
#| fig-alt: "DIH Architecture showing treasury flowing to campaigns via Wishocracy allocation"

import graphviz
from pathlib import Path
from IPython.display import Image as IPImage, display

from dih_models.plotting.graphviz_helper import (
    setup_graphviz_style,
    render_graphviz_with_watermark
)

# Create diagram
dot = graphviz.Digraph(comment='DIH Architecture', format='png')
dot.attr(rankdir='TB', size='12,14')

# Apply design guide styling
setup_graphviz_style(dot)

# DIH Treasury (top)
dot.node('Treaty', '1% Treaty\n$1T/year', shape='box', style='filled', fillcolor='white')
dot.node('Treasury', 'DIH Treasury\nDecentralized Governance Layer', shape='box', penwidth='3')

# Wishocracy voting
dot.node('Wishocracy', 'Wishocracy\nPairwise Allocation Voting', shape='diamond', style='filled', fillcolor='white')

# Campaign categories
with dot.subgraph(name='cluster_campaigns') as campaigns:
    campaigns.attr(label='Campaign Proposals (Anyone Can Submit)', style='dashed')

    campaigns.node('PatientSubs', 'Patient Subsidies\n$800B/year\n(Automatic Formula)', shape='box')
    campaigns.node('dFDA', 'dFDA Platform\n$10B/year\n(One of many campaigns)', shape='box')
    campaigns.node('Infrastructure', 'Infrastructure Services\n$20B/year total\n(Competing providers)', shape='box')
    campaigns.node('Prizes', 'Research Prizes\n$100B total\n(Cure bounties)', shape='box')
    campaigns.node('PublicGoods', 'Public Goods\n$30B/year\n(Market failures)', shape='box')

# Outcomes
dot.node('Outcomes', 'Outcomes:\nCures, Trials, Data', shape='ellipse', style='filled', fillcolor='white')

# Connections
dot.edge('Treaty', 'Treasury', label='Funds')
dot.edge('Treasury', 'Wishocracy', label='Allocates via')
dot.edge('Wishocracy', 'PatientSubs', label='80%')
dot.edge('Wishocracy', 'dFDA', label='Vote')
dot.edge('Wishocracy', 'Infrastructure', label='Vote')
dot.edge('Wishocracy', 'Prizes', label='Vote')
dot.edge('Wishocracy', 'PublicGoods', label='Vote')

# All campaigns lead to outcomes
dot.edge('PatientSubs', 'Outcomes')
dot.edge('dFDA', 'Outcomes')
dot.edge('Infrastructure', 'Outcomes')
dot.edge('Prizes', 'Outcomes')
dot.edge('PublicGoods', 'Outcomes')

# Render with watermark
png_path = render_graphviz_with_watermark(dot, 'dih-architecture-diagram')
display(IPImage(str(png_path)))
```
