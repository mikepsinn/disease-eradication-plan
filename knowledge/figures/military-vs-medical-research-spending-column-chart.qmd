```{python}
#| echo: false
from dih_models.parameters import *
```

```{python}
#| fig-height: 6
from pathlib import Path

import matplotlib.pyplot as plt
import numpy as np
from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_WHITE, PATTERN_DIAGONAL,
    add_png_metadata, get_figure_output_path)

# Setup minimalist styling

setup_chart_style(dpi=150)

# Create figure

fig, ax = plt.subplots(figsize=(12, 6))

# Data

categories = ['War on\nHumanity', 'War on Disease']
# Work in billions to prevent matplotlib from expanding the canvas to trillions
BILLION = 1_000_000_000
TRILLION = 1_000_000_000_000

# Convert Parameter -> float once, then scale for plotting
military_total_raw = float(GLOBAL_MILITARY_SPENDING_ANNUAL_2024)
cure_spending_raw = float(GLOBAL_MED_RESEARCH_SPENDING)

military_total = military_total_raw / BILLION
cure_spending = cure_spending_raw / BILLION
military_total_trillions = military_total_raw / TRILLION

# Make the 1% stack visually prominent (exaggerate it to ~100B so it's actually visible)

visual_stack_height = 100  # Visual height for the 1% slice (much larger than actual 27B)
military_99_visual = max(military_total - visual_stack_height, 0)

# Create stacked bar for military spending

x_positions = [0, 1]
bar_width = 0.8

# War on Humanity - stacked bar (lower part solid black, top part with diagonal pattern)

bar_99 = ax.bar(x_positions[0], military_99_visual, bar_width,
                color=COLOR_BLACK, edgecolor=COLOR_BLACK, linewidth=2)
bar_1 = ax.bar(x_positions[0], visual_stack_height, bar_width, bottom=military_99_visual,
               color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=2, hatch='////')

# War on Disease - solid black bar

bar_cure = ax.bar(x_positions[1], cure_spending, bar_width,
                  color=COLOR_BLACK, edgecolor=COLOR_BLACK, linewidth=2)

# Add custom labels
# Main label inside the 99% bar (white text on black)

ax.text(x_positions[0], military_99_visual * 0.6,
        f'${military_total_trillions:.1f}T', ha='center', va='center',
        color=COLOR_WHITE, fontsize=72, fontweight='bold')
ax.text(x_positions[0], military_99_visual * 0.35,
        categories[0], ha='center', va='center',
        color=COLOR_WHITE, fontsize=44, fontweight='bold')

# Label above small bar (as it was originally)

ax.text(x_positions[1], cure_spending + (military_total * 0.025),
        f'${cure_spending:.0f}B\n{categories[1]}', ha='center', va='bottom',
        color=COLOR_BLACK, fontsize=44, fontweight='bold', linespacing=1.2)

# Set x-axis with category labels

ax.set_xticks(x_positions)
ax.set_xticklabels(['', ''])  # We'll keep labels on the bars themselves

ax.set_ylim(0, 2900)
ax.axis('off')  # Remove axes - labels are on the bars

# Add watermark

add_watermark(fig)

# Save in brain/figures directory

output_path = get_figure_output_path('military-vs-medical-research-spending-column-chart.png')

# Save the figure

plt.savefig(output_path, dpi=300, bbox_inches=None, facecolor=COLOR_WHITE)

# Add metadata for attribution

add_png_metadata(output_path, title="Military Vs Medical Research Spending Column Chart")
plt.show()

```
