```{python}
#| echo: false
from dih_models.parameters import *
```

```{python}
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

# Import centralized style

from dih_models.plotting.chart_style import setup_chart_style, add_watermark, COLOR_BLACK, COLOR_WHITE, get_figure_output_path
from dih_models.plotting.chart_style import PATTERN_DIAGONAL, PATTERN_HORIZONTAL, PATTERN_CROSS, PATTERN_DOTS

setup_chart_style()

# Data: Two segments to show the stark contrast
# Based on FY2025 NIH budget of $47.7B
# Clinical development for drug trials = 3.3% of total NIH funding
# Source: PMC10349341 - NIH spent $8.1B on clinical development out of $247.3B total (2010-2019)
# FY2017-2021: $97B basic (72%), $28B clinical trials/related (21%), $9B training (7%)
# But only 3.3% goes to drug treatment trials patients can actually join

categories = [
    'Actually Testing\nTreatments in Humans\n$1.6B',
    'Everything Else\n(Basic Research, Training,\nInfrastructure, Admin,\nObservational Studies)\n$46.1B'
]

values = [1.6, 46.1]  # Billions (3.3% and 96.7% of $47.7B)
colors = [COLOR_WHITE, COLOR_WHITE]  # Both white fills
hatches = [None, PATTERN_DIAGONAL]  # No pattern for trials, diagonal for everything else

# Create figure

fig, ax = plt.subplots(figsize=(10, 8))

# Create pie chart with patterns - start with the small slice at top

wedges, texts, autotexts = ax.pie(
    values,
    labels=categories,
    autopct='%1.0f%%',
    colors=colors,
    wedgeprops={'edgecolor': COLOR_BLACK, 'linewidth': 3},
    textprops={'fontsize': 16, 'weight': 'bold', 'color': COLOR_BLACK},  # Adjusted for dense chart
    startangle=90,
    explode=(0.1, 0)  # Slightly separate the human trials slice to emphasize it
)

# Add white background boxes with black borders to labels

for text in texts:
    text.set_bbox(dict(boxstyle="round,pad=0.3", facecolor=COLOR_WHITE,
                      edgecolor=COLOR_BLACK, linewidth=2))

# Add white background boxes with black borders to percentage labels
# Per DESIGN_GUIDE: Use white boxes for labels placed ON patterned areas

for autotext in autotexts:
    autotext.set_bbox(dict(boxstyle="round,pad=0.4", facecolor=COLOR_WHITE,
                          edgecolor=COLOR_BLACK, linewidth=1))

# Add patterns to wedges

for wedge, hatch in zip(wedges, hatches):
    wedge.set_hatch(hatch)

# Make percentage text larger and bold (36-44pt for data per DESIGN_GUIDE)

for autotext in autotexts:
    autotext.set_fontsize(40)
    autotext.set_weight('bold')
    autotext.set_color(COLOR_BLACK)

# Add title (28-36pt per DESIGN_GUIDE)

plt.title('NIH Budget: Where Your $47.7 Billion Goes',
         fontsize=32, weight='bold', pad=35, color=COLOR_BLACK)

# Add watermark

add_watermark(fig)

# DON'T use plt.tight_layout() - it overrides margin settings

# Save the figure

output_path = get_figure_output_path('nih-budget-allocation-pie-chart.png')
plt.savefig(output_path,
            dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)

plt.show()
```
