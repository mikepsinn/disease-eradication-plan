```{python}
#| echo: false
#| fig-cap: "Probability of Exceeding Threshold: Thalidomide Deaths Per Event"
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata
)

setup_chart_style()

# Monte Carlo samples
samples = [384, 265, 434, 458, 206, 247, 366, 324, 352, 279, 450, 437, 359, 482, 402, 279, 391, 271, 450, 348, 336, 293, 494, 338, 314, 320, 409, 391, 396, 397, 585, 316, 307, 282, 418, 482, 342, 280, 281, 423, 434, 410, 294, 377, 365, 375, 449, 376, 426, 360, 383, 420, 236, 323, 310, 296, 327, 533, 278, 461, 222, 322, 369, 415, 430, 440, 321, 311, 447, 335, 248, 258, 274, 405, 367, 427, 314, 369, 419, 324, 401, 294, 319, 318, 254, 404, 310, 354, 403, 400, 424, 344, 314, 345, 222, 237, 245, 268, 394, 275, 318, 505, 320, 433, 273, 334, 272, 322, 445, 219, 398, 377, 300, 237, 360, 305, 377, 355, 549, 331, 267, 371, 375, 514, 445, 389, 528, 254, 296, 273, 317, 242, 421, 332, 235, 267, 385, 445, 585, 585, 396, 269, 198, 380, 282, 315, 298, 340, 474, 369, 338, 266, 223, 309, 348, 575, 366, 463, 308, 255, 271, 289, 585, 282, 445, 275, 457, 393, 338, 349, 295, 400, 312, 252, 248, 370, 546, 369, 342, 382, 506, 375, 315, 479, 397, 539, 371, 252, 242, 556, 568, 336, 318, 528, 260, 276, 422, 317, 353, 338, 388, 520, 362, 422, 201, 349, 280, 253, 277, 322, 454, 245, 356, 309, 323, 465, 410, 511, 338, 292, 332, 378, 371, 262, 362, 376, 585, 583, 279, 326, 236, 300, 385, 492, 289, 295, 197, 338, 264, 305, 277, 344, 218, 236, 585, 248, 261, 581, 585, 256, 319, 388, 569, 269, 330, 437, 398, 318, 340, 242, 331, 328, 377, 303, 402, 467, 369, 389, 358, 353, 290, 385, 344, 585, 545, 393, 286, 260, 490, 380, 403, 218, 456, 400, 260, 310, 380, 358, 326, 343, 329, 368, 530, 192, 331, 371, 383, 319, 218, 387, 569, 232, 448, 322, 347, 264, 322, 505, 415, 569, 488, 399, 571, 399, 443, 325, 360, 291, 464, 255, 438, 335, 488, 434, 580, 432, 229, 347, 255, 306, 536, 421, 291, 267, 356, 253, 294, 385, 485, 418, 193, 384, 360, 396, 551, 200, 300, 416, 228, 530, 391, 446, 302, 442, 474, 377, 377, 380, 278, 339, 339, 393, 465, 264, 341, 531, 288, 282, 374, 446, 354, 509, 447, 446, 411, 585, 334, 203, 550, 311, 364, 507, 227, 250, 227, 284, 399, 408, 381, 239, 192, 358, 310, 401, 429, 367, 435, 376, 409, 291, 336, 373, 443, 317, 408, 328, 342, 444, 204, 247, 235, 192, 293, 434, 326, 373, 477, 509, 346, 513, 362, 280, 300, 235, 276, 320, 441, 567, 241, 394, 265, 403, 341, 213, 456, 299, 305, 263, 295, 397, 335, 387, 390, 508, 321, 235, 474, 322, 480, 393, 341, 389, 585, 585, 360, 369, 475, 280, 387, 351, 385, 281, 228, 200, 259, 311, 326, 585, 479, 271, 389, 316, 326, 372, 419, 322, 473, 258, 354, 585, 376, 524, 362, 415, 348, 337, 285, 397, 279, 424, 476, 391, 326, 400, 324, 457, 213, 322, 204, 234, 514, 452, 290, 233, 192, 304, 585, 398, 303, 402, 230, 325, 363, 345, 439, 388, 424, 292, 452, 553, 270, 276, 510, 335, 520, 313, 527, 366, 379, 543, 320, 272, 312, 400, 229, 421, 305, 484, 192, 284, 222, 281, 378, 336, 329, 338, 374, 268, 429, 424, 393, 412, 383, 585, 345, 324, 287, 266, 251, 276, 346, 387, 358, 286, 453, 433, 338, 295, 411, 372, 237, 346, 379, 275, 372, 236, 510, 498, 329, 390, 192, 257, 326, 263, 430, 585, 255, 280, 377, 551, 252, 378, 580, 224, 248, 314, 306, 442, 377, 217, 407, 301, 502, 297, 296, 410, 436, 400, 222, 410, 266, 377, 239, 400, 283, 248, 430, 377, 298, 527, 313, 356, 380, 298, 402, 305, 315, 514, 265, 192, 551, 585, 316, 207, 324, 326, 335, 260, 414, 408, 234, 428, 585, 370, 322, 340, 418, 219, 369, 317, 581, 337, 559, 261, 415, 386, 278, 371, 493, 323, 221, 352, 275, 321, 345, 221, 226, 403, 306, 192, 438, 380, 290, 246, 445, 389, 585, 396, 393, 337, 442, 419, 498, 306, 313, 310, 439, 534, 311, 314, 385, 330, 459, 194, 281, 285, 192, 271, 274, 334, 480, 330, 266, 348, 472, 270, 275, 412, 332, 422, 352, 429, 266, 352, 333, 253, 230, 427, 321, 267, 344, 482, 193, 234, 274, 528, 382, 436, 258, 259, 400, 359, 411, 335, 381, 369, 437, 441, 226, 194, 465, 490, 267, 212, 363, 457, 579, 407, 319, 276, 354, 325, 267, 585, 577, 483, 274, 447, 421, 399, 498, 421, 433, 421, 388, 216, 361, 303, 248, 561, 569, 514, 379, 512, 354, 374, 261, 394, 359, 247, 348, 345, 579, 452, 354, 378, 357, 334, 262, 339, 288, 250, 407, 393, 216, 341, 465, 473, 469, 357, 280, 262, 388, 392, 503, 478, 341, 251, 323, 375, 334, 301, 379, 307, 297, 385, 316, 378, 381, 258, 309, 525, 256, 198, 212, 356, 356, 342, 493, 192, 394, 543, 259, 318, 287, 276, 323, 523, 581, 322, 585, 357, 573, 344, 366, 391, 585, 447, 291, 461, 320, 309, 454, 356, 381, 355, 387, 397, 207, 424, 269, 237, 347, 362, 292, 444, 244, 316, 301, 349, 381, 268, 431, 359, 210, 206, 352, 332, 343, 351, 376, 459, 260, 255, 261, 383, 498, 314, 192, 221, 281, 303, 316, 357, 324, 472, 293, 278, 403, 231, 393, 363, 339, 547, 298, 585, 332, 248, 360, 263, 287, 394, 411, 298, 464, 486, 524, 409, 514, 210, 323, 278, 365, 302, 337, 584, 337, 396, 331, 361, 354, 400, 487, 556, 385, 416, 257, 345, 458, 448, 375, 451, 404, 492, 383, 320, 387, 192, 393, 192, 219, 400, 403, 256, 290, 515, 309, 585, 353, 395, 551, 366, 268, 343, 350, 242, 329, 288, 456, 356, 327, 343, 376, 418, 268, 265, 479, 315, 239, 399, 401, 232, 376, 432, 392, 420, 240, 387, 325, 309, 449, 531, 578, 507, 343, 389, 436, 365, 366, 443, 347, 289, 315, 421, 354, 388, 425, 318, 435, 392, 251, 526, 308, 224, 265, 267, 358, 327, 322, 419, 388, 385, 395, 418, 199, 319, 196, 357, 353, 471, 490, 374, 308, 404, 305, 353, 463, 303, 441, 425, 271, 462, 428, 363, 286, 279, 305, 410, 271, 398, 251, 334, 364, 585, 242, 530, 368, 395, 365, 399, 339, 527, 311, 483, 296, 347, 263, 400, 526, 346, 335, 260, 332, 228, 274, 376, 508, 585, 301, 524, 378, 339, 398, 359, 364, 316, 240, 231, 423, 327, 300, 354, 440, 371, 295, 495, 546, 405, 462, 497, 482, 418, 416, 408, 261, 428, 243, 284, 506, 445, 532, 327, 257, 331, 363, 361, 483, 320, 389, 269, 400, 354, 287, 331, 336, 328, 575, 344, 330, 199, 276, 328, 292, 517, 338, 503, 359, 357, 344, 354, 567, 192, 203, 304, 355, 427, 402, 318, 468, 469, 371, 460, 381, 303, 428, 364, 353, 530, 192, 239, 255, 319, 329, 233, 269, 278, 585, 579, 315, 319, 257, 209, 342, 268, 345, 227, 286, 368, 391, 396, 245, 447, 283, 421, 352, 242, 324, 391, 418, 340, 539, 466, 329, 434, 585, 585, 252, 273, 532, 264, 245, 309, 396, 343, 295, 293, 290, 277, 585, 383, 451, 309, 336, 290, 192, 242, 214, 194, 254, 509, 349, 504, 395, 438, 275, 408, 432, 301, 412, 413, 304, 259, 255, 362, 386, 284, 356, 413, 419, 542, 502, 268, 562, 305, 471, 360, 315, 214, 337, 230, 461, 536, 284, 384, 289, 297, 437, 350, 570, 309, 465, 363, 440, 312, 348, 342, 280, 424, 423, 416, 539, 527, 318, 392, 297, 355, 299, 552, 390, 333, 491, 197, 203, 440, 359, 378, 245, 351, 585, 443, 370, 313, 317, 198, 379, 446, 229, 294, 257, 271, 358, 200, 418, 435, 329, 192, 268, 496, 192, 321, 255, 441, 293, 395, 413, 581, 334, 392, 234, 490, 286, 303, 351, 230, 376, 461, 383, 228, 341, 433, 211, 263, 449, 380, 396, 582, 402, 423, 585, 333, 283, 397, 399, 306, 266, 585, 386, 289, 454, 343, 329, 412, 247, 389, 585, 402, 318, 307, 315, 329, 318, 454, 219, 448, 318, 392, 259, 509, 498, 460, 233, 444, 395, 227, 351, 391, 412, 371, 383, 530, 495, 192, 323, 338, 218, 363, 498, 262, 387, 274, 294, 531, 304, 401, 211, 582, 417, 336, 414, 240, 489, 323, 334, 308, 301, 428, 379, 423, 352, 407, 315, 585, 229, 500, 515, 279, 585, 465, 462, 356, 333, 334, 393, 519, 371, 275, 443, 455, 423, 434, 328, 273, 278, 225, 377, 345, 313, 192, 251, 481, 294, 390, 241, 525, 339, 383, 585, 536, 324, 300, 323, 407, 343, 317, 529, 342, 585, 362, 577, 390, 460, 289, 279, 401, 464, 357, 248, 243, 238, 217, 364, 482, 352, 194, 335, 338, 585, 236, 317, 565, 400, 412, 365, 387, 437, 283, 450, 242, 387, 371, 298, 351, 298, 263, 320, 260, 386, 257, 430, 255, 302, 297, 509, 387, 333, 405, 199, 349, 585, 366, 360, 411, 452, 204, 222, 374, 290, 507, 324, 207, 249, 192, 331, 335, 314, 475, 492, 337, 198, 418, 411, 385, 463, 256, 585, 271, 434, 222, 273, 536, 329, 445, 377, 343, 514, 331, 216, 283, 411, 394, 229, 289, 301, 319, 242, 297, 289, 437, 441, 339, 317, 367, 282, 257, 272, 297, 256, 369, 432, 228, 356, 333, 388, 352, 236, 249, 356, 469, 195, 388, 490, 339, 411, 291, 342, 226, 192, 458, 269, 312, 241, 240, 337, 289, 392, 400, 386, 377, 546, 263, 348, 483, 501, 239, 324, 514, 406, 373, 333, 318, 383, 329, 349, 361, 293, 409, 585, 216, 386, 286, 414, 358, 436, 488, 372, 483, 192, 547, 392, 475, 252, 281, 368, 352, 382, 476, 217, 462, 354, 334, 235, 406, 192, 422, 234, 358, 342, 488, 336, 292, 307, 502, 409, 318, 331, 229, 393, 218, 435, 366, 585, 261, 343, 579, 490, 292, 376, 353, 382, 291, 344, 227, 367, 400, 332, 226, 464, 390, 289, 327, 234, 266, 305, 496, 296, 421, 305, 378, 340, 449, 305, 229, 241, 305, 250, 395, 311, 585, 219, 374, 259, 308, 367, 192, 377, 584, 312, 379, 468, 338, 301, 193, 422, 342, 267, 366, 301, 305, 417, 244, 471, 240, 294, 585, 482, 363, 272, 305, 360, 357, 344, 350, 333, 237, 306, 454, 242, 335, 282, 364, 317, 531, 406, 246, 425, 285, 301, 385, 308, 452, 285, 298, 295, 302, 478, 420, 566, 585, 266, 360, 255, 285, 297, 264, 264, 339, 253, 446, 274, 585, 312, 360, 247, 565, 481, 383, 243, 374, 259, 528, 441, 363, 192, 269, 427, 493, 479, 228, 384, 467, 224, 352, 381, 325, 212, 323, 323, 339, 302, 313, 350, 399, 325, 315, 362, 208, 403, 353, 357, 460, 206, 205, 381, 353, 370, 311, 424, 457, 403, 329, 199, 436, 494, 422, 277, 425, 448, 543, 277, 332, 434, 359, 260, 396, 414, 362, 375, 329, 531, 275, 300, 354, 450, 234, 246, 201, 356, 259, 318, 424, 296, 376, 325, 425, 403, 292, 337, 471, 394, 240, 423, 262, 521, 468, 383, 369, 334, 426, 319, 377, 449, 303, 298, 254, 263, 213, 432, 579, 523, 226, 431, 523, 311, 363, 203, 380, 264, 373, 230, 410, 468, 285, 258, 197, 328, 301, 230, 400, 312, 263, 303, 474, 417, 341, 419, 256, 356, 368, 310, 398, 285, 407, 411, 192, 490, 192, 298, 468, 323, 236, 261, 469, 208, 482, 348, 254, 301, 267, 448, 432, 220, 316, 278, 505, 243, 550, 350, 256, 293, 283, 249, 363, 252, 196, 318, 215, 287, 275, 278, 585, 359, 378, 216, 295, 375, 266, 454, 254, 326, 301, 369, 296, 328, 331, 289, 404, 377, 345, 314, 440, 331, 324, 364, 563, 244, 437, 210, 375, 545, 404, 370, 303, 356, 329, 284, 326, 373, 286, 283, 243, 393, 410, 376, 461, 362, 394, 384, 344, 305, 585]
thresholds = [246, 352, 503]
display_name = "Thalidomide Deaths Per Event"
units = "deaths"

# Calculate exceedance probabilities (1 - CDF)
sorted_samples = np.sort(samples)
exceedance = 1 - np.arange(1, len(sorted_samples) + 1) / len(sorted_samples)

# Create figure
fig, ax = plt.subplots(figsize=(10, 6))

# Plot exceedance curve
ax.plot(sorted_samples, exceedance * 100, color=COLOR_BLACK, linewidth=2.5)
ax.fill_between(sorted_samples, 0, exceedance * 100, alpha=0.1, color=COLOR_BLACK)

# Annotate thresholds
for thresh in thresholds:
    exceed_pct = (np.array(samples) >= thresh).sum() / len(samples) * 100
    ax.axvline(thresh, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)
    ax.axhline(exceed_pct, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.3)
    
    # Add label
    ax.annotate(f'{exceed_pct:.0f}% chance\nâ‰¥ {thresh:,.2g}',
                xy=(thresh, exceed_pct), xytext=(thresh * 1.05, exceed_pct + 5),
                fontsize=10, ha='left', weight='bold',
                bbox=dict(boxstyle='round,pad=0.3', facecolor=COLOR_WHITE, edgecolor=COLOR_BLACK, alpha=0.9))

ax.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=12)
ax.set_ylabel('Probability of Exceeding Value (%)', fontsize=12)
ax.set_title(f'Exceedance Probability: {display_name}', fontsize=14, weight='bold', pad=15)
ax.set_ylim(0, 100)
ax.set_xlim(left=min(sorted_samples) * 0.95)

clean_spines(ax)
add_watermark(fig)

# Save PNG
project_root = Path.cwd()
while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
    project_root = project_root.parent

output_path = project_root / 'knowledge' / 'figures' / 'exceedance-thalidomide_deaths_per_event.png'
plt.savefig(output_path, dpi=150, bbox_inches='tight', facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title=f'Exceedance: {display_name}',
    description=f'Probability of {display_name} exceeding various thresholds'
)

plt.show()
```

*This exceedance probability chart shows the likelihood that Thalidomide Deaths Per Event will exceed any given threshold. Higher curves indicate more favorable outcomes with greater certainty.*
