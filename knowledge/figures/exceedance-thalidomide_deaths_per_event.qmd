```{python}
#| echo: false
#| fig-cap: "Probability of Exceeding Threshold: Thalidomide Deaths Per Event"
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata
)

setup_chart_style()

# Monte Carlo samples
samples = [366, 336, 376, 381, 317, 330, 362, 352, 358, 340, 379, 377, 360, 386, 370, 340, 367, 337, 379, 358, 355, 344, 388, 355, 349, 351, 371, 367, 368, 369, 405, 350, 347, 341, 373, 386, 356, 340, 340, 374, 376, 371, 344, 364, 361, 364, 379, 364, 375, 360, 365, 374, 327, 352, 348, 344, 353, 395, 339, 382, 322, 351, 363, 372, 375, 377, 351, 348, 379, 354, 331, 334, 338, 370, 362, 375, 349, 362, 373, 352, 369, 344, 351, 350, 332, 370, 348, 359, 370, 369, 374, 357, 349, 357, 322, 327, 330, 337, 368, 339, 350, 390, 351, 376, 338, 354, 338, 351, 379, 321, 369, 364, 345, 327, 360, 347, 364, 359, 397, 353, 336, 363, 364, 391, 378, 367, 394, 333, 344, 338, 350, 329, 374, 354, 327, 336, 366, 378, 405, 405, 368, 337, 315, 365, 341, 349, 345, 356, 384, 362, 355, 336, 322, 348, 358, 402, 362, 382, 348, 333, 337, 343, 405, 340, 378, 339, 381, 368, 355, 358, 344, 369, 349, 332, 331, 363, 397, 362, 356, 365, 390, 364, 349, 385, 369, 396, 363, 332, 329, 399, 400, 355, 350, 394, 334, 339, 374, 350, 359, 355, 367, 392, 361, 374, 315, 358, 340, 332, 339, 351, 380, 330, 359, 348, 351, 382, 371, 391, 355, 343, 354, 364, 363, 335, 361, 364, 405, 404, 340, 352, 327, 346, 366, 387, 342, 344, 315, 355, 335, 347, 339, 357, 321, 327, 405, 330, 335, 403, 405, 333, 350, 367, 401, 337, 353, 377, 369, 350, 356, 329, 353, 353, 364, 346, 370, 383, 362, 367, 360, 359, 343, 366, 357, 405, 397, 368, 342, 334, 387, 365, 370, 321, 381, 369, 334, 348, 365, 360, 352, 356, 353, 362, 394, 315, 353, 363, 366, 350, 321, 366, 401, 325, 379, 351, 357, 335, 351, 390, 372, 401, 387, 369, 401, 369, 378, 352, 360, 343, 382, 333, 377, 354, 387, 376, 403, 376, 325, 357, 333, 347, 395, 374, 343, 336, 360, 332, 344, 366, 386, 373, 315, 366, 360, 368, 398, 315, 345, 373, 324, 394, 367, 379, 346, 378, 384, 364, 364, 365, 340, 355, 355, 368, 382, 335, 356, 394, 342, 340, 363, 379, 359, 391, 379, 379, 372, 405, 354, 316, 397, 348, 361, 390, 324, 331, 324, 341, 369, 371, 365, 328, 315, 360, 348, 369, 375, 362, 377, 364, 371, 343, 355, 363, 378, 350, 371, 353, 356, 378, 316, 330, 326, 315, 344, 376, 352, 363, 385, 390, 357, 391, 361, 340, 345, 326, 339, 351, 378, 400, 328, 368, 336, 370, 356, 319, 381, 345, 347, 335, 344, 369, 354, 366, 367, 390, 351, 327, 384, 351, 385, 368, 356, 367, 405, 405, 360, 362, 384, 340, 366, 358, 366, 340, 324, 315, 334, 348, 352, 405, 385, 337, 367, 350, 352, 363, 373, 351, 384, 334, 359, 405, 364, 393, 361, 372, 357, 355, 341, 369, 340, 374, 384, 367, 352, 369, 352, 381, 319, 351, 316, 326, 391, 380, 343, 326, 315, 347, 405, 369, 346, 370, 325, 352, 361, 357, 377, 367, 374, 343, 380, 398, 337, 339, 391, 354, 392, 349, 394, 362, 365, 396, 351, 338, 349, 369, 325, 374, 347, 386, 315, 341, 322, 340, 364, 355, 353, 355, 363, 336, 375, 374, 368, 372, 366, 405, 357, 352, 342, 336, 331, 339, 357, 367, 360, 342, 380, 376, 355, 344, 372, 363, 327, 357, 365, 339, 363, 327, 391, 389, 353, 367, 315, 333, 352, 335, 376, 405, 333, 340, 364, 398, 332, 365, 403, 323, 331, 349, 347, 378, 364, 320, 371, 346, 389, 345, 344, 371, 377, 369, 322, 371, 336, 364, 328, 369, 341, 331, 375, 364, 345, 394, 349, 360, 365, 345, 370, 347, 349, 391, 336, 315, 398, 405, 350, 317, 352, 352, 354, 334, 372, 371, 326, 375, 405, 363, 351, 356, 373, 321, 363, 350, 404, 355, 399, 334, 372, 366, 339, 363, 388, 351, 322, 358, 339, 351, 357, 322, 324, 370, 347, 315, 377, 365, 343, 330, 378, 367, 405, 369, 368, 355, 378, 373, 389, 347, 349, 348, 377, 395, 348, 349, 366, 353, 381, 315, 340, 341, 315, 337, 338, 354, 385, 353, 336, 357, 384, 337, 339, 372, 354, 374, 358, 375, 336, 358, 354, 332, 325, 375, 351, 336, 357, 386, 315, 326, 338, 394, 365, 377, 334, 334, 369, 360, 372, 355, 365, 362, 377, 378, 324, 315, 382, 387, 336, 319, 361, 381, 402, 371, 350, 339, 359, 352, 336, 405, 402, 386, 338, 379, 374, 369, 389, 374, 376, 374, 367, 320, 361, 346, 331, 399, 401, 391, 365, 391, 359, 363, 335, 368, 360, 330, 358, 357, 402, 380, 359, 365, 360, 354, 335, 355, 342, 331, 371, 368, 320, 356, 382, 384, 383, 360, 340, 335, 367, 368, 389, 385, 356, 331, 352, 364, 354, 346, 365, 347, 345, 366, 350, 364, 365, 334, 348, 393, 333, 315, 319, 359, 359, 356, 388, 315, 368, 396, 334, 350, 342, 339, 351, 393, 403, 351, 405, 360, 401, 357, 362, 367, 405, 379, 343, 382, 351, 348, 380, 359, 365, 359, 367, 369, 317, 374, 337, 327, 357, 361, 343, 378, 329, 350, 346, 358, 365, 336, 376, 360, 318, 317, 358, 354, 356, 358, 364, 381, 334, 333, 335, 365, 388, 349, 315, 322, 340, 346, 350, 360, 352, 384, 344, 340, 370, 325, 368, 361, 355, 397, 345, 405, 354, 331, 360, 335, 342, 368, 372, 345, 382, 386, 393, 371, 391, 318, 352, 339, 362, 346, 355, 405, 355, 368, 353, 361, 359, 369, 386, 399, 366, 373, 333, 357, 381, 379, 364, 380, 370, 387, 365, 351, 367, 315, 368, 315, 321, 369, 370, 333, 343, 392, 348, 405, 359, 368, 398, 362, 337, 356, 358, 329, 353, 342, 381, 360, 352, 356, 364, 373, 337, 336, 385, 349, 328, 369, 370, 325, 364, 376, 367, 374, 328, 366, 352, 348, 379, 394, 402, 390, 356, 367, 377, 362, 362, 378, 357, 342, 349, 374, 359, 367, 374, 350, 377, 368, 332, 393, 347, 323, 336, 336, 360, 353, 351, 373, 367, 366, 368, 373, 315, 351, 315, 360, 359, 384, 387, 363, 347, 370, 347, 359, 382, 346, 378, 375, 338, 382, 375, 361, 342, 340, 347, 371, 338, 369, 331, 354, 361, 405, 329, 394, 362, 368, 361, 369, 355, 394, 348, 386, 344, 357, 335, 369, 393, 357, 354, 334, 354, 324, 338, 364, 390, 405, 346, 393, 364, 355, 369, 360, 361, 350, 328, 325, 374, 352, 345, 359, 377, 363, 344, 388, 397, 370, 382, 388, 386, 373, 373, 371, 335, 375, 329, 341, 390, 379, 394, 353, 333, 353, 361, 361, 386, 351, 367, 337, 369, 359, 342, 353, 355, 353, 402, 357, 353, 315, 339, 353, 343, 392, 355, 390, 360, 360, 357, 359, 400, 315, 316, 347, 359, 375, 370, 350, 383, 383, 363, 381, 365, 346, 375, 361, 359, 394, 315, 328, 333, 351, 353, 326, 337, 340, 405, 402, 349, 351, 333, 318, 356, 337, 357, 324, 342, 362, 367, 368, 330, 379, 341, 374, 359, 329, 352, 367, 373, 356, 396, 383, 353, 376, 405, 405, 332, 338, 394, 335, 330, 348, 369, 356, 344, 344, 343, 339, 405, 366, 380, 348, 355, 343, 315, 329, 320, 315, 332, 390, 358, 390, 368, 377, 339, 371, 376, 346, 372, 372, 346, 334, 333, 361, 366, 341, 359, 372, 373, 396, 389, 337, 399, 347, 384, 360, 349, 320, 355, 325, 382, 395, 341, 366, 343, 345, 377, 358, 401, 348, 382, 361, 377, 349, 358, 356, 340, 374, 374, 373, 396, 394, 350, 367, 345, 359, 345, 398, 367, 354, 387, 315, 316, 377, 360, 365, 330, 358, 405, 378, 363, 349, 350, 315, 365, 379, 324, 344, 333, 337, 360, 315, 373, 376, 353, 315, 337, 388, 315, 351, 333, 378, 344, 368, 372, 403, 354, 367, 326, 387, 342, 346, 358, 325, 364, 382, 366, 324, 356, 376, 318, 335, 379, 365, 368, 404, 370, 374, 405, 354, 341, 369, 369, 347, 336, 405, 366, 342, 380, 356, 353, 372, 330, 367, 405, 370, 350, 347, 349, 353, 350, 380, 321, 379, 350, 368, 334, 391, 388, 381, 326, 378, 368, 324, 358, 367, 372, 363, 365, 394, 388, 315, 352, 355, 321, 361, 389, 335, 367, 338, 344, 394, 347, 370, 318, 404, 373, 355, 372, 328, 387, 351, 354, 348, 346, 375, 365, 374, 359, 371, 349, 405, 325, 389, 391, 340, 405, 382, 382, 359, 354, 354, 368, 392, 363, 339, 378, 380, 374, 376, 353, 338, 339, 323, 364, 357, 349, 315, 331, 385, 344, 367, 328, 393, 355, 365, 405, 395, 352, 345, 351, 371, 356, 350, 394, 356, 405, 361, 402, 367, 382, 343, 340, 369, 382, 360, 330, 329, 328, 321, 361, 385, 358, 315, 354, 355, 405, 327, 350, 400, 369, 372, 361, 366, 377, 341, 379, 329, 366, 363, 345, 358, 345, 335, 351, 334, 366, 333, 375, 333, 346, 345, 390, 366, 354, 370, 315, 358, 405, 362, 360, 372, 380, 316, 322, 364, 343, 390, 352, 317, 331, 315, 353, 354, 349, 384, 387, 355, 315, 373, 372, 366, 382, 333, 405, 337, 376, 322, 338, 395, 353, 379, 364, 356, 391, 353, 320, 341, 372, 368, 325, 343, 346, 351, 329, 345, 342, 377, 378, 355, 350, 362, 341, 333, 338, 345, 333, 362, 376, 324, 359, 354, 367, 358, 327, 331, 359, 383, 315, 367, 387, 355, 372, 343, 356, 324, 315, 381, 337, 348, 328, 328, 355, 342, 368, 369, 366, 364, 397, 335, 358, 386, 389, 328, 352, 391, 371, 363, 354, 350, 365, 353, 358, 361, 344, 371, 405, 320, 366, 342, 372, 360, 377, 387, 363, 386, 315, 397, 367, 384, 332, 340, 362, 358, 365, 384, 321, 382, 359, 354, 327, 370, 315, 374, 326, 360, 356, 387, 355, 343, 347, 389, 371, 350, 353, 325, 368, 321, 376, 362, 405, 334, 356, 402, 387, 343, 364, 359, 365, 343, 357, 324, 362, 369, 354, 324, 382, 367, 343, 352, 326, 336, 347, 388, 344, 374, 347, 364, 356, 379, 347, 325, 328, 347, 331, 368, 348, 405, 321, 363, 334, 348, 362, 315, 364, 405, 349, 365, 383, 355, 346, 315, 374, 356, 336, 362, 346, 347, 373, 329, 384, 328, 344, 405, 386, 361, 338, 347, 360, 360, 357, 358, 354, 327, 347, 380, 329, 354, 340, 361, 350, 394, 371, 330, 374, 341, 346, 366, 348, 380, 341, 345, 344, 346, 385, 373, 400, 405, 336, 360, 333, 341, 345, 335, 335, 355, 332, 379, 338, 405, 349, 360, 330, 400, 385, 366, 329, 364, 334, 394, 378, 361, 315, 337, 375, 388, 385, 324, 366, 383, 323, 359, 365, 352, 319, 351, 351, 355, 346, 349, 358, 369, 352, 350, 361, 317, 370, 359, 360, 381, 317, 316, 365, 359, 363, 348, 374, 381, 370, 353, 315, 377, 388, 374, 339, 375, 379, 396, 339, 354, 376, 360, 334, 368, 372, 361, 364, 353, 394, 339, 346, 359, 379, 326, 330, 315, 360, 334, 350, 374, 344, 364, 352, 374, 370, 343, 355, 383, 368, 328, 374, 335, 393, 383, 365, 362, 354, 375, 350, 364, 379, 346, 345, 332, 335, 319, 376, 403, 393, 323, 376, 393, 348, 361, 316, 365, 335, 363, 325, 371, 383, 341, 334, 315, 353, 346, 325, 369, 349, 335, 346, 384, 373, 356, 373, 333, 360, 362, 348, 369, 341, 371, 372, 315, 387, 315, 345, 383, 352, 327, 335, 383, 317, 386, 358, 332, 346, 336, 379, 376, 321, 350, 340, 390, 329, 397, 358, 333, 344, 341, 331, 361, 332, 315, 350, 320, 342, 339, 339, 405, 360, 364, 320, 344, 364, 336, 380, 332, 352, 346, 363, 344, 353, 353, 342, 370, 364, 357, 349, 377, 353, 352, 361, 400, 329, 377, 318, 364, 397, 370, 363, 346, 359, 353, 341, 352, 363, 342, 341, 329, 368, 371, 364, 382, 361, 368, 366, 357, 347, 405]
thresholds = [330, 358, 389]
display_name = "Thalidomide Deaths Per Event"
units = "deaths"

# Calculate exceedance probabilities (1 - CDF)
sorted_samples = np.sort(samples)
exceedance = 1 - np.arange(1, len(sorted_samples) + 1) / len(sorted_samples)

# Create figure
fig, ax = plt.subplots(figsize=(10, 6))

# Plot exceedance curve
ax.plot(sorted_samples, exceedance * 100, color=COLOR_BLACK, linewidth=2.5)
ax.fill_between(sorted_samples, 0, exceedance * 100, alpha=0.1, color=COLOR_BLACK)

# Annotate thresholds
for thresh in thresholds:
    exceed_pct = (np.array(samples) >= thresh).sum() / len(samples) * 100
    ax.axvline(thresh, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)
    ax.axhline(exceed_pct, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.3)
    
    # Add label
    ax.annotate(f'{exceed_pct:.0f}% chance\nâ‰¥ {thresh:,.2g}',
                xy=(thresh, exceed_pct), xytext=(thresh * 1.05, exceed_pct + 5),
                fontsize=10, ha='left', weight='bold',
                bbox=dict(boxstyle='round,pad=0.3', facecolor=COLOR_WHITE, edgecolor=COLOR_BLACK, alpha=0.9))

ax.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=12)
ax.set_ylabel('Probability of Exceeding Value (%)', fontsize=12)
ax.set_title(f'Exceedance Probability: {display_name}', fontsize=14, weight='bold', pad=15)
ax.set_ylim(0, 100)
ax.set_xlim(left=min(sorted_samples) * 0.95)

clean_spines(ax)
add_watermark(fig)

# Save PNG
project_root = Path.cwd()
while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
    project_root = project_root.parent

output_path = project_root / 'knowledge' / 'figures' / 'exceedance-thalidomide_deaths_per_event.png'
plt.savefig(output_path, dpi=150, bbox_inches='tight', facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title=f'Exceedance: {display_name}',
    description=f'Probability of {display_name} exceeding various thresholds'
)

plt.show()
```

*This exceedance probability chart shows the likelihood that Thalidomide Deaths Per Event will exceed any given threshold. Higher curves indicate more favorable outcomes with greater certainty.*
