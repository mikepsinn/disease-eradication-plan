```{python}
#| echo: false
#| fig-cap: "Probability of Exceeding Threshold: Cumulative Trial Capacity Years Over 20 Years"
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata
)

setup_chart_style()

# Monte Carlo samples
samples = [494, 635, 455, 439, 819, 684, 510, 554, 524, 611, 444, 452, 516, 419, 479, 612, 488, 623, 444, 527, 540, 592, 408, 537, 565, 557, 473, 488, 484, 482, 333, 563, 574, 607, 466, 419, 533, 610, 608, 463, 455, 472, 591, 500, 511, 502, 444, 501, 461, 516, 495, 465, 715, 554, 570, 588, 549, 377, 613, 437, 763, 556, 507, 469, 458, 451, 557, 569, 446, 541, 679, 652, 619, 476, 509, 460, 565, 507, 465, 553, 480, 590, 558, 560, 664, 477, 570, 521, 478, 481, 462, 532, 565, 530, 763, 713, 688, 628, 485, 617, 560, 399, 558, 456, 621, 542, 622, 556, 447, 772, 482, 500, 583, 713, 515, 576, 500, 520, 366, 546, 632, 505, 501, 392, 447, 489, 381, 662, 588, 620, 561, 699, 464, 544, 718, 631, 493, 447, 333, 333, 484, 627, 835, 497, 607, 564, 585, 536, 426, 507, 538, 634, 761, 571, 527, 349, 510, 435, 573, 662, 624, 597, 333, 608, 447, 617, 440, 486, 538, 526, 589, 481, 568, 669, 679, 506, 368, 507, 534, 495, 398, 501, 563, 421, 482, 373, 505, 669, 697, 361, 353, 540, 561, 381, 647, 616, 464, 562, 523, 538, 491, 387, 514, 464, 828, 527, 610, 668, 614, 555, 441, 689, 519, 571, 555, 434, 473, 394, 537, 594, 544, 499, 505, 643, 514, 501, 333, 340, 611, 551, 716, 582, 493, 410, 598, 589, 837, 538, 639, 576, 614, 531, 779, 717, 333, 681, 645, 342, 333, 659, 559, 490, 353, 627, 546, 452, 482, 560, 535, 699, 546, 549, 500, 579, 479, 433, 507, 489, 517, 522, 597, 493, 532, 333, 369, 486, 601, 648, 411, 497, 478, 776, 440, 480, 648, 570, 497, 517, 551, 532, 547, 508, 380, 837, 546, 505, 494, 559, 779, 491, 353, 731, 445, 555, 528, 637, 556, 399, 469, 352, 413, 481, 351, 481, 448, 552, 516, 594, 435, 660, 452, 541, 414, 454, 344, 456, 739, 529, 659, 575, 375, 464, 594, 630, 519, 668, 591, 493, 415, 467, 837, 494, 515, 484, 364, 829, 582, 468, 741, 379, 488, 447, 580, 449, 426, 500, 500, 497, 613, 537, 537, 486, 434, 638, 534, 379, 599, 608, 503, 447, 521, 395, 446, 447, 471, 333, 542, 824, 366, 568, 512, 398, 745, 674, 745, 605, 481, 474, 496, 706, 837, 517, 570, 480, 459, 509, 454, 501, 473, 595, 540, 504, 449, 562, 474, 548, 534, 448, 823, 683, 720, 837, 592, 455, 550, 503, 423, 396, 529, 393, 513, 610, 583, 720, 615, 558, 450, 354, 700, 486, 635, 478, 535, 795, 440, 584, 576, 640, 589, 482, 541, 491, 488, 396, 556, 719, 426, 555, 420, 486, 535, 490, 335, 333, 516, 507, 425, 611, 491, 525, 493, 609, 743, 830, 649, 568, 551, 336, 421, 624, 490, 563, 550, 505, 466, 556, 426, 654, 522, 333, 501, 384, 513, 469, 528, 539, 603, 482, 611, 462, 424, 488, 551, 480, 553, 439, 795, 556, 823, 723, 392, 443, 596, 724, 837, 577, 333, 482, 579, 479, 737, 552, 513, 531, 451, 490, 461, 593, 442, 363, 625, 615, 395, 541, 387, 567, 381, 510, 498, 370, 558, 621, 567, 480, 738, 464, 577, 416, 837, 604, 763, 608, 499, 540, 547, 538, 503, 629, 458, 462, 486, 471, 494, 333, 531, 553, 600, 634, 673, 615, 529, 491, 517, 602, 442, 455, 538, 589, 472, 504, 713, 529, 497, 617, 504, 715, 395, 405, 547, 488, 837, 656, 551, 641, 458, 333, 660, 610, 500, 365, 669, 499, 344, 756, 680, 565, 575, 449, 499, 783, 475, 581, 402, 586, 587, 472, 453, 481, 763, 473, 634, 500, 708, 481, 606, 680, 458, 499, 585, 382, 567, 519, 497, 586, 479, 576, 563, 392, 635, 837, 365, 333, 563, 818, 553, 551, 541, 648, 469, 474, 723, 459, 333, 506, 556, 536, 466, 773, 507, 561, 341, 539, 359, 647, 468, 492, 613, 505, 409, 554, 765, 524, 617, 556, 530, 767, 748, 478, 575, 837, 452, 497, 596, 687, 447, 490, 333, 483, 486, 539, 449, 465, 404, 575, 566, 571, 451, 377, 568, 565, 493, 546, 438, 837, 608, 603, 837, 624, 618, 542, 421, 546, 633, 528, 428, 625, 618, 471, 544, 463, 524, 459, 634, 523, 543, 668, 737, 460, 557, 632, 532, 419, 837, 723, 619, 381, 496, 453, 653, 650, 481, 517, 472, 541, 496, 507, 452, 450, 749, 837, 434, 412, 631, 802, 513, 440, 346, 475, 559, 616, 521, 552, 630, 333, 347, 418, 619, 446, 464, 481, 404, 464, 455, 464, 490, 785, 514, 579, 680, 358, 353, 392, 498, 393, 521, 503, 645, 485, 516, 684, 527, 530, 346, 443, 521, 499, 518, 542, 643, 537, 599, 674, 475, 486, 785, 534, 434, 427, 431, 518, 610, 643, 490, 487, 400, 422, 535, 673, 554, 502, 542, 581, 498, 573, 586, 493, 562, 499, 496, 653, 571, 383, 657, 834, 802, 519, 519, 534, 409, 837, 485, 370, 651, 560, 600, 616, 555, 384, 342, 556, 338, 519, 350, 531, 510, 488, 333, 446, 595, 437, 558, 572, 441, 519, 496, 521, 491, 483, 818, 462, 626, 712, 528, 514, 594, 448, 692, 563, 582, 527, 496, 629, 457, 516, 809, 820, 523, 544, 532, 525, 501, 438, 648, 659, 645, 495, 405, 566, 837, 767, 609, 579, 563, 518, 553, 428, 592, 612, 478, 731, 486, 512, 537, 367, 586, 333, 544, 679, 515, 642, 600, 485, 471, 586, 435, 415, 384, 473, 392, 807, 554, 613, 511, 580, 538, 339, 539, 484, 545, 515, 522, 481, 414, 361, 493, 468, 655, 531, 439, 445, 502, 443, 477, 410, 495, 558, 491, 837, 487, 837, 771, 480, 478, 657, 596, 391, 571, 333, 522, 484, 364, 510, 628, 533, 526, 696, 547, 599, 440, 519, 550, 533, 501, 466, 628, 635, 422, 564, 707, 481, 479, 730, 501, 456, 487, 465, 704, 491, 552, 571, 445, 379, 346, 397, 533, 489, 453, 511, 510, 448, 528, 598, 564, 464, 522, 490, 461, 560, 454, 487, 671, 383, 573, 757, 636, 632, 517, 549, 556, 466, 490, 493, 484, 466, 833, 559, 837, 519, 523, 429, 412, 503, 573, 477, 576, 522, 435, 579, 450, 461, 623, 436, 459, 512, 601, 612, 577, 472, 623, 482, 673, 542, 512, 333, 699, 380, 508, 484, 511, 481, 537, 382, 568, 418, 588, 528, 641, 480, 383, 530, 542, 649, 545, 743, 618, 501, 397, 333, 582, 384, 499, 537, 482, 516, 512, 563, 703, 733, 463, 550, 583, 521, 451, 505, 590, 407, 368, 477, 436, 405, 418, 466, 468, 474, 645, 459, 695, 605, 398, 447, 378, 549, 656, 546, 512, 515, 418, 558, 489, 627, 480, 522, 600, 545, 540, 549, 349, 532, 546, 832, 616, 548, 593, 390, 538, 400, 516, 519, 531, 522, 354, 837, 824, 577, 521, 460, 478, 561, 432, 431, 505, 437, 497, 579, 459, 512, 522, 380, 837, 707, 662, 558, 547, 725, 627, 612, 333, 346, 563, 559, 655, 813, 534, 628, 530, 745, 601, 508, 488, 483, 688, 446, 605, 465, 523, 699, 554, 488, 466, 536, 373, 433, 548, 455, 336, 335, 670, 620, 378, 638, 688, 571, 483, 532, 589, 592, 596, 614, 333, 494, 443, 572, 540, 596, 837, 699, 791, 837, 664, 396, 527, 400, 484, 452, 617, 474, 456, 581, 471, 470, 578, 650, 662, 514, 492, 605, 520, 470, 466, 371, 401, 628, 357, 576, 429, 516, 564, 790, 539, 736, 437, 375, 605, 494, 597, 587, 453, 526, 352, 571, 434, 513, 451, 567, 527, 533, 609, 462, 463, 468, 373, 382, 560, 487, 586, 520, 583, 364, 488, 544, 411, 837, 825, 451, 516, 499, 689, 524, 333, 448, 506, 566, 562, 835, 498, 447, 740, 590, 657, 624, 517, 831, 466, 454, 547, 837, 628, 406, 837, 557, 661, 450, 592, 485, 470, 342, 542, 487, 721, 411, 601, 579, 524, 737, 501, 437, 495, 742, 534, 455, 806, 641, 444, 497, 484, 341, 479, 462, 333, 543, 605, 482, 481, 576, 634, 333, 492, 598, 441, 533, 547, 471, 682, 489, 338, 479, 560, 574, 563, 547, 560, 441, 774, 445, 560, 487, 651, 395, 405, 437, 727, 448, 485, 746, 525, 488, 471, 505, 495, 379, 407, 837, 554, 538, 778, 513, 405, 643, 491, 619, 591, 379, 577, 479, 805, 341, 467, 540, 469, 705, 412, 554, 542, 572, 581, 459, 498, 463, 523, 475, 564, 333, 738, 403, 391, 611, 333, 434, 436, 519, 544, 543, 486, 387, 505, 618, 448, 440, 463, 455, 549, 620, 613, 752, 500, 530, 566, 837, 674, 420, 590, 489, 702, 383, 536, 495, 333, 375, 553, 583, 555, 475, 532, 562, 380, 533, 333, 514, 347, 489, 437, 597, 611, 480, 435, 518, 681, 696, 709, 781, 512, 419, 523, 837, 541, 538, 333, 715, 561, 355, 481, 471, 511, 491, 452, 606, 444, 698, 491, 505, 585, 524, 586, 641, 557, 647, 492, 655, 458, 661, 580, 586, 396, 491, 543, 476, 833, 526, 333, 510, 516, 472, 442, 823, 762, 502, 596, 397, 554, 818, 678, 837, 545, 541, 565, 425, 410, 539, 835, 466, 471, 493, 436, 658, 333, 624, 455, 763, 620, 375, 548, 447, 500, 532, 392, 546, 784, 606, 472, 485, 738, 597, 581, 559, 699, 587, 597, 453, 450, 536, 561, 509, 607, 655, 621, 587, 658, 507, 456, 742, 520, 544, 490, 523, 714, 676, 519, 431, 837, 490, 411, 537, 472, 595, 534, 749, 837, 439, 626, 568, 701, 706, 539, 598, 487, 480, 492, 500, 368, 640, 528, 418, 403, 708, 553, 392, 475, 504, 544, 561, 495, 547, 526, 515, 592, 473, 333, 783, 492, 601, 469, 518, 454, 413, 504, 418, 837, 367, 487, 425, 668, 609, 508, 524, 496, 424, 781, 436, 521, 542, 718, 476, 837, 463, 722, 517, 534, 414, 540, 594, 573, 402, 473, 561, 546, 738, 486, 779, 454, 510, 333, 646, 532, 346, 411, 594, 501, 522, 496, 594, 531, 744, 509, 481, 545, 748, 435, 488, 597, 550, 724, 632, 577, 407, 588, 464, 577, 499, 536, 444, 576, 739, 700, 576, 674, 484, 569, 333, 775, 503, 651, 572, 509, 837, 500, 338, 568, 498, 431, 538, 581, 837, 464, 533, 630, 510, 582, 576, 467, 691, 428, 703, 590, 337, 419, 513, 621, 576, 515, 519, 531, 525, 543, 712, 575, 441, 697, 541, 608, 512, 561, 379, 476, 686, 461, 603, 581, 493, 572, 443, 603, 585, 590, 580, 422, 465, 355, 333, 633, 515, 660, 603, 587, 638, 637, 536, 668, 447, 619, 333, 568, 515, 683, 355, 420, 494, 693, 502, 650, 381, 450, 513, 837, 626, 460, 409, 421, 743, 494, 432, 757, 523, 496, 552, 800, 555, 555, 537, 580, 567, 526, 481, 552, 563, 513, 816, 478, 522, 518, 437, 819, 821, 496, 523, 506, 569, 462, 439, 477, 548, 833, 453, 408, 464, 614, 461, 445, 370, 614, 545, 455, 517, 649, 484, 469, 514, 501, 548, 379, 617, 582, 521, 444, 723, 686, 827, 519, 649, 561, 462, 588, 500, 552, 461, 478, 593, 539, 429, 486, 703, 463, 643, 386, 431, 495, 507, 543, 461, 559, 500, 444, 579, 585, 664, 639, 795, 456, 345, 385, 750, 457, 385, 568, 512, 824, 497, 639, 503, 737, 472, 431, 604, 653, 837, 549, 581, 734, 480, 567, 641, 579, 426, 467, 535, 466, 657, 519, 508, 570, 482, 603, 475, 472, 837, 411, 837, 585, 431, 554, 717, 645, 431, 816, 419, 528, 663, 582, 631, 445, 456, 770, 563, 613, 399, 694, 366, 525, 657, 592, 606, 679, 513, 670, 837, 560, 789, 600, 618, 613, 333, 517, 499, 783, 589, 502, 632, 441, 665, 551, 582, 507, 588, 549, 545, 598, 477, 500, 531, 565, 451, 545, 553, 512, 356, 692, 453, 810, 502, 369, 477, 506, 579, 519, 547, 604, 551, 503, 602, 606, 696, 486, 472, 500, 437, 514, 486, 494, 531, 576, 333]
thresholds = [401, 523, 687]
display_name = "Cumulative Trial Capacity Years Over 20 Years"
units = "years"

# Calculate exceedance probabilities (1 - CDF)
sorted_samples = np.sort(samples)
exceedance = 1 - np.arange(1, len(sorted_samples) + 1) / len(sorted_samples)

# Create figure
fig, ax = plt.subplots(figsize=(10, 6))

# Plot exceedance curve
ax.plot(sorted_samples, exceedance * 100, color=COLOR_BLACK, linewidth=2.5)
ax.fill_between(sorted_samples, 0, exceedance * 100, alpha=0.1, color=COLOR_BLACK)

# Annotate thresholds
for thresh in thresholds:
    exceed_pct = (np.array(samples) >= thresh).sum() / len(samples) * 100
    ax.axvline(thresh, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)
    ax.axhline(exceed_pct, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.3)
    
    # Add label
    ax.annotate(f'{exceed_pct:.0f}% chance\nâ‰¥ {thresh:,.2g}',
                xy=(thresh, exceed_pct), xytext=(thresh * 1.05, exceed_pct + 5),
                fontsize=10, ha='left', weight='bold',
                bbox=dict(boxstyle='round,pad=0.3', facecolor=COLOR_WHITE, edgecolor=COLOR_BLACK, alpha=0.9))

ax.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=12)
ax.set_ylabel('Probability of Exceeding Value (%)', fontsize=12)
ax.set_title(f'Exceedance Probability: {display_name}', fontsize=14, weight='bold', pad=15)
ax.set_ylim(0, 100)
ax.set_xlim(left=min(sorted_samples) * 0.95)

clean_spines(ax)
add_watermark(fig)

# Save PNG
project_root = Path.cwd()
while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
    project_root = project_root.parent

output_path = project_root / 'knowledge' / 'figures' / 'exceedance-trial_capacity_cumulative_years_20yr.png'
plt.savefig(output_path, dpi=150, bbox_inches='tight', facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title=f'Exceedance: {display_name}',
    description=f'Probability of {display_name} exceeding various thresholds'
)

plt.show()
```

*This exceedance probability chart shows the likelihood that Cumulative Trial Capacity Years Over 20 Years will exceed any given threshold. Higher curves indicate more favorable outcomes with greater certainty.*
