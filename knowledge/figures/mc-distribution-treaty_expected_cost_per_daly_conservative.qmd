```{python}
#| echo: false
#| fig-cap: "Monte Carlo Distribution: Expected Cost per DALY (Conservative 10% Success) (10,000 simulations)"
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

from dih_models.plotting.chart_style import (
    setup_chart_style, add_watermark, clean_spines, get_tick_formatter,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata, get_figure_output_path
)
from dih_models.parameters import format_parameter_value

setup_chart_style()

# Simulation results
samples = [1.2694678916231663, 2.0014472248910846, 1.525879442633644, 1.4819308090881467, 0.8676740797240917, 1.1634849850367763, 1.4978135699717607, 1.2541135360629734, 1.5111342547562454, 1.0079903142318225, 1.0409526652292322, 1.7404494224717173, 1.0366367303626642, 1.1945282296835857, 1.4904287800794458, 1.165384889230631, 1.332028852565972, 1.2502657396607777, 1.9596533359490722, 1.1168081597122486, 1.0374033498125408, 1.077443398523206, 1.8333477272244856, 0.9501740336804658, 1.7309681096636371, 0.9905519849412262, 1.3642094600789663, 1.904866119876616, 1.099325340938139, 1.3214248305887837, 1.0672324904685988, 1.157158329021687, 0.7166064985554864, 1.2701536577792725, 2.268516126324321, 0.9305382764610085, 2.2865506462762526, 1.413117285138128, 0.9431006524102249, 1.4116555975932743, 1.475315371618472, 0.8450632974423121, 0.8323062457341343, 1.4884598994004004, 2.1906762067343473, 1.489362692064147, 1.6830538329997393, 1.0570116257852276, 0.8510358289145307, 1.8702911672399452, 1.3311842187698582, 1.0897197955626141, 1.1390164821301894, 0.9023561525955078, 0.9518585844235662, 0.9275515279427992, 1.2669967833270785, 1.9602802287662475, 1.1857476633842783, 1.2375489833638287, 1.7276126387823318, 0.6112342206198272, 2.775244357550894, 2.527525657869889, 1.8246281292059834, 1.5785030151092319, 1.169956273385963, 1.1038754127188712, 1.3683340259309358, 1.4622857709643828, 0.6079131485440186, 1.0458668892695469, 0.9944072343561559, 1.9468454220286178, 1.3351362221416918, 0.9167219814395404, 0.879897121806685, 0.8669525081733878, 1.3469077318585412, 1.0975831492720447, 0.9075451146931992, 1.1745958691805527, 0.9306796204393988, 0.9943592049339491, 0.9680272407933994, 1.0132206813573015, 1.7127017117273022, 1.0635673781678614, 0.9695702749544278, 1.2852702633976352, 1.1746980138953875, 1.1535422125686434, 1.2310551457646068, 1.9424946150648226, 1.2926024339583349, 0.7256972518574757, 0.45683691113270136, 1.3411650772138504, 1.8077379024686855, 0.7889581099898765, 1.1774154268107666, 1.5121331608180824, 1.4544476032938431, 1.528457976848555, 0.7332884126607556, 2.862033005133514, 1.1115960607737119, 1.4474074584571195, 1.3051834972353906, 1.307974134736701, 1.8567517654303505, 1.4479357594302282, 1.2163917918584735, 1.0497399220074617, 1.5195783412153545, 0.8151868708036486, 0.7776564526503889, 0.9453970865520341, 1.2732981208834648, 1.6221493197851478, 0.7855789286146212, 1.457861473443165, 0.9529958646462058, 1.4723435694469316, 1.3369913636220936, 1.8005316094676562, 1.150105356184393, 0.9137147018200775, 2.455734520849256, 0.9618841039346381, 0.5958524124542269, 1.6309936831026368, 1.1699840091758762, 0.8393572072655642, 0.758909909675785, 0.7159648436409094, 1.3788845719253695, 2.2428688844005826, 3.3654633654470714, 1.9183952665924873, 1.3267646965214923, 0.9515391687877434, 0.8244366535089718, 1.8121664908118487, 1.090804071115291, 0.875514265047989, 0.82083197593804, 1.127030316957239, 1.0109267829896516, 1.4695745589489135, 1.7692355546274228, 1.8036205560331096, 0.9261361104884354, 1.3469841484958212, 1.1793958387695147, 2.185924969713661, 1.9649841748567323, 2.1275546329982604, 0.8679080911039048, 1.1716481946946224, 0.8725954981228888, 1.7484960280204365, 1.9495793614825092, 1.1870528626305792, 2.8151446882664213, 1.2288799680631135, 2.2017674637794875, 0.9413364139449453, 0.9294287450783955, 0.7483101801635169, 1.434576131583129, 2.1339597765213583, 0.8503852360764403, 0.9789727243410662, 0.9522176963456448, 0.8658572627950686, 1.2451542928642085, 1.2574714474236022, 1.223020370409889, 1.9054667803424212, 2.3603290545269293, 1.6516359921130925, 1.0338108064097862, 1.3580891356696725, 1.4517513082586981, 3.213946886019294, 1.0439463139830214, 0.9213305699495103, 0.9644014270417931, 3.0783263686333853, 2.3081370419890854, 0.719795067350616, 1.0333069203421243, 0.9180680438923748, 0.9505699507188161, 0.8815988896011471, 1.1814148507518145, 0.7452810277263131, 1.0950234506142633, 1.1621699687894544, 0.8160446661728871, 1.3950765404674519, 1.6431561460066437, 2.741111423480645, 0.6114650667465573, 1.239491564746273, 1.0664307691534494, 1.0815072725305777, 1.2244994611599365, 1.0190181015629172, 1.7214061978116557, 1.085857432311858, 0.986285848153535, 1.372835923092643, 0.8498682740119357, 0.93773740685825, 0.5959087563784485, 1.884624265697556, 1.1347085979405935, 1.882631262288792, 1.118701486913245, 1.8535468747052404, 1.2470757740831415, 1.9147714100441062, 1.3090495974452236, 1.620952599224707, 1.0895438959129262, 2.1181002646362272, 1.0849609726515679, 1.0539165473401075, 0.9400920298863922, 1.188277246200004, 1.7203011602998275, 1.318685028770867, 0.7285645810650933, 1.0384361122853731, 0.886847806070635, 1.3246319201064334, 0.8358011409070386, 0.8794772534439115, 0.941077629696044, 1.1333551872372567, 1.6951234169188556, 1.133687599173465, 2.072324182590995, 1.3416959341656873, 1.1952508218043862, 1.8806504757304336, 3.2051988079502993, 1.6586165526055678, 1.1125728655030926, 1.9839877059561817, 1.539193709014425, 1.1474435152542477, 1.1218702781537182, 1.5902689058236983, 1.175418980480753, 1.615571950947104, 1.6682468777410289, 1.1080070818818268, 0.8513948726000398, 2.4660126755717364, 0.8835584180523234, 1.432814433269286, 0.9725514978663371, 1.1213906388860149, 1.34646466475171, 1.955525480321797, 1.953649601745057, 1.1646503721544186, 1.1631538743724696, 2.085410206119158, 1.246567447384054, 2.669522653483307, 1.977995359880873, 1.1704234557110846, 1.796133131898281, 1.309627516938431, 1.8341479754682617, 1.2505168756474063, 1.1769043256710863, 0.6987862091588614, 1.1149564665106158, 1.4342592291417717, 1.023295397327058, 1.1005119234662548, 1.3753332962266747, 2.4571571808348716, 0.9038571729035694, 1.1885612000353336, 2.4763917152227046, 0.9999717951942698, 1.3096957353528846, 0.9124239529598765, 0.697618834683923, 1.2120044949004138, 2.000541601642508, 1.0574287240993387, 1.0630767085131712, 1.2916480663501193, 1.3910176722989642, 1.5280695144520622, 1.6351333153602612, 1.1220464320817785, 1.4532864963865129, 1.1714279896021902, 1.3000611950108723, 1.3499587224480865, 1.4712830144923172, 4.120096573481847, 1.1456426402651083, 1.0797869989960753, 1.2761582968155103, 1.1940596788281495, 1.3927006666344617, 1.507967704770769, 1.0167023900560295, 2.0936281529566383, 1.2591035883695982, 0.9661356613121442, 1.3083541928274622, 1.3035679770060655, 1.4573124661893917, 1.2591745141636346, 1.0824325663373409, 3.173342241607215, 0.8728882683204412, 0.9241432752701095, 2.2570498975360267, 1.2436591336474885, 3.5053919139022764, 3.7054077983194005, 1.2989396142942173, 1.0865665424113031, 1.235232530915917, 1.0094247834712464, 0.7196571736513511, 0.9501784518302044, 1.65123428393, 1.1112106892204334, 0.7001772556254641, 0.678272434113311, 1.3495888956476276, 1.2435161429158794, 1.8516158013758766, 0.7351821222908197, 1.1223575899254308, 1.1271835911581842, 1.6479993572747715, 1.7325928480347264, 3.6358485540459085, 1.2446689367166148, 1.6990536036380142, 1.4722456238761505, 1.3585698023048591, 1.3381155676444847, 1.1161740481466569, 1.3621592245446494, 0.6949373200610676, 0.9108114083113273, 1.4468450456689133, 1.9010805403771058, 1.0877677698004793, 1.7330378098912445, 3.95178026903074, 1.6406070759060798, 1.1403305561692345, 1.3359642875158577, 1.4113153026645058, 1.4314083936731283, 1.601158707511119, 1.3402090020985022, 2.862071489321303, 3.0489315054301604, 2.555002889206735, 1.6308126244100756, 1.3211015113038949, 0.834694248543438, 2.0388248884867077, 1.4439719096152348, 1.5573312474804997, 1.3348093227868092, 0.9484558315309058, 1.985209221445351, 0.5089030327757783, 1.2494461753298458, 1.4745568658509254, 1.0981374553807908, 1.4620298148196011, 0.6969908715323244, 0.8326947363359943, 1.6449635625354744, 1.3578589617238654, 1.7312148971106993, 1.4653490050574038, 1.69176591555833, 1.1445183342395222, 1.357574386558811, 2.223930356582753, 0.9670513671476352, 1.2504679405587062, 0.9375403598617205, 2.0731727440798893, 1.0275536752002554, 2.0959501921655255, 2.1118951892788083, 1.0917913648636166, 1.5386397530026261, 0.640189452530821, 1.2466218711414538, 0.7696512727092294, 0.5948964553674763, 1.4043698939695546, 1.1376405147253135, 1.297078711872162, 1.255204968594059, 1.510343465740635, 1.8997919639157714, 1.3454098511796817, 1.5680906901713623, 1.4341159597867155, 1.0197318057509073, 1.147385948346182, 1.1207908180036648, 1.1295937026903782, 1.2701809143793639, 1.6374474695824566, 1.9206682904126722, 1.183973795928104, 0.7379244364644706, 0.941054603041035, 0.8346111130886471, 1.0011673183702987, 0.9455196412265283, 1.4819638107622428, 2.083721424103324, 1.029895752311744, 1.0047073981954933, 1.9065726829671241, 1.410206267724658, 0.7096794123593984, 1.697021469384367, 0.9628377365143855, 1.9504208850089713, 0.6558384050988978, 1.091680024657293, 1.6708047853863754, 0.5681706844690506, 1.7121574106511699, 1.2264282661668577, 0.8189343599266992, 1.990529221406411, 3.214074007636283, 1.7172295262433317, 1.3450906152479727, 1.5003185395125949, 1.3828092607126719, 1.158240515723242, 2.5239966712304374, 1.5306098190350579, 1.5035686917084707, 0.9422859046239372, 0.6096192694541341, 0.8919780999877489, 0.9612142969785552, 1.4962337463850337, 1.5339490978294341, 2.6163081285512986, 1.4835426850231936, 1.417795715341107, 1.8297098961770883, 0.8747277688150429, 0.9847651145376536, 1.3315832323376047, 2.9991903354594545, 2.2613201665451443, 1.4710487163282433, 1.0006162490343813, 1.2541135485526267, 2.4408881036473646, 1.9819391046622292, 1.4626794424758542, 1.2413585236012965, 0.8835086597257104, 4.1343476808305155, 2.113593099503905, 0.7049890643843876, 1.9507367055183893, 1.3489699418151158, 0.8126205999366745, 1.9170050452200025, 2.2857352222016503, 1.8700697477128065, 1.1601130965827307, 1.417040840844244, 1.6201036937440656, 1.0151657272779762, 1.2770911193188317, 1.1352361492111682, 0.7844241004894262, 1.2865888128841858, 1.502009777050103, 1.194480412048097, 0.8917816405147466, 0.5951255247710411, 0.600474442563106, 1.9509683999045122, 1.9950497448071454, 0.6995931011554706, 1.1901996804240182, 0.7633807189337481, 1.0262645830760027, 2.986002340452084, 1.345253373059115, 1.257434804662957, 1.2713677829349606, 1.5780018541033791, 0.8475800757972681, 2.7819416739954153, 1.532057367066964, 1.0775294230221064, 0.9428425286828966, 1.2503355815363348, 1.076445594730127, 1.53789911742858, 2.4690176385174603, 2.521199627195052, 1.2111102239450775, 1.2253819158578787, 1.704547661593979, 0.9962679366666387, 1.2918075738483943, 1.5037092003401262, 1.0795639260696024, 0.9430571651841797, 1.0847995304030589, 1.3796503750723523, 1.3423398738028787, 0.8328265976687277, 1.0248163200171807, 1.2207662727308237, 1.2051328443310327, 1.4161927237292689, 1.575279530407201, 1.1341855050212524, 1.5775524604483546, 1.381872940085289, 1.1870726312972788, 1.5653346489852737, 1.2703815883051346, 0.6467481552983776, 2.37401712988215, 0.8223040664348201, 2.4360466414158046, 1.2443235000383075, 1.3773406947136675, 0.7678395588696851, 0.9298919203944299, 0.6469742573138678, 0.9827361611316889, 1.1856520053405681, 1.8636601556566674, 0.7416080152475116, 1.4747360574678023, 1.329477067980804, 0.8801842996694338, 0.8891930663149604, 1.0035628329717317, 1.2286518867917449, 1.2728379507012793, 2.226740060703515, 1.1179839641134202, 2.4752729647467615, 0.8888682418919619, 1.8024940847092474, 0.759607598922165, 1.4532802883755327, 1.2195971486639205, 0.9411425098089887, 0.6619912566879572, 0.7021691918840467, 1.0814772857760173, 0.8866763496937772, 0.7400477276377454, 1.8656092707162826, 1.7177661568360223, 1.820285755847727, 0.9243654245372752, 1.128784303177336, 0.9069289397723627, 0.555567520415511, 1.004665097764109, 1.204075847879534, 0.836327889210756, 1.0559465715484446, 0.7284827706904631, 0.658214495094094, 1.665314573711872, 1.2756697741213865, 0.7935573932259815, 1.2496327412052675, 0.7844506676695272, 0.9409059323489283, 1.7323054780964973, 1.1747615301574765, 1.581881374655915, 1.8847047051051533, 2.7581533837332546, 1.8092821834927737, 1.7960757799774345, 2.2247935725982493, 1.5062686852947273, 0.8332416232447181, 1.7787189126675214, 1.5950964170409974, 0.8776977399166653, 1.0687020708873098, 0.9809446840815252, 0.9084300019368096, 1.012913249484186, 1.6682743463824683, 1.461181385334668, 1.0209351780552114, 0.9171228903569546, 2.8569864654223514, 0.710754377422736, 1.1846111485838438, 1.1022525645039407, 0.877285655115496, 0.5881318083503061, 2.02643131532415, 1.6454491642225226, 0.8279414553608871, 1.0908699182567525, 1.1189546274886306, 0.9753830898033299, 1.5063199601785233, 1.1439251164880415, 1.0164515186214511, 1.298310165682582, 1.7257271130426408, 1.327405242782409, 2.4635840427346922, 1.0838230399338469, 2.2570366366489694, 1.0849679051610635, 1.5753394631309838, 1.2847928139584328, 1.1706992041920474, 1.1238350990202646, 2.6164205548191446, 0.9396279894345915, 1.4244993804003803, 1.0366793570454504, 1.0298296386501855, 1.3138619671863414, 0.737812485492781, 1.6363865093473706, 2.5216368295384526, 1.2166465697791322, 0.8317239765591934, 1.53441498295753, 1.2593717392561268, 1.0599805317968152, 1.3490938951506637, 0.9268333613793611, 0.8729277671544421, 1.327041865642085, 0.5199146288277122, 0.9283582290282101, 1.9765085190734415, 1.3793767605057226, 1.017765326315477, 1.372347583030422, 1.2799493995036377, 1.1761239955987663, 1.8702821594090768, 1.2359680155728727, 2.2385169682676604, 1.4520326704691113, 1.2472249659619015, 2.179010258305544, 1.2085154096594932, 1.2354898115096347, 1.6379124106389047, 0.9669600533747893, 1.012894150944136, 1.7530695164595609, 1.4831093294982127, 1.2554003492079866, 1.5817291577812527, 0.8249942245035117, 1.0137748369777355, 0.6588155194895992, 0.9138934362710969, 1.055095364863705, 1.528683861869401, 1.516337727403121, 0.8908980901879495, 1.5839143028224765, 1.5511859674116497, 1.5894298778649305, 0.9922290920828043, 1.3719263711123566, 1.8382453625005126, 1.049084399612984, 0.731962416859223, 1.0848011016920298, 1.7679367729545417, 1.5299953428831445, 1.063011413598094, 1.1515092642683509, 1.2701058971733847, 0.7162768046861774, 1.593503545631149, 0.9376441765662884, 0.7478373732166902, 1.8035400094489782, 1.004107766210818, 1.1090102222400435, 1.0641185494655943, 1.651269721316969, 1.4456745304597443, 0.7596544945997976, 1.5606714919767708, 1.9376578108204063, 1.116772769946861, 1.3020886181255744, 1.158276726273055, 1.0975141342289938, 1.3967943127521403, 1.8445375472135672, 1.3342264093873586, 1.2085010619296819, 3.3612402108549775, 0.8498614255777142, 1.2372650637010365, 1.131234322801323, 1.1127430385578134, 0.48746968261575147, 0.9352213673449579, 1.0470617048593744, 1.0013817270176457, 0.7031421023983307, 1.1107355720871444, 1.2638917791815143, 2.598889339997248, 1.5174324878864196, 0.7475404323851973, 1.070625514891672, 1.469731543475913, 1.1695383003554851, 1.8047007438215883, 1.3097432774597144, 1.3524076504759894, 2.364017735662679, 1.2324728090388433, 2.252309479265912, 1.0989693665512847, 1.4869409335169486, 2.007026665882862, 3.17812027443105, 1.7657156480262528, 2.1781525490545133, 1.143933764337761, 0.7859996649737387, 1.253251463280642, 1.2424207833547418, 0.9694840906755399, 2.187886784930381, 2.2714883698402586, 1.7432125873527264, 1.218444856759096, 1.267221948879359, 1.2415713881414427, 1.3902132008918942, 0.6880574388229618, 1.6502477804332116, 1.8002554694898005, 1.1126420293237465, 1.6254792015960122, 0.972675077425757, 1.2676751639177164, 1.275559355664242, 0.9489647348439533, 1.023514105196175, 1.870623078777317, 1.0664899056106336, 0.9362787502007919, 1.3749183087408394, 1.7028839489641732, 0.7762092806696895, 1.2889128806668777, 1.3866610961221368, 1.1913121364192392, 1.482043049216468, 1.9061466431688046, 1.2616174905567126, 1.5751386444615183, 1.0203630384102889, 1.9318505997933948, 0.7897173465191858, 0.9732563689543379, 1.4258010538878891, 1.7614438149004858, 1.0939089982836745, 1.514526987950494, 0.7112723204396482, 1.0018407325031478, 1.1711411048903286, 1.1578774043520554, 0.8486249943398501, 2.230458942071547, 1.0055104320587394, 2.035987689255942, 1.0698790432012693, 0.8324631331828294, 1.705945297104151, 1.0237253050349913, 0.9506065477598363, 0.891560321902242, 0.9957532598657675, 1.6552688111061928, 0.7716277819018975, 1.1218325811825296, 1.2314262039228452, 2.42596438846271, 1.0918850693759807, 1.2710036380523155, 1.0446990453408058, 1.1895660203669949, 1.6656789173050603, 0.6506115312666595, 1.0571577815965894, 1.3065815106962597, 1.0932462122166036, 1.5285451531492529, 1.863244401423365, 1.5696362486250293, 1.2424071100624106, 1.8769401092677902, 0.9170743257600565, 1.4509004800154872, 1.3113141072551007, 1.7354961890512575, 1.2707632892129825, 1.5021383087223419, 1.4758541794851756, 0.9463337614725263, 1.2998219615160467, 1.8540534765889467, 0.8605588292646903, 1.603428446108467, 1.2537386994063533, 1.9110100715710798, 1.6592377475449105, 1.4256245057087424, 1.099815598307564, 1.5632622558830636, 1.6107187643404752, 1.365230555738667, 0.8303171700773657, 1.186249075542, 1.3694417455361538, 0.56601909096013, 0.755518458738734, 0.9515527887395263, 1.3521482050736882, 0.6693770476013063, 0.8647512896785261, 1.2923748550520724, 0.7114683681412011, 1.2713229479950523, 1.0568396357623393, 0.8844051066833294, 0.5271497306708287, 0.8024453121766497, 2.7373308047438893, 1.5336551578140605, 1.0239217596625725, 1.1024898226468416, 1.803956385160255, 0.75332608793981, 1.1445612230465003, 0.9519609416456134, 1.1579386521864283, 1.910942780164378, 1.0010894344453254, 0.9423253423986758, 1.2741618132863683, 2.040628939675985, 0.8172791059060802, 0.95393064004462, 1.1530345423014907, 1.459460051828183, 1.730319879455873, 0.894019345755664, 1.1868372823166284, 0.9679310343436837, 0.6986818477980014, 1.2208938131251095, 1.11822665904233, 2.296054773525044, 3.0373318644298375, 1.3522987168351337, 1.5739350101978165, 0.8552301942137597, 0.5054106306246912, 1.0594650249272775, 0.7440995070014843, 0.7260550898796286, 1.5867551612826183, 1.4085824892595, 1.3266087807283178, 1.952585889987808, 0.8250964092609275, 1.4765783868937934, 1.229047051502978, 0.962612656729515, 0.5475669144333015, 1.797525551718337, 1.0636071074465743, 1.0564969085647447, 0.6774444835270894, 1.0916327739413514, 2.5600464809987953, 1.1996056208128476, 3.058616558241542, 0.9972540745276378, 1.014711688407722, 1.180687905518304, 0.9166783745171669, 2.1237772649028335, 1.5247148108461304, 1.5771758703478864, 1.5398644338604952, 1.16428776787597, 1.082657317159494, 1.308040143452741, 1.2781903701271589, 0.9298582152343423, 1.4243148268056143, 1.428938881991218, 0.9652839848639858, 1.7282506867501657, 1.3983785719337336, 0.8650745592080085, 0.5247161401847823, 1.418627885900272, 0.7348634715264316, 1.0218357755904128, 0.9861574389983814, 1.3077591299417324, 1.3212982796423787, 0.8879158258329285, 2.0362606091468134, 1.2517265223363616, 3.127537098091844, 1.6961009403363805, 1.7044967607308925, 4.212526741030018, 1.08436144726493, 1.0633682540956666, 1.4154091617653333, 0.9296303202264815, 1.1627747329183686, 0.9960004103300697, 1.2983935800159205, 1.1888293083750199, 1.9794670162562973, 1.1252622765292006, 0.9990247582482485, 1.9848363830708309, 1.8854275852817923, 1.3467537636820317, 1.882386370307154, 1.3619589069086904, 1.1631739171161564, 1.1214161331095331, 1.3857973745601249, 0.9575705376239385, 0.9977287123910389, 1.8076102344654115, 2.80213295970719, 1.2688944043145454, 1.841436189435593, 1.1540202440000598, 0.6317685881061603, 1.1706820129883455, 0.9754641020262405, 1.2870807349234823, 2.3333769801401907, 1.507724626515811, 1.5202283572475659, 0.7891929845093328, 1.3808684899717178, 0.9828041046031196, 1.5521142981530922, 1.1541628814394826, 1.944206703223396]  # Truncate for embedding
baseline = 1.2590044674178746
mean = 1.3443028857216421
std = 0.5229111691739566
p5 = 0.7140592124508847
p50 = 1.2379429094510193
p95 = 2.330860939860309
display_name = "Expected Cost per DALY (Conservative 10% Success)"
units = "USD/DALY"

# Create figure with two subplots
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))
fig.subplots_adjust(wspace=0.3)

# --- Left: Histogram ---
# Handle edge case where all samples are identical (zero variance)
if std == 0 or (max(samples) == min(samples)):
    n_bins = 1
else:
    n_bins = min(50, max(1, int(np.sqrt(len(samples)))))
n, bins, patches = ax1.hist(samples, bins=n_bins, color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)
ax1.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key statistics with formatted values in legend (use format_parameter_value for full units)
ax1.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=2, label=f'Median: {format_parameter_value(p50, units)}')
ax1.axvline(p5, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'5th %-ile: {format_parameter_value(p5, units)}')
ax1.axvline(p95, color=COLOR_BLACK, linestyle=':', linewidth=1.5, alpha=0.7, label=f'95th %-ile: {format_parameter_value(p95, units)}')
ax1.axvline(baseline, color=COLOR_BLACK, linestyle='-', linewidth=1.5, alpha=0.5, label=f'Baseline: {format_parameter_value(baseline, units)}')

ax1.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax1.set_ylabel('Frequency', fontsize=11)
ax1.set_title('Distribution of Outcomes', fontsize=12, weight='bold')
ax1.legend(loc='upper right', fontsize=9)
clean_spines(ax1)

# --- Right: CDF (Cumulative Probability) ---
sorted_samples = np.sort(samples)
cumulative = np.arange(1, len(sorted_samples) + 1) / len(sorted_samples)

ax2.plot(sorted_samples, cumulative * 100, color=COLOR_BLACK, linewidth=2)
ax2.fill_between(sorted_samples, 0, cumulative * 100, alpha=0.1, color=COLOR_BLACK)

# Apply tick formatter for readable labels (K, M, B suffixes, $ for USD)
ax2.xaxis.set_major_formatter(get_tick_formatter(unit=units))

# Mark key percentiles
ax2.axhline(50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)
ax2.axhline(5, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axhline(95, color=COLOR_BLACK, linestyle=':', linewidth=1, alpha=0.5)
ax2.axvline(p50, color=COLOR_BLACK, linestyle='--', linewidth=1, alpha=0.5)

ax2.set_xlabel(f'{display_name} ({units})' if units else display_name, fontsize=11)
ax2.set_ylabel('Cumulative Probability (%)', fontsize=11)
ax2.set_title('Probability of Exceeding Value', fontsize=12, weight='bold')
ax2.set_ylim(0, 100)
clean_spines(ax2)

# Add annotation for "probability of exceeding baseline"
exceed_baseline_pct = (np.array(samples) > baseline).sum() / len(samples) * 100
ax2.annotate(f'{exceed_baseline_pct:.0f}% chance of\nexceeding baseline',
             xy=(baseline, exceed_baseline_pct), xytext=(baseline * 1.1, exceed_baseline_pct + 10),
             fontsize=9, ha='left',
             arrowprops=dict(arrowstyle='->', color=COLOR_BLACK, lw=1))

# Main title
fig.suptitle(f'Monte Carlo Analysis: {display_name}', fontsize=14, weight='bold', y=1.02)

# Add watermark
add_watermark(fig)

# Save PNG to knowledge/figures/ regardless of where Quarto renders from
output_path = get_figure_output_path('mc-distribution-treaty_expected_cost_per_daly_conservative.png')
plt.savefig(output_path, dpi=150, bbox_inches='tight', facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title=f'Monte Carlo: {display_name}',
    description=f'Monte Carlo simulation results showing uncertainty distribution for {display_name}'
)

plt.show()
```

**Key Statistics:**

| Statistic | Value |
|:----------|------:|
| Baseline (deterministic) | 1.259 |
| Mean (expected value) | 1.344 |
| Median (50th percentile) | 1.238 |
| Standard Deviation | 0.5229 |
| 90% Confidence Interval | [0.7141, 2.331] |

*The histogram shows the distribution of Expected Cost per DALY (Conservative 10% Success) across 10,000 Monte Carlo simulations. The CDF (right) shows the probability of the outcome exceeding any given value, which is useful for risk assessment.*
