```{python}
#| echo: false
import sys
import os

# Quarto executes from project root (execute-dir: project in _book.yml)

appendix_path = os.path.join(os.getcwd(), 'brain', 'book', 'appendix')
if appendix_path not in sys.path:
    sys.path.insert(0, appendix_path)

from economic_parameters import *
```

```{python}
#| label: clinical-trial-regional-spending-column-chart
#| echo: false
import matplotlib.pyplot as plt
from pathlib import Path
import sys

# --- Find project root dynamically to import shared modules ---

project_root = Path.cwd()
while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
    project_root = project_root.parent
if str(project_root) not in sys.path:
    sys.path.append(str(project_root))

# --- Import centralized style and constants ---

from brain.figures._chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata, PATTERN_DIAGONAL
)

# --- Setup Chart Style ---

setup_chart_style()
fig, ax = plt.subplots(figsize=(8, 6))

# --- Data ---
# Source: Clinical trial spending by region 2024

regions = ['United\nStates', 'Europe', 'China', 'Rest of\nWorld']
spending = [45, 22.5, 13.5, 10.5]  # Midpoint estimates in billions
percentages = ['54%', '27%', '16%', '13%']

# --- Create Column Chart ---
# Solid black for US (dominates), white for others, pattern for China (rising)

colors = [COLOR_BLACK, COLOR_WHITE, COLOR_WHITE, COLOR_WHITE]
hatches = [None, None, PATTERN_DIAGONAL, None]
edgecolor = COLOR_BLACK
bars = ax.bar(regions, spending, color=colors, edgecolor=edgecolor, linewidth=2, width=0.6, hatch=hatches)

# --- Add Title ---

ax.set_title(
    "Clinical Trials: Who Spends Where? (2024)",
    fontsize=28, weight='bold', color=COLOR_BLACK, pad=30, loc='center'
)

# --- Remove Y-Axis (Tufte principle - data labels make it redundant) ---

ax.get_yaxis().set_visible(False)
clean_spines(ax, positions=['top', 'right', 'left'])

# --- Customize X-Axis ---

ax.tick_params(axis='x', which='major', length=0)  # No ticks
ax.set_xticklabels(regions, fontsize=18, color=COLOR_BLACK, linespacing=1.5)

# --- Add Direct Data Labels ---

for i, (bar, val, pct) in enumerate(zip(bars, spending, percentages)):
    # For all bars, place black text above (cleaner look)
    ax.annotate(
        f'${val}B\n{pct}',
        xy=(bar.get_x() + bar.get_width() / 2, val),
        xytext=(0, 10),
        textcoords="offset points",
        ha='center', va='bottom',
        fontsize=30, weight='bold',
        color=COLOR_BLACK,
        fontname='Courier New',
        linespacing=1.3
    )

# --- Adjust plot limits for visual balance ---

ax.set_ylim(0, max(spending) * 1.3)

# --- Add Watermark ---

add_watermark(fig)

# --- Save and Show Plot ---

output_dir = project_root / 'dih-economic-models' / 'figures'
output_dir.mkdir(parents=True, exist_ok=True)
filename = Path(__file__).stem if '__file__' in locals() else 'clinical-trial-regional-spending-column-chart'
output_path = output_dir / f'{filename}.png'

plt.savefig(output_path, dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title="Clinical Trials: Who Spends Where? (2024)",
    description="The United States dominates clinical trial spending at $45B (54%), with China rapidly rising to become the world's leading trial location by volume."
)

plt.show()
```