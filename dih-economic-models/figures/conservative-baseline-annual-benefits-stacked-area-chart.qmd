```{python}
#| echo: false
from economic_parameters import *
```

```{python}
#| echo: false
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path

# Find project root dynamically

# Add paths

from economic_parameters import (
    calculate_personal_lifetime_wealth_conservative_baseline,
    calculate_gdp_growth_boost,
    GLOBAL_POPULATION_2024_BILLIONS,
    PEACE_DIVIDEND_ANNUAL_SOCIETAL_BENEFIT
)
from figures._chart_style import (
    setup_chart_style, add_watermark, clean_spines, add_png_metadata,
    COLOR_BLACK, COLOR_WHITE, PATTERN_DIAGONAL, PATTERN_HORIZONTAL,
    PATTERN_CROSS, PATTERN_DOTS, get_project_root, get_figure_output_path)

setup_chart_style()

# Parameters

treaty_pct = 0.01
current_age = 30
annual_income = 50000
baseline_life_expectancy = 80
discount_rate = 0.03

# Get calculation for overall metrics using Evidence-Based Conservative model
# NOTE: This is the CONSERVATIVE baseline (antibiotic precedent, 5yr life extension)
# For realistic estimates, see Disease Eradication Model ($2.4M-$5.8M, 34-106yr)

calc = calculate_personal_lifetime_wealth_conservative_baseline(
    treaty_pct=treaty_pct,
    current_age=current_age,
    annual_income=annual_income,
    discount_rate=discount_rate,
    conservative=True  # Use conservative 5-year life extension
)

# Simulate year-by-year benefits

years_remaining = int(baseline_life_expectancy - current_age + calc['life_extension_years'])
ages = np.arange(current_age, current_age + years_remaining)
years = np.arange(years_remaining)

# Annual benefits (undiscounted for clarity)
# Convert billions to actual population

GLOBAL_POPULATION_2024 = GLOBAL_POPULATION_2024_BILLIONS * 1_000_000_000
peace_dividend_annual = PEACE_DIVIDEND_ANNUAL_SOCIETAL_BENEFIT / GLOBAL_POPULATION_2024
healthcare_annual = calc['annual_breakdown']['healthcare_savings']
productivity_annual = calc['annual_breakdown']['productivity_gains']
gdp_boost_rate = calculate_gdp_growth_boost(treaty_pct)

# Calculate annual benefits with growth, then cumulate them

peace_div_annual_list = []
healthcare_annual_list = []
productivity_annual_list = []
gdp_boost_annual_list = []

for year in years:
    # Compound at GDP boost rate
    growth_factor = (1 + (gdp_boost_rate - 0.025)) ** year

    peace_div_annual_list.append(peace_dividend_annual * growth_factor)
    healthcare_annual_list.append(healthcare_annual * growth_factor)
    productivity_annual_list.append(productivity_annual * growth_factor)

    # GDP boost effect on income
    base_income_growth = annual_income * ((1 + 0.025) ** year)
    boosted_income = annual_income * ((1 + gdp_boost_rate) ** year)
    gdp_boost_annual_list.append(boosted_income - base_income_growth)

# Convert to arrays
peace_div_annual_arr = np.array(peace_div_annual_list)
healthcare_annual_arr = np.array(healthcare_annual_list)
productivity_annual_arr = np.array(productivity_annual_list)
gdp_boost_annual_arr = np.array(gdp_boost_annual_list)

# Calculate CUMULATIVE values (running total)
peace_div_values = np.cumsum(peace_div_annual_arr)
healthcare_values = np.cumsum(healthcare_annual_arr)
productivity_values = np.cumsum(productivity_annual_arr)
gdp_boost_values = np.cumsum(gdp_boost_annual_arr)

# Create figure

fig, ax = plt.subplots(figsize=(14, 10))

# Create stacked area chart with patterns (cumulative stacking)

ax.fill_between(ages, 0, peace_div_values,
                color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1,
                hatch=PATTERN_DOTS*2, label='Peace Dividend')

cumulative_healthcare = peace_div_values + healthcare_values
ax.fill_between(ages, peace_div_values, cumulative_healthcare,
                color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1,
                hatch=PATTERN_HORIZONTAL*2, label='Healthcare Savings')

cumulative_productivity = cumulative_healthcare + productivity_values
ax.fill_between(ages, cumulative_healthcare, cumulative_productivity,
                color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1,
                hatch=PATTERN_DIAGONAL*2, label='Productivity Gains')

cumulative_total = cumulative_productivity + gdp_boost_values
ax.fill_between(ages, cumulative_productivity, cumulative_total,
                color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1,
                hatch=PATTERN_CROSS*2, label='Economic Multiplier (Military→Research)')

# Labels and title

ax.set_xlabel('Age', fontsize=24, weight='bold')
ax.set_ylabel('Cumulative Lifetime Wealth (Undiscounted)', fontsize=24, weight='bold')
ax.set_title('Cumulative Lifetime Wealth Over Lifetime (Conservative Estimate)\n(Age 30, $50K Income, 1% Treaty, 5yr Life Extension)',
             fontsize=32, weight='bold', pad=20)

# Format y-axis

ax.yaxis.set_major_formatter(plt.FuncFormatter(lambda y, p: f'${y/1000:.0f}K'))

# Add final value annotation

final_value = cumulative_total[-1]
ax.annotate(f'Total: ${final_value/1000:.0f}K',
            xy=(ages[-1], final_value),
            xytext=(ages[-1] - 10, final_value * 1.05),
            fontsize=22, weight='bold',
            bbox=dict(boxstyle='round,pad=0.5', facecolor='yellow',
                     edgecolor=COLOR_BLACK, linewidth=2),
            arrowprops=dict(arrowstyle='->', lw=2, color=COLOR_BLACK))

# Clean up spines

clean_spines(ax, positions=['top', 'right'])

# Legend

ax.legend(loc='upper left', fontsize=14, frameon=True, fancybox=False, edgecolor=COLOR_BLACK)

# Grid

ax.grid(True, axis='y', alpha=0.3, linestyle='--', linewidth=0.5)

# Add watermark

add_watermark(fig)

# Save figure

output_dir = get_project_root() / 'brain' / 'figures'
output_dir.mkdir(parents=True, exist_ok=True)
output_path = output_dir / 'conservative-baseline-annual-benefits-stacked-area-chart.png'

plt.savefig(output_path, dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)

# Add metadata

add_png_metadata(
    output_path,
    title="Cumulative Lifetime Wealth Over Lifetime (Conservative Estimate)",
    description="Stacked area chart showing cumulative wealth accumulation over lifetime using conservative baseline model (5yr life extension)"
)

plt.show()
```

*Uses Evidence-Based Conservative model (antibiotic precedent, 5yr life extension). Base case: Age 30, $50K income, 1% treaty. Shows cumulative additional wealth beyond normal income from treaty benefits: peace dividend (per-capita share of reduced war costs), healthcare savings (reduced medical expenses), productivity gains (increased earnings from better health), and economic multiplier (GDP growth from military→research reallocation).*