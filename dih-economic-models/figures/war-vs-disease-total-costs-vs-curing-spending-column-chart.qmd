```{python}
#| echo: false
import sys
import os

# Quarto executes from project root (execute-dir: project in _book.yml)

appendix_path = os.path.join(os.getcwd(), 'brain', 'book', 'appendix')
if appendix_path not in sys.path:
    sys.path.insert(0, appendix_path)

from economic_parameters import *
```

# | label: stupidity-budget-full-picture

# | fig-cap: "The Full Picture of Stupidity"

import sys
import os
from pathlib import Path

# Add project root to path (find it relative to current working directory)

project_root = Path.cwd()
if project_root.name != 'decentralized-institutes-of-health':
    while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
        project_root = project_root.parent
sys.path.insert(0, str(project_root))

import matplotlib.pyplot as plt
import numpy as np
from dih_economic_models.figures._chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_BLACK, PATTERN_DIAGONAL, COLOR_WHITE,
    get_presentation_font_sizes,
    add_png_metadata)

# Setup styling

setup_chart_style(style='light', dpi=150)
FONT_SIZES = get_presentation_font_sizes()

# Create figure

fig, ax = plt.subplots(figsize=(12, 12))

categories3 = ['War\n(Total)', 'Disease\n(Total)', 'Curing\nCancer', 'Curing\nDementia']

# War costs breakdown (from cost-of-war.qmd)

war_direct = 2720
war_infrastructure = 1875
war_lives = 1000
war_trade = 616
war_indirect = 3538
war_total = war_direct + war_infrastructure + war_lives + war_trade + war_indirect
cure_values = [11, 5.5]

# Disease costs breakdown (from cost-of-disease.qmd)

disease_medical = 9900
disease_productivity = 5000
disease_lives = 94200
disease_total = disease_medical + disease_productivity + disease_lives

# Stacked values for disease

disease_stack = [disease_medical, disease_productivity, disease_lives]

# Use single RED color for all disease costs (problem)

disease_color = COLOR_BLACK

# Plot war total

ax.bar(0, war_total, color=COLOR_BLACK, edgecolor=COLOR_WHITE, linewidth=3, width=0.8)
ax.text(0, war_total * 0.5, f'$10T', ha='center', va='center',
        fontsize=42, weight='bold', color=COLOR_WHITE)

# Plot stacked disease bar

bottom = 0
disease_bars = []
for i, value in enumerate(disease_stack):
    bar = ax.bar(1, value, bottom=bottom, color=disease_color, edgecolor=COLOR_WHITE, linewidth=2, width=0.8)
    disease_bars.append(bar)

    # Add labels for each segment - no decimals
    label_y = bottom + value/2
    if i == 0:
        label_text = f'Medical: ${disease_medical/1000:.0f}T'
    elif i == 1:
        label_text = f'Lost Work: ${disease_productivity/1000:.0f}T'
    else:
        label_text = f'Lost Lives: ${disease_lives/1000:.0f}T'

    ax.text(1, label_y, label_text, ha='center', va='center',
            fontsize=28, weight='bold', color=COLOR_WHITE)
    bottom += value

# Total label on disease stack

ax.text(1, disease_total * 1.02, f'$109T TOTAL', ha='center', va='bottom',
        fontsize=52, weight='bold', color=COLOR_BLACK)

# Plot cure bars (tiny compared to disease)

ax.bar(2, cure_values[0], color=COLOR_BLACK, edgecolor=COLOR_WHITE, linewidth=3, width=0.8)
ax.bar(3, cure_values[1], color=COLOR_BLACK, edgecolor=COLOR_WHITE, linewidth=3, width=0.8)

# Labels for cures

ax.text(2, cure_values[0] + (disease_total * 0.01), '$11B', ha='center', va='bottom',
        fontsize=40, weight='bold', color=COLOR_BLACK)
ax.text(3, cure_values[1] + (disease_total * 0.01), '$6B', ha='center', va='bottom',
        fontsize=40, weight='bold', color=COLOR_BLACK)

ax.set_xticks([0, 1, 2, 3])
ax.set_xticklabels(categories3)
ax.set_ylabel('Annual Cost (Billions)', fontsize=36, weight='bold', color=COLOR_BLACK)
ax.set_title('The Full Picture', fontsize=48, pad=30, weight='bold', color=COLOR_BLACK)
ax.tick_params(axis='x', labelsize=32, colors=COLOR_BLACK)
ax.tick_params(axis='y', labelsize=28, colors=COLOR_BLACK)
ax.yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x/1000:.0f}T' if x >= 1000 else f'{x:.0f}B'))
clean_spines(ax, ['top', 'right'])

add_watermark(fig)

output_dir = project_root / 'dih-economic-models' / 'figures'
output_dir.mkdir(parents=True, exist_ok=True)
output_path = output_dir / 'war-vs-disease-total-costs-vs-curing-spending-column-chart.png'

# Save the figure

plt.savefig(output_path, dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)

# Add metadata for attribution

add_png_metadata(output_path, title="War Vs Disease Total Costs Vs Curing Spending Column Chart")
plt.show()
