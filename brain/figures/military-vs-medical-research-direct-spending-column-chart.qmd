#| label: stupidity-budget-direct-spending
#| fig-cap: "Direct Spending Comparison"

import sys
import os
from pathlib import Path

# Add project root to path (find it relative to current working directory)
project_root = Path.cwd()
if project_root.name != 'decentralized-institutes-of-health':
    while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
        project_root = project_root.parent
sys.path.insert(0, str(project_root))

import matplotlib.pyplot as plt
import numpy as np
from brain.figures._chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_BLACK, PATTERN_DIAGONAL, COLOR_WHITE,
    get_presentation_font_sizes
)

# Setup styling
setup_chart_style(style='light', dpi=150)
FONT_SIZES = get_presentation_font_sizes()

# Create figure
fig, ax = plt.subplots(figsize=(12, 12))

categories1 = ['War &\nMilitary', 'Curing\nCancer', 'Curing\nDementia']
values1 = [2720, 11, 5.5]  # All in billions
colors1 = [COLOR_BLACK, PATTERN_DIAGONAL, PATTERN_HORIZONTAL]

bars1 = ax.bar(categories1, values1, color=colors1, edgecolor=COLOR_WHITE, linewidth=3)

# Labels - no decimals
labels1 = ['$3T', '$11B', '$6B']
for bar, label, value in zip(bars1, labels1, values1):
    height = bar.get_height()
    if value > 1000:
        y_pos = height * 0.95
        va = 'top'
        color = COLOR_WHITE
        size = 48
    else:
        y_pos = height + (max(values1) * 0.02)
        va = 'bottom'
        color = COLOR_BLACK
        size = 40
    ax.text(bar.get_x() + bar.get_width()/2., y_pos,
            label, ha='center', va=va, fontsize=size, weight='bold', color=color)

ax.set_ylabel('Annual Spending (Billions)', fontsize=36, weight='bold', color=COLOR_BLACK)
ax.set_title('Direct Spending', fontsize=48, pad=30, weight='bold', color=COLOR_BLACK)
ax.tick_params(axis='x', labelsize=32, colors=COLOR_BLACK)
ax.tick_params(axis='y', labelsize=28, colors=COLOR_BLACK)
ax.yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x/1000:.0f}T' if x >= 1000 else f'{x:.0f}B'))
clean_spines(ax, ['top', 'right'])

add_watermark(fig)

output_dir = project_root / 'brain' / 'figures'
output_dir.mkdir(parents=True, exist_ok=True)
plt.savefig(output_dir / 'military-vs-medical-research-direct-spending-column-chart.png', dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)
plt.show()
