```{python}
#| echo: false
import sys
import os

# Quarto executes from project root (execute-dir: project in _book.yml)

appendix_path = os.path.join(os.getcwd(), 'brain', 'book', 'appendix')
if appendix_path not in sys.path:
    sys.path.insert(0, appendix_path)

from economic_parameters import *
```

```{python}
#| echo: false
import matplotlib.pyplot as plt
import numpy as np
from pathlib import Path
import sys

# Find project root dynamically

project_root = Path.cwd()
if project_root.name != 'decentralized-institutes-of-health':
    while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
        project_root = project_root.parent

# Add paths

sys.path.insert(0, str(project_root / 'brain' / 'book' / 'appendix'))
sys.path.insert(0, str(project_root / 'brain' / 'figures'))

from economic_parameters import calculate_personal_lifetime_wealth_disease_eradication
from _chart_style import (
    setup_chart_style, add_watermark, clean_spines, add_png_metadata,
    COLOR_BLACK, COLOR_WHITE, get_project_root
)

setup_chart_style()

# Treaty percentages to analyze

treaty_percentages = np.array([0.001, 0.0025, 0.005, 0.0075, 0.01, 0.015, 0.02, 0.03, 0.04, 0.05])
treaty_labels = ['0.1%', '0.25%', '0.5%', '0.75%', '1%', '1.5%', '2%', '3%', '4%', '5%']

# Calculate for three representative people
# Young professional (25, $60K)

young_professional = []
for pct in treaty_percentages:
    calc = calculate_personal_lifetime_wealth_disease_eradication(
        treaty_pct=pct,
        current_age=25,
        annual_income=60000,
        years_elapsed=20,  # 20-year scenario (DEFAULT)
        discount_rate=0.03
    )
    young_professional.append(calc['total_lifetime_benefit'])

# Mid-career (40, $80K)

mid_career = []
for pct in treaty_percentages:
    calc = calculate_personal_lifetime_wealth_disease_eradication(
        treaty_pct=pct,
        current_age=40,
        annual_income=80000,
        years_elapsed=20,
        discount_rate=0.03
    )
    mid_career.append(calc['total_lifetime_benefit'])

# Near retirement (55, $90K)

near_retirement = []
for pct in treaty_percentages:
    calc = calculate_personal_lifetime_wealth_disease_eradication(
        treaty_pct=pct,
        current_age=55,
        annual_income=90000,
        years_elapsed=20,
        discount_rate=0.03
    )
    near_retirement.append(calc['total_lifetime_benefit'])

# Create figure

fig, ax = plt.subplots(figsize=(16, 11))

# Plot lines

ax.plot(treaty_percentages * 100, np.array(young_professional)/1000000,
        marker='o', linewidth=3, markersize=8, color=COLOR_BLACK,
        label='Young Professional (Age 25, $60K income)')

ax.plot(treaty_percentages * 100, np.array(mid_career)/1000000,
        marker='s', linewidth=3, markersize=8, color=COLOR_BLACK,
        linestyle='--', label='Mid-Career (Age 40, $80K income)')

ax.plot(treaty_percentages * 100, np.array(near_retirement)/1000000,
        marker='^', linewidth=2.5, markersize=8, color=COLOR_BLACK,
        linestyle=':', label='Near Retirement (Age 55, $90K income)')

# Highlight 1% Treaty (the DEFAULT proposal)

treaty_1pct_idx = 4  # Index of 1%
ax.axvline(x=1.0, color='gray', linewidth=2, linestyle='--', alpha=0.5, zorder=0)
ax.text(1.0, ax.get_ylim()[1] * 0.95, '1% Treaty\n(DEFAULT)',
        ha='center', va='top', fontsize=32, weight='bold',
        bbox=dict(boxstyle='round,pad=0.5', facecolor=COLOR_WHITE,
                 edgecolor=COLOR_BLACK, linewidth=1.5))

# Add value annotations at 1% point

for i, (values, marker_y_offset) in enumerate([
    (young_professional, 0.3),
    (mid_career, 0.0),
    (near_retirement, -0.3)
]):
    value_at_1pct = values[treaty_1pct_idx]
    ax.annotate(f'${value_at_1pct/1000000:.1f}M',
                xy=(1.0, value_at_1pct/1000000),
                xytext=(1.3, value_at_1pct/1000000 + marker_y_offset),
                fontsize=20, weight='bold',
                bbox=dict(boxstyle='round,pad=0.4', facecolor=COLOR_WHITE,
                         edgecolor=COLOR_BLACK),
                arrowprops=dict(arrowstyle='->', color=COLOR_BLACK, lw=1.5))

# Labels and title

ax.set_xlabel('Treaty Percentage (% of Military Budget)', fontsize=24, weight='bold')
ax.set_ylabel('Total Lifetime Wealth (NPV, Millions)', fontsize=24, weight='bold')
ax.set_title('Disease Eradication Model - Personal Lifetime Wealth by Treaty Percentage\n(20-Year Scenario: 72 Years Life Extension)',
             fontsize=32, weight='bold', pad=20)

# Format y-axis

ax.yaxis.set_major_formatter(plt.FuncFormatter(lambda y, p: f'${y:.1f}M'))

# Format x-axis

ax.set_xlim(0, 5.5)
ax.set_xticks([0.1, 0.25, 0.5, 0.75, 1.0, 1.5, 2.0, 3.0, 4.0, 5.0])
ax.set_xticklabels(treaty_labels)

# Add legend

ax.legend(loc='upper left', fontsize=14, frameon=True, edgecolor=COLOR_BLACK,
          facecolor=COLOR_WHITE, framealpha=1.0)

# Clean up spines

clean_spines(ax, positions=['top', 'right'])

# Add grid

ax.grid(True, alpha=0.3, linestyle='--', linewidth=0.5)

# Add watermark

add_watermark(fig)

# Save figure

output_dir = get_project_root() / 'brain' / 'figures'
output_dir.mkdir(parents=True, exist_ok=True)
output_path = output_dir / 'disease-eradication-lifetime-wealth-by-treaty-percentage-line-chart.png'

plt.savefig(output_path, dpi=200, bbox_inches='tight', facecolor=COLOR_WHITE)

# Add metadata

add_png_metadata(
    output_path,
    title="Disease Eradication Model - Personal Lifetime Wealth by Treaty Percentage",
    description="Shows how personal lifetime wealth scales with treaty percentage under Disease Eradication Model (72yr life extension)"
)

plt.show()
```

*Uses Disease Eradication Model (20-year scenario, 72yr life extension). Shows how personal lifetime wealth scales with treaty percentage from 0.1% to 5%.*
