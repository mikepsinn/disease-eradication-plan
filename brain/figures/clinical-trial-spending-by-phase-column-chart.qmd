```{python}
#| label: clinical-trial-spending-by-phase-column-chart
#| echo: false
import matplotlib.pyplot as plt
from pathlib import Path
import sys

# --- Find project root dynamically to import shared modules ---
project_root = Path.cwd()
while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
    project_root = project_root.parent
if str(project_root) not in sys.path:
    sys.path.append(str(project_root))

# --- Import centralized style and constants ---
from brain.figures._chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_BLACK, COLOR_WHITE, add_png_metadata
)

# --- Setup Chart Style ---
setup_chart_style()
fig, ax = plt.subplots(figsize=(8, 6))

# --- Data ---
# Source: Global clinical trial spending by phase 2024
phases = ['Phase 1', 'Phase 2', 'Phase 3', 'Phase 4']
spending_min = [8, 15, 29, 15]  # Minimum estimates in billions
spending_max = [15, 25, 45, 20]  # Maximum estimates in billions
spending_mid = [11.5, 20, 37, 17.5]  # Midpoint for display

# --- Create Column Chart ---
# Use white fill with black outline (default), solid black for Phase 3 (highest)
colors = [COLOR_WHITE, COLOR_WHITE, COLOR_BLACK, COLOR_WHITE]
edgecolor = COLOR_BLACK
bars = ax.bar(phases, spending_mid, color=colors, edgecolor=edgecolor, linewidth=2, width=0.6)

# --- Add Title ---
ax.set_title(
    "Global Clinical Trial Spending by Phase (2024)",
    fontsize=28, weight='bold', color=COLOR_BLACK, pad=30, loc='center'
)

# --- Remove Y-Axis (Tufte principle - data labels make it redundant) ---
ax.get_yaxis().set_visible(False)
clean_spines(ax, positions=['top', 'right', 'left'])

# --- Customize X-Axis ---
ax.tick_params(axis='x', which='major', length=0)  # No ticks
ax.set_xticklabels(phases, fontsize=20, color=COLOR_BLACK)

# --- Add Direct Data Labels ---
for i, (bar, min_val, max_val, mid_val) in enumerate(zip(bars, spending_min, spending_max, spending_mid)):
    # For Phase 3 (solid black), use white text inside
    if i == 2:
        ax.annotate(
            f'${min_val}-${max_val}B',
            xy=(bar.get_x() + bar.get_width() / 2, mid_val / 2),
            xytext=(0, 0),
            textcoords="offset points",
            ha='center', va='center',
            fontsize=36, weight='bold',
            color=COLOR_WHITE,
            fontname='Courier New'
        )
    # For white bars, place black text above
    else:
        ax.annotate(
            f'${min_val}-${max_val}B',
            xy=(bar.get_x() + bar.get_width() / 2, mid_val),
            xytext=(0, 10),
            textcoords="offset points",
            ha='center', va='bottom',
            fontsize=36, weight='bold',
            color=COLOR_BLACK,
            fontname='Courier New'
        )

# --- Adjust plot limits for visual balance ---
ax.set_ylim(0, max(spending_max) * 1.25)

# --- Add Watermark ---
add_watermark(fig)

# --- Save and Show Plot ---
output_dir = project_root / 'brain' / 'figures'
output_dir.mkdir(parents=True, exist_ok=True)
filename = Path(__file__).stem if '__file__' in locals() else 'clinical-trial-spending-by-phase-column-chart'
output_path = output_dir / f'{filename}.png'

plt.savefig(output_path, dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)

add_png_metadata(
    output_path,
    title="Global Clinical Trial Spending by Phase (2024)",
    description="Phase 3 trials dominate at $29-45B annually, representing over half of the $83B global clinical trials market."
)

plt.show()
```
