---
jupyter: python3
echo: false
---

```{python}
import matplotlib.pyplot as plt
from pathlib import Path
import sys

# Find project root dynamically
project_root = Path.cwd()
if project_root.name != 'decentralized-institutes-of-health':
    while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
        project_root = project_root.parent
sys.path.insert(0, str(project_root))

# Import centralized style
from brain.figures._chart_style import setup_chart_style, add_watermark, clean_spines, add_png_metadata
from brain.figures._chart_style import COLOR_BLACK, COLOR_WHITE

setup_chart_style()

# Data - from combined annual benefit calculation
peace_dividend = 97.1
dfda_savings = 50.0
total_benefit = peace_dividend + dfda_savings

interventions = [
    'Water\nFluoridation',
    'Smoking\nCessation',
    'Childhood\nVaccinations',
    '1% Treaty /\ndFDA Initiative'
]
values = [0.8, 12.0, 15.0, total_benefit]

# Create figure - taller for vertical layout
fig, ax = plt.subplots(figsize=(8, 10))

# Create vertical bars - white with black edge for traditional interventions
for i in range(3):
    ax.bar(i, values[i], color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=2, width=0.6)

# Create stacked bar for 1% Treaty
x_pos = 3
# Peace dividend portion (bottom)
bar1 = ax.bar(x_pos, peace_dividend, color=COLOR_WHITE, edgecolor=COLOR_BLACK,
              linewidth=2, width=0.6, label='Peace Dividend')
# dFDA savings portion (stacked on top)
bar2 = ax.bar(x_pos, dfda_savings, bottom=peace_dividend, color=COLOR_WHITE,
              edgecolor=COLOR_BLACK, linewidth=2, width=0.6, hatch='///', label='dFDA R&D Savings')

# X-axis labels
ax.set_xticks(range(len(interventions)))
ax.set_xticklabels(interventions, fontsize=15)

# Value labels for traditional interventions (positioned above bars)
for i in range(3):
    ax.text(i, values[i] + 3, f'${values[i]:,.1f}B',
            ha='center', va='bottom', fontsize=20, color=COLOR_BLACK, weight='bold')

# Value labels for stacked 1% Treaty bar
# Peace dividend label (in middle of bottom segment)
ax.text(x_pos, peace_dividend/2, f'${peace_dividend:.1f}B\nPeace\nDividend\nfrom 1%\nLess\nConflict',
        ha='center', va='center', fontsize=14, color=COLOR_BLACK, weight='bold',
        bbox=dict(boxstyle='round,pad=0.4', facecolor=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1))
# dFDA label (in middle of top segment)
ax.text(x_pos, peace_dividend + dfda_savings/2, f'${dfda_savings:.0f}B\nHealth and\nEconomic\nBenefit of a\nDecentralized\nFDA',
        ha='center', va='center', fontsize=13, color=COLOR_BLACK, weight='bold',
        bbox=dict(boxstyle='round,pad=0.4', facecolor=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1))
# Total label (above bar)
ax.text(x_pos, total_benefit + 3, f'${total_benefit:.1f}B\ntotal',
        ha='center', va='bottom', fontsize=20, color=COLOR_BLACK, weight='bold')

# Add title
ax.set_title('Gross Annual Economic Benefit of the 1% Treaty and Decentralized FDA', fontsize=18, color=COLOR_BLACK, weight='bold', pad=20)

# Add annotations

# Note about self-funding (arrow to 1% Treaty bar)
ax.annotate('Only the 1% Treaty\nis self-funding\n(generates wealth\nwhile saving lives)',
           xy=(x_pos, total_benefit/2), xytext=(x_pos - 1.2, total_benefit * 0.55),
           ha='center', fontsize=12, color=COLOR_BLACK, weight='bold',
           bbox=dict(boxstyle='round,pad=0.5', facecolor=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=1.5),
           arrowprops=dict(arrowstyle='->', lw=1.5, color=COLOR_BLACK))

# Axis formatting
ax.set_ylabel('')
ax.set_xlabel('')
ax.set_ylim(0, total_benefit * 1.18)

# Clean spines - remove y-axis too since all values are labeled
clean_spines(ax, ['top', 'right', 'left'])
ax.tick_params(left=False, labelleft=False)  # Remove y-axis ticks and labels

# Add watermark
add_watermark(fig)

# Save figure
output_dir = project_root / 'brain' / 'figures'
output_dir.mkdir(parents=True, exist_ok=True)
output_path = output_dir / 'public-health-impact-vertical-column-chart.png'

# Save the figure
plt.savefig(output_path, dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)

# Add metadata for attribution
add_png_metadata(output_path, title="Public Health Impact Vertical Column Chart")

plt.show()
```
