---
jupyter: python3
echo: false
---

```{python}
import matplotlib.pyplot as plt
import pandas as pd
from pathlib import Path
import sys

# Find project root dynamically
project_root = Path.cwd()
if project_root.name != 'decentralized-institutes-of-health':
    while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
        project_root = project_root.parent
sys.path.insert(0, str(project_root))

# Import centralized style
from brain.figures._chart_style import setup_chart_style, add_watermark, clean_spines
from brain.figures._chart_style import COLOR_BLACK, COLOR_WHITE

setup_chart_style()

# Core parameters for the dFDA model (in billions of USD)
# WORST CASE SCENARIO (Conservative) from brain/book/appendix/dfda-cost-benefit-analysis.qmd
global_clinical_trial_market = 100.0
dfda_rd_cost_reduction_pct = 0.50
dfda_annual_operational_cost = 0.2975  # $297.5 million (Platform $26.5M + Broader initiatives $271M)

# Baseline QALYs generated annually
qaly_gains_annual_baseline = 840000  # in QALYs

# Value of a QALY (standard economic value)
value_per_qaly = 150000  # Using $150k per QALY

# Calculations
gross_rd_savings = global_clinical_trial_market * dfda_rd_cost_reduction_pct
monetized_qaly_value = (qaly_gains_annual_baseline * value_per_qaly) / 1_000_000_000  # Convert to billions

# Data for the bar chart
investment_return_data = {
    'Label': ['Investment\n(OpEx)', 'R&D Savings\n(Financial)', 'Health Gains\n(Monetized QALYs)'],
    'Value ($B)': [dfda_annual_operational_cost, gross_rd_savings, monetized_qaly_value]
}
investment_return_df = pd.DataFrame(investment_return_data)

# Create figure
fig, ax = plt.subplots(figsize=(10, 7))

# Create bars with white fill and black edges
bars = ax.bar(investment_return_df['Label'], investment_return_df['Value ($B)'],
              color=COLOR_WHITE, edgecolor=COLOR_BLACK, linewidth=2, width=0.6)

# Apply modern styling
clean_spines(ax, ['top', 'right', 'left'])
ax.tick_params(left=False, labelleft=False)

# Add value labels
for i, bar in enumerate(bars):
    height = bar.get_height()
    if height < 1:  # Small values (OpEx)
        label = f'${height*1000:.0f}M'
        y_pos = height + 5
    else:  # Large values
        label = f'${height:,.1f}B'
        y_pos = height + 5

    ax.text(bar.get_x() + bar.get_width()/2, y_pos,
            label, ha='center', va='bottom', fontsize=36,
            fontweight='bold', color=COLOR_BLACK)

# Title
ax.set_title('dFDA Investment vs. Returns', fontsize=28, fontweight='bold',
             color=COLOR_BLACK, pad=25)

# Clean axis
ax.set_ylabel('')
ax.set_xlabel('')
ax.set_ylim(0, monetized_qaly_value * 1.3)

# X-axis labels
ax.set_xticklabels(investment_return_df['Label'], fontsize=14, color=COLOR_BLACK)

# Add watermark
add_watermark(fig)

# Save figure
output_dir = project_root / 'brain' / 'figures'
output_dir.mkdir(parents=True, exist_ok=True)
output_path = output_dir / 'dfda-investment-returns-bar-chart.png'

# Save the figure
plt.savefig(output_path, dpi=200, bbox_inches=None, facecolor=COLOR_WHITE)

# Add metadata for attribution
add_png_metadata(output_path, title="Dfda Investment Returns Bar Chart")

plt.show()
```
