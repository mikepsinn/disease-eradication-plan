```{python}
#| label: war-disease-cancer-dementia-costs-mixed-column-chart
#| fig-cap: "War Total vs Disease Total (Stacked) vs Cancer vs Dementia Research"

import sys
import os
from pathlib import Path

# Add project root to path (find it relative to current working directory)
project_root = Path.cwd()
if project_root.name != 'decentralized-institutes-of-health':
    while project_root.name != 'decentralized-institutes-of-health' and project_root.parent != project_root:
        project_root = project_root.parent
sys.path.insert(0, str(project_root))

import matplotlib.pyplot as plt
import numpy as np
from brain.charts._chart_style import (
    setup_chart_style, add_watermark, clean_spines,
    COLOR_RED, COLOR_BLUE, COLOR_DARK, COLOR_MID, COLOR_WHITE, COLOR_BG
)

# Setup styling
setup_chart_style(style='light', dpi=150)

# War total
war_total = 9747  # $9.7T total war cost

# Disease costs breakdown (from cost-of-disease.qmd)
disease_medical = 9900  # Direct medical costs
disease_productivity = 5000  # Lost productivity
disease_lives = 94200  # Lost human life (DALYs)
disease_total = disease_medical + disease_productivity + disease_lives  # $109.1T

# Cure values
cure_cancer = 11
cure_dementia = 5.5

categories = ['War\n(Total)', 'Disease\n(Total)', 'Curing\nCancer', 'Curing\nDementia']

# Create figure
fig, ax = plt.subplots(figsize=(28, 12))

# Plot war total (single bar, red)
ax.bar(0, war_total, color='#c1272d', edgecolor=COLOR_WHITE, linewidth=3, alpha=0.9, width=0.8)
ax.text(0, war_total * 0.5, f'$9.7T', ha='center', va='center',
        fontsize=48, weight='bold', color=COLOR_WHITE)

# Colors for disease stack (shades of dark red/burgundy)
disease_colors = ['#8b0000', '#5a0000', '#2d0000']

# Plot stacked disease bar
bottom = 0
disease_segments = [disease_medical, disease_productivity, disease_lives]
disease_labels = [
    f'Direct Medical\nCosts\n${disease_medical/1000:.1f}T',
    f'Lost\nProductivity\n${disease_productivity/1000:.0f}T',
    f'Lost Human\nLives (DALYs)\n${disease_lives/1000:.0f}T'
]

for i, (value, color, label) in enumerate(zip(disease_segments, disease_colors, disease_labels)):
    bar = ax.bar(1, value, bottom=bottom, color=color, edgecolor=COLOR_WHITE,
                 linewidth=2, alpha=0.9, width=0.8)

    # Add labels for each segment
    label_y = bottom + value/2
    ax.text(1, label_y, label, ha='center', va='center',
            fontsize=28, weight='bold', color=COLOR_WHITE)
    bottom += value

# Total label on disease stack
ax.text(1, disease_total + (disease_total * 0.02), f'$109T\nTOTAL', ha='center', va='bottom',
        fontsize=56, weight='bold', color='#8b0000')

# Add "11X" comparison arrow/text
ax.annotate('', xy=(1, war_total), xytext=(0, war_total),
            arrowprops=dict(arrowstyle='<->', color=COLOR_DARK, lw=3))
ax.text(0.5, war_total + (disease_total * 0.01), '11X bigger', ha='center', va='bottom',
        fontsize=38, weight='bold', color=COLOR_DARK, style='italic')

# Plot cure bars (microscopic in comparison)
ax.bar(2, cure_cancer, color=COLOR_BLUE, edgecolor=COLOR_WHITE, linewidth=3, alpha=0.9, width=0.8)
ax.bar(3, cure_dementia, color=COLOR_BLUE, edgecolor=COLOR_WHITE, linewidth=3, alpha=0.9, width=0.8)

# Labels for cures
ax.text(2, cure_cancer + (disease_total * 0.005), '$11B', ha='center', va='bottom',
        fontsize=40, weight='bold', color=COLOR_DARK)
ax.text(3, cure_dementia + (disease_total * 0.005), '$6B', ha='center', va='bottom',
        fontsize=40, weight='bold', color=COLOR_DARK)

# Styling
ax.set_xticks([0, 1, 2, 3])
ax.set_xticklabels(categories)
ax.set_ylabel('Annual Cost (Billions)', fontsize=36, weight='bold', color=COLOR_DARK)
ax.tick_params(axis='x', labelsize=32, colors=COLOR_DARK)
ax.tick_params(axis='y', labelsize=28, colors=COLOR_MID)
ax.yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x/1000:.0f}T' if x >= 1000 else f'{x:.0f}B'))
clean_spines(ax, ['top', 'right'])
ax.grid(True, alpha=0.3, color=COLOR_MID, axis='y')

# Add branding
add_watermark(fig)

# Save in same directory as this .qmd file
plt.savefig('war-disease-cancer-dementia-costs-mixed-column-chart.png', dpi=150, bbox_inches='tight', facecolor=COLOR_BG)
plt.show()
```
